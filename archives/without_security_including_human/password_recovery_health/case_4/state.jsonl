{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Requirements (Single-Page, Client-Only, Mocked)\n  Deliverable: One file (index.html) with semantic HTML, inline CSS & JS, and comments mapping to this spec.\n\n  Mapping notes:\n  - Inclusivity: Clear step-by-step flow, visible progress, no time pressure, forgiving navigation, large readable text, high contrast, visible focus, help panel, save-and-return (see sections marked [Inclusivity]).\n  - Mocking: Recovery \"delivery\" and verification are simulated via console.log and a deterministic fixed code 246810. No network requests. [Mocking]\n  - Flow: 4 steps (Identify, Verify Code, New Password, Done) with 1/4 to 4/4 progress. [Flow]\n  - Accessibility: Skip link, ARIA live regions for status and errors, aria-current on progress, keyboard-accessible Help panel. [Accessibility]\n  - Persistence: localStorage saves step and inputs; reload restores progress. Save & return later button on all steps. [Persistence]\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <title>Password Recovery Demo (Client-only, Mocked)</title>\n  <style>\n    /* [Inclusivity + Accessibility + Styling] High-contrast, large, low-clutter, visible focus, WCAG-friendly */\n    :root{\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --primary: #005fcc;     /* strong blue, good contrast on white */\n      --primary-contrast: #ffffff;\n      --accent: #127F11;      /* green for success */\n      --warning: #b00020;     /* red for errors */\n      --focus: #ffbf47;       /* amber focus */\n      --border: #cfcfcf;\n      --panel: #f6f8fa;\n    }\n    * { box-sizing: border-box; }\n    html, body { height: 100%; }\n    body {\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n      font-size: 18px; /* large base size for readability */\n      line-height: 1.5;\n      color: var(--text);\n      background: var(--bg);\n    }\n    a { color: var(--primary); }\n    a:focus, button:focus, input:focus, textarea:focus, select:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header {\n      border-bottom: 1px solid var(--border);\n      background: #fff;\n      position: sticky;\n      top: 0;\n      z-index: 5;\n    }\n    .container {\n      max-width: 840px;\n      margin: 0 auto;\n      padding: 1rem;\n    }\n    .brand {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 1rem;\n    }\n    .brand h1 {\n      font-size: 1.3rem;\n      margin: 0;\n    }\n    .header-actions {\n      display: flex;\n      gap: .5rem;\n      flex-wrap: wrap;\n    }\n    .btn {\n      appearance: none;\n      border: 2px solid var(--primary);\n      background: var(--primary);\n      color: var(--primary-contrast);\n      padding: .6rem 1rem;\n      border-radius: .5rem;\n      font-weight: 600;\n      cursor: pointer;\n    }\n    .btn[disabled], .btn:disabled { opacity: .5; cursor: not-allowed; }\n    .btn.secondary {\n      background: transparent;\n      color: var(--primary);\n    }\n    .btn.ghost {\n      border-color: var(--border);\n      background: transparent;\n      color: var(--muted);\n    }\n    .btn.danger {\n      border-color: var(--warning);\n      background: transparent;\n      color: var(--warning);\n    }\n    nav.progress {\n      border-top: 1px solid var(--border);\n      border-bottom: 1px solid var(--border);\n      background: var(--panel);\n    }\n    .steps {\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: .25rem;\n      margin: 0;\n      padding: .25rem 0;\n      list-style: none;\n    }\n    .steps li {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: .5rem;\n      font-size: .95rem;\n      color: var(--muted);\n    }\n    .steps li[aria-current=\"step\"] {\n      font-weight: 700;\n      color: var(--primary);\n      background: #e9f2ff;\n      border-radius: .4rem;\n    }\n    main {\n      display: block;\n    }\n    .card {\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: .75rem;\n      padding: 1rem;\n      margin: 1rem 0 2rem;\n      box-shadow: 0 1px 0 rgba(0,0,0,0.04);\n    }\n    .section-title {\n      margin: 0 0 .5rem;\n      font-size: 1.4rem;\n    }\n    form .field {\n      margin: .8rem 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: .3rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"], input[type=\"number\"] {\n      width: 100%;\n      padding: .6rem .7rem;\n      border: 2px solid var(--border);\n      border-radius: .5rem;\n      font-size: 1rem;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--warning);\n      background: #fff5f5;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: .95rem;\n      margin-top: .2rem;\n    }\n    .error {\n      color: var(--warning);\n      font-weight: 600;\n      margin-top: .25rem;\n    }\n    .success {\n      color: var(--accent);\n      font-weight: 600;\n      margin-top: .25rem;\n    }\n    .actions {\n      display: flex;\n      flex-wrap: wrap;\n      gap: .5rem;\n      align-items: center;\n      margin-top: 1rem;\n    }\n    .meta-actions {\n      display: flex;\n      flex-wrap: wrap;\n      gap: .5rem;\n      align-items: center;\n      margin-top: .75rem;\n    }\n    .rule-list {\n      margin: .3rem 0 .2rem 1.2rem;\n    }\n    .rule-list li.pass { color: var(--accent); }\n    .rule-list li.fail { color: var(--muted); }\n    .strength {\n      display: inline-block;\n      padding: .2rem .5rem;\n      border-radius: .4rem;\n      font-weight: 700;\n      border: 2px solid var(--border);\n      background: #f7f7f7;\n    }\n    .strength.weak {\n      color: #8b0000;\n      border-color: #8b0000;\n      background: #ffeaea;\n    }\n    .strength.fair {\n      color: #946200;\n      border-color: #946200;\n      background: #fff6e1;\n    }\n    .strength.strong {\n      color: #0b6b0b;\n      border-color: #0b6b0b;\n      background: #e9ffe9;\n    }\n\n    .note {\n      background: #eef7ff;\n      border: 1px solid #b7dbff;\n      border-radius: .5rem;\n      padding: .7rem .9rem;\n      margin-bottom: .75rem;\n    }\n\n    /* Skip link [Accessibility] */\n    .skip-link {\n      position: absolute;\n      left: -9999px;\n      top: auto;\n      width: 1px;\n      height: 1px;\n      overflow: hidden;\n    }\n    .skip-link:focus {\n      position: static;\n      width: auto;\n      height: auto;\n      padding: .5rem 1rem;\n      background: var(--primary);\n      color: var(--primary-contrast);\n      border-radius: .5rem;\n      margin: .5rem;\n      display: inline-block;\n    }\n\n    /* Help panel [Inclusivity + Accessibility] */\n    .help-overlay {\n      position: fixed;\n      inset: 0;\n      background: rgba(0,0,0,0.5);\n      display: none;\n      z-index: 50;\n    }\n    .help-overlay.open { display: block; }\n    aside.help-panel {\n      position: fixed;\n      right: 0;\n      top: 0;\n      height: 100%;\n      width: min(520px, 96%);\n      background: #fff;\n      border-left: 3px solid var(--primary);\n      box-shadow: -8px 0 24px rgba(0,0,0,0.2);\n      transform: translateX(100%);\n      transition: transform .2s ease-out;\n      z-index: 51;\n      padding: 1rem;\n      overflow-y: auto;\n    }\n    aside.help-panel.open { transform: translateX(0); }\n    .help-panel h2 { margin-top: 0; }\n    .help-panel .contact {\n      background: var(--panel);\n      border: 1px solid var(--border);\n      padding: .75rem;\n      border-radius: .5rem;\n    }\n\n    footer {\n      border-top: 1px solid var(--border);\n      color: var(--muted);\n    }\n\n    /* Utility */\n    .sr-only {\n      position: absolute !important;\n      width: 1px; height: 1px;\n      padding: 0; margin: -1px;\n      overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;\n    }\n  </style>\n</head>\n<body>\n  <!-- [Accessibility] Skip link for keyboard users -->\n  <a href=\"#main\" class=\"skip-link\">Skip to main content</a>\n\n  <header role=\"banner\">\n    <div class=\"container brand\">\n      <h1>Password recovery</h1>\n      <div class=\"header-actions\">\n        <!-- [Global Controls] Start over clears state -->\n        <button class=\"btn ghost\" id=\"startOverBtn\" type=\"button\" title=\"Clear saved progress and start from Step 1\">Start over</button>\n        <!-- [Help] Accessible Help panel trigger -->\n        <button class=\"btn secondary\" id=\"helpBtn\" type=\"button\" aria-haspopup=\"dialog\" aria-expanded=\"false\" aria-controls=\"helpPanel\">Help</button>\n      </div>\n    </div>\n    <!-- [Flow] Progress indicator 1/4..4/4 with aria-current -->\n    <nav class=\"progress\" aria-label=\"Recovery progress\">\n      <div class=\"container\">\n        <ol class=\"steps\" id=\"progressSteps\" role=\"list\">\n          <li id=\"stepLabel1\">1/4 Identify</li>\n          <li id=\"stepLabel2\">2/4 Verify code</li>\n          <li id=\"stepLabel3\">3/4 New password</li>\n          <li id=\"stepLabel4\">4/4 Done</li>\n        </ol>\n      </div>\n    </nav>\n  </header>\n\n  <main id=\"main\" role=\"main\" class=\"container\">\n    <!-- [Accessibility] Live regions for status and error announcements -->\n    <div aria-live=\"polite\" role=\"status\" id=\"liveStatus\" class=\"sr-only\"></div>\n    <div aria-live=\"assertive\" role=\"alert\" id=\"liveAlert\" class=\"sr-only\"></div>\n\n    <!-- [App Container] Steps will render here -->\n    <section id=\"app\" class=\"card\" aria-label=\"Password recovery steps\">\n      Loading…\n    </section>\n\n    <p class=\"hint\">\n      Demo note: For this academic demo, the recovery code is printed to the browser console. No data is sent anywhere.\n    </p>\n  </main>\n\n  <!-- [Help Panel] Keyboard-accessible contextual help; no timers; simple language -->\n  <div class=\"help-overlay\" id=\"helpOverlay\" hidden></div>\n  <aside class=\"help-panel\" id=\"helpPanel\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"helpTitle\" aria-describedby=\"helpDesc\" tabindex=\"-1\" hidden>\n    <h2 id=\"helpTitle\">Need a hand?</h2>\n    <p id=\"helpDesc\">This password reset is a gentle, step-by-step process. You can pause anytime using “Save and return later”. Nothing will time out.</p>\n    <ul>\n      <li>Stay oriented: the progress bar shows where you are.</li>\n      <li>Look for short instructions at each step. We avoid jargon.</li>\n      <li>We never rush you. There are no timers in this demo.</li>\n      <li>You can go Back without losing what you typed.</li>\n    </ul>\n    <div class=\"contact\" aria-label=\"Contact options\">\n      <p><strong>Contact (placeholder):</strong></p>\n      <p>Phone: (000) 000-0000</p>\n      <p>Email: help@example-hospital.invalid</p>\n    </div>\n    <div class=\"actions\">\n      <button class=\"btn secondary\" id=\"closeHelpBtn\" type=\"button\">Close help</button>\n    </div>\n  </aside>\n\n  <footer class=\"container\" role=\"contentinfo\">\n    <p>Client-only mock for evaluation. Do not use in production.</p>\n  </footer>\n\n  <script>\n    /* [Mocking] Fixed deterministic code; delivery/verification via console.log */\n    const FIXED_CODE = \"246810\";\n\n    /* [Persistence] localStorage key */\n    const STORAGE_KEY = \"demoRecoveryState_v1\";\n\n    /* [State] The app state persisted across reloads */\n    const defaultState = () => ({\n      step: 1,                         // 1..4\n      identify: { identifier: \"\" },    // username or email\n      verify: { code: \"\" },            // 6-digit code\n      password: { pw: \"\", confirm: \"\" },\n      info: { lastMessage: \"\" },       // last status message for reassurance\n      savedAt: null\n    });\n\n    let state = loadState();\n\n    /* [Utilities] Save/Load/Clear state */\n    function saveState(announce = false, message = \"Progress saved. You can return anytime by reopening this page.\") {\n      try {\n        state.savedAt = Date.now();\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n        if (announce) {\n          showStatus(message);\n          showPersistentNote(message);\n        }\n      } catch (e) {\n        showError(\"Could not save progress in this browser.\");\n      }\n    }\n\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return defaultState();\n        const obj = JSON.parse(raw);\n        // Ensure defaults for any missing fields\n        return Object.assign(defaultState(), obj);\n      } catch (e) {\n        return defaultState();\n      }\n    }\n\n    function clearState() {\n      localStorage.removeItem(STORAGE_KEY);\n      state = defaultState();\n    }\n\n    /* [Accessibility] Live announcements */\n    function showStatus(msg) {\n      const el = document.getElementById(\"liveStatus\");\n      el.textContent = msg;\n    }\n    function showError(msg) {\n      const el = document.getElementById(\"liveAlert\");\n      el.textContent = msg;\n    }\n\n    /* [UI] Render progress header aria-current */\n    function updateProgressHeader() {\n      for (let i = 1; i <= 4; i++) {\n        const li = document.getElementById(\"stepLabel\" + i);\n        if (!li) continue;\n        if (state.step === i) {\n          li.setAttribute(\"aria-current\", \"step\");\n        } else {\n          li.removeAttribute(\"aria-current\");\n        }\n      }\n    }\n\n    /* [Flow] Navigation helpers */\n    function goToStep(n, opts = { focus: true }) {\n      state.step = n;\n      saveState(false);\n      render();\n      updateProgressHeader();\n      if (opts.focus) {\n        const stepHeading = document.querySelector(\"[data-step-heading]\");\n        if (stepHeading) stepHeading.focus();\n      }\n    }\n\n    function startOver() {\n      clearState();\n      render();\n      updateProgressHeader();\n      showStatus(\"Progress cleared. Starting over at Step 1.\");\n    }\n\n    /* [Inclusivity] Persistent reassurance note after Save & return later */\n    function showPersistentNote(message) {\n      let existing = document.getElementById(\"saveNote\");\n      if (!existing) {\n        existing = document.createElement(\"div\");\n        existing.id = \"saveNote\";\n        existing.className = \"note\";\n        const container = document.getElementById(\"main\");\n        container.insertBefore(existing, container.firstElementChild.nextElementSibling); // after live regions\n      }\n      existing.innerHTML = `\n        <p>${message}</p>\n        <div class=\"actions\">\n          <button type=\"button\" class=\"btn ghost\" id=\"dismissSaveNoteBtn\" aria-label=\"Dismiss save note\">Dismiss</button>\n        </div>\n      `;\n      document.getElementById(\"dismissSaveNoteBtn\").addEventListener(\"click\", () => {\n        existing.remove();\n      });\n    }\n\n    /* [Validation] Step 1 identifier (email or username) */\n    function validateIdentifier(val) {\n      const trimmed = (val || \"\").trim();\n      if (!trimmed) return { ok: false, reason: \"Please enter your email or username.\" };\n      if (trimmed.includes(\"@\")) {\n        // Simple email check\n        const emailOk = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(trimmed);\n        return { ok: emailOk, reason: emailOk ? \"\" : \"Please enter a valid email address.\" };\n      } else {\n        const userOk = /^[A-Za-z0-9._-]{3,}$/.test(trimmed);\n        return { ok: userOk, reason: userOk ? \"\" : \"Usernames use letters, numbers, dots, dashes (3+ characters).\" };\n      }\n    }\n\n    /* [Validation] Step 2 code check */\n    function validateCodeInput(val) {\n      const code = (val || \"\").trim();\n      if (!/^\\d{6}$/.test(code)) {\n        return { ok: false, reason: \"Enter the 6-digit code (numbers only).\" };\n      }\n      if (code !== FIXED_CODE) {\n        return { ok: false, reason: \"That code doesn’t match. Check and try again.\" };\n      }\n      return { ok: true, reason: \"\" };\n    }\n\n    /* [Validation] Step 3 password rules + strength */\n    function passwordRules(pw) {\n      const rules = {\n        length: pw.length >= 8,\n        lower: /[a-z]/.test(pw),\n        upper: /[A-Z]/.test(pw),\n        number: /[0-9]/.test(pw),\n        special: /[^A-Za-z0-9]/.test(pw)\n      };\n      const score = Object.values(rules).filter(Boolean).length;\n      let strength = \"weak\";\n      if (score >= 4 && pw.length >= 10) strength = \"strong\";\n      else if (score >= 3) strength = \"fair\";\n      return { rules, score, strength };\n    }\n\n    function validatePassword(pw, confirm) {\n      const { rules, strength } = passwordRules(pw);\n      const ok = rules.length && rules.lower && rules.upper && rules.number && rules.special && (confirm === pw);\n      let reason = \"\";\n      if (!(rules.length && rules.lower && rules.upper && rules.number && rules.special)) {\n        reason = \"Password doesn’t meet the rules.\";\n      } else if (confirm !== pw) {\n        reason = \"Passwords don’t match.\";\n      } else if (strength === \"weak\") {\n        reason = \"Password is too weak.\";\n      }\n      return { ok, reason, strength, rules };\n    }\n\n    /* [Rendering] Each step returns markup and attaches handlers */\n    function renderStep1() {\n      const container = document.getElementById(\"app\");\n      container.innerHTML = `\n        <h2 class=\"section-title\" data-step-heading tabindex=\"-1\">Step 1 of 4 — Identify your account</h2>\n        <p>Enter your email or username so we can send a one-time code.</p>\n        <form id=\"identifyForm\" novalidate>\n          <div class=\"field\">\n            <label for=\"identifier\">Email or username</label>\n            <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" inputmode=\"email\"\n                   required aria-describedby=\"identifierHint identifierError\" value=\"${escapeHTML(state.identify.identifier)}\">\n            <div id=\"identifierHint\" class=\"hint\">We’ll send a 6-digit code. In this demo, the code appears in the console.</div>\n            <div id=\"identifierError\" class=\"error\" aria-live=\"assertive\"></div>\n          </div>\n          <div class=\"actions\">\n            <button type=\"submit\" id=\"continue1\" class=\"btn\" disabled>Continue</button>\n            <button type=\"button\" id=\"save1\" class=\"btn secondary\">Save and return later</button>\n          </div>\n          <div class=\"meta-actions\">\n            <button type=\"button\" id=\"helpInline1\" class=\"btn ghost\">Need help?</button>\n          </div>\n        </form>\n      `;\n      const input = document.getElementById(\"identifier\");\n      const errorEl = document.getElementById(\"identifierError\");\n      const continueBtn = document.getElementById(\"continue1\");\n\n      function update() {\n        state.identify.identifier = input.value;\n        const { ok, reason } = validateIdentifier(input.value);\n        input.setAttribute(\"aria-invalid\", ok ? \"false\" : \"true\");\n        errorEl.textContent = ok ? \"\" : reason;\n        continueBtn.disabled = !ok;\n        saveState(false);\n      }\n\n      input.addEventListener(\"input\", update);\n      update();\n\n      document.getElementById(\"identifyForm\").addEventListener(\"submit\", (e) => {\n        e.preventDefault();\n        const { ok, reason } = validateIdentifier(input.value);\n        if (!ok) {\n          errorEl.textContent = reason;\n          input.setAttribute(\"aria-invalid\", \"true\");\n          input.focus();\n          showError(reason);\n          return;\n        }\n        // [Mocking] Simulate sending the recovery code\n        console.log(`[Mock] Sending recovery code ${FIXED_CODE} to \"${state.identify.identifier}\"`);\n        state.verify.code = \"\";\n        state.info.lastMessage = \"We sent a code. Check your messages or the browser console in this demo.\";\n        saveState(true, \"Code sent. When you’re ready, enter it on the next step.\");\n        goToStep(2);\n      });\n\n      document.getElementById(\"save1\").addEventListener(\"click\", () => {\n        saveState(true);\n      });\n      document.getElementById(\"helpInline1\").addEventListener(\"click\", openHelp);\n    }\n\n    function renderStep2() {\n      const container = document.getElementById(\"app\");\n      container.innerHTML = `\n        <h2 class=\"section-title\" data-step-heading tabindex=\"-1\">Step 2 of 4 — Enter the 6-digit code</h2>\n        <div class=\"note\" id=\"codeSentNote\">\n          <p>${escapeHTML(state.info.lastMessage || \"We sent a 6-digit code. In this demo, it’s shown in the console.\")}</p>\n        </div>\n        <form id=\"codeForm\" novalidate>\n          <div class=\"field\">\n            <label for=\"code\">Verification code</label>\n            <input id=\"code\" name=\"code\" type=\"text\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\"\n                   aria-describedby=\"codeHint codeError\" autocomplete=\"one-time-code\"\n                   value=\"${escapeHTML(state.verify.code)}\">\n            <div id=\"codeHint\" class=\"hint\">Enter 6 numbers. Tip: open the browser console to see the demo code.</div>\n            <div id=\"codeError\" class=\"error\" aria-live=\"assertive\"></div>\n          </div>\n          <div class=\"actions\">\n            <button type=\"button\" id=\"back2\" class=\"btn secondary\">Back</button>\n            <button type=\"submit\" id=\"continue2\" class=\"btn\">Continue</button>\n            <button type=\"button\" id=\"resend2\" class=\"btn ghost\">Resend code</button>\n            <button type=\"button\" id=\"save2\" class=\"btn secondary\">Save and return later</button>\n          </div>\n          <div class=\"meta-actions\">\n            <button type=\"button\" id=\"helpInline2\" class=\"btn ghost\">Need help?</button>\n          </div>\n        </form>\n      `;\n      const input = document.getElementById(\"code\");\n      const errorEl = document.getElementById(\"codeError\");\n\n      function update() {\n        state.verify.code = input.value.replace(/\\D+/g, \"\").slice(0,6);\n        input.value = state.verify.code;\n        saveState(false);\n      }\n      input.addEventListener(\"input\", update);\n\n      document.getElementById(\"back2\").addEventListener(\"click\", () => goToStep(1));\n      document.getElementById(\"resend2\").addEventListener(\"click\", () => {\n        console.log(`[Mock] Resending recovery code ${FIXED_CODE} to \"${state.identify.identifier}\"`);\n        state.info.lastMessage = \"We re-sent the code. It’s also shown in the browser console.\";\n        saveState(false);\n        showStatus(\"Code re-sent. Check your messages or the console.\");\n        const note = document.getElementById(\"codeSentNote\");\n        if (note) note.innerHTML = `<p>${escapeHTML(state.info.lastMessage)}</p>`;\n      });\n      document.getElementById(\"save2\").addEventListener(\"click\", () => saveState(true));\n\n      document.getElementById(\"codeForm\").addEventListener(\"submit\", (e) => {\n        e.preventDefault();\n        const { ok, reason } = validateCodeInput(input.value);\n        if (!ok) {\n          errorEl.textContent = reason;\n          input.setAttribute(\"aria-invalid\", \"true\");\n          input.focus();\n          showError(reason);\n          return;\n        }\n        input.setAttribute(\"aria-invalid\", \"false\");\n        state.info.lastMessage = \"Code verified.\";\n        saveState(false);\n        showStatus(\"Code verified. Continue to set a new password.\");\n        goToStep(3);\n      });\n\n      document.getElementById(\"helpInline2\").addEventListener(\"click\", openHelp);\n    }\n\n    function renderStep3() {\n      const container = document.getElementById(\"app\");\n      const rulesInfo = `\n        <ul class=\"rule-list\" id=\"pwRules\">\n          <li id=\"rLength\" class=\"fail\">At least 8 characters</li>\n          <li id=\"rLower\" class=\"fail\">At least one lowercase letter</li>\n          <li id=\"rUpper\" class=\"fail\">At least one uppercase letter</li>\n          <li id=\"rNumber\" class=\"fail\">At least one number</li>\n          <li id=\"rSpecial\" class=\"fail\">At least one symbol (e.g., ! ? #)</li>\n        </ul>\n      `;\n      container.innerHTML = `\n        <h2 class=\"section-title\" data-step-heading tabindex=\"-1\">Step 3 of 4 — Create a new password</h2>\n        <p>Make a password that’s easy for you to remember and hard for others to guess.</p>\n        <form id=\"passwordForm\" novalidate>\n          <div class=\"field\">\n            <label for=\"pw\">New password</label>\n            <input id=\"pw\" name=\"pw\" type=\"password\" autocomplete=\"new-password\"\n                   aria-describedby=\"pwHint pwError\"\n                   value=\"${escapeHTML(state.password.pw)}\">\n            <div id=\"pwHint\" class=\"hint\">\n              Password rules:\n              ${rulesInfo}\n              <div>Strength: <span id=\"strength\" class=\"strength\">Weak</span></div>\n            </div>\n            <div id=\"pwError\" class=\"error\" aria-live=\"assertive\"></div>\n          </div>\n          <div class=\"field\">\n            <label for=\"confirm\">Confirm new password</label>\n            <input id=\"confirm\" name=\"confirm\" type=\"password\" autocomplete=\"new-password\"\n                   aria-describedby=\"confirmHint confirmError\"\n                   value=\"${escapeHTML(state.password.confirm)}\">\n            <div id=\"confirmHint\" class=\"hint\">Re-enter the same password.</div>\n            <div id=\"confirmError\" class=\"error\" aria-live=\"assertive\"></div>\n          </div>\n          <div class=\"actions\">\n            <button type=\"button\" id=\"back3\" class=\"btn secondary\">Back</button>\n            <button type=\"submit\" id=\"continue3\" class=\"btn\" disabled>Continue</button>\n            <button type=\"button\" id=\"save3\" class=\"btn secondary\">Save and return later</button>\n          </div>\n          <div class=\"meta-actions\">\n            <button type=\"button\" id=\"helpInline3\" class=\"btn ghost\">Need help?</button>\n          </div>\n        </form>\n      `;\n\n      const pw = document.getElementById(\"pw\");\n      const confirm = document.getElementById(\"confirm\");\n      const strengthEl = document.getElementById(\"strength\");\n      const continueBtn = document.getElementById(\"continue3\");\n      const pwError = document.getElementById(\"pwError\");\n      const confirmError = document.getElementById(\"confirmError\");\n\n      const ruleEls = {\n        length: document.getElementById(\"rLength\"),\n        lower: document.getElementById(\"rLower\"),\n        upper: document.getElementById(\"rUpper\"),\n        number: document.getElementById(\"rNumber\"),\n        special: document.getElementById(\"rSpecial\"),\n      };\n\n      function update() {\n        state.password.pw = pw.value;\n        state.password.confirm = confirm.value;\n        const v = validatePassword(pw.value, confirm.value);\n        // Update rule UI\n        const pr = passwordRules(pw.value);\n        ruleEls.length.className = pr.rules.length ? \"pass\" : \"fail\";\n        ruleEls.lower.className = pr.rules.lower ? \"pass\" : \"fail\";\n        ruleEls.upper.className = pr.rules.upper ? \"pass\" : \"fail\";\n        ruleEls.number.className = pr.rules.number ? \"pass\" : \"fail\";\n        ruleEls.special.className = pr.rules.special ? \"pass\" : \"fail\";\n        // Strength UI\n        strengthEl.textContent = pr.strength.charAt(0).toUpperCase() + pr.strength.slice(1);\n        strengthEl.className = `strength ${pr.strength}`;\n        // Errors and buttons\n        pw.setAttribute(\"aria-invalid\", v.ok || pw.value.length === 0 ? \"false\" : \"true\");\n        confirm.setAttribute(\"aria-invalid\", v.ok || confirm.value.length === 0 ? \"false\" : \"true\");\n        pwError.textContent = (!v.ok && pw.value.length > 0) ? (v.reason.includes(\"rules\") || v.reason.includes(\"weak\") ? \"Please meet the rules above.\" : \"\") : \"\";\n        confirmError.textContent = (confirm.value.length > 0 && confirm.value !== pw.value) ? \"Passwords don’t match.\" : \"\";\n        continueBtn.disabled = !v.ok;\n        saveState(false);\n      }\n\n      pw.addEventListener(\"input\", update);\n      confirm.addEventListener(\"input\", update);\n      update();\n\n      document.getElementById(\"back3\").addEventListener(\"click\", () => goToStep(2));\n      document.getElementById(\"save3\").addEventListener(\"click\", () => saveState(true));\n      document.getElementById(\"passwordForm\").addEventListener(\"submit\", (e) => {\n        e.preventDefault();\n        const v = validatePassword(pw.value, confirm.value);\n        if (!v.ok) {\n          showError(v.reason || \"Please fix the errors and try again.\");\n          return;\n        }\n        state.info.lastMessage = \"Password set successfully.\";\n        saveState(false);\n        showStatus(\"Password set. You’re almost done.\");\n        goToStep(4);\n      });\n\n      document.getElementById(\"helpInline3\").addEventListener(\"click\", openHelp);\n    }\n\n    function renderStep4() {\n      const container = document.getElementById(\"app\");\n      container.innerHTML = `\n        <h2 class=\"section-title\" data-step-heading tabindex=\"-1\">Step 4 of 4 — All set</h2>\n        <p class=\"success\">Your password has been reset.</p>\n        <p>Next step: Log in with your new password to accept the updated privacy statement.</p>\n        <div class=\"actions\">\n          <button type=\"button\" id=\"loginBtn\" class=\"btn\">Go to login (placeholder)</button>\n          <button type=\"button\" id=\"back4\" class=\"btn secondary\">Back</button>\n          <button type=\"button\" id=\"restart4\" class=\"btn ghost\">Start over</button>\n          <button type=\"button\" id=\"save4\" class=\"btn secondary\">Save and return later</button>\n        </div>\n        <div class=\"meta-actions\">\n          <button type=\"button\" id=\"helpInline4\" class=\"btn ghost\">Need help?</button>\n        </div>\n      `;\n      document.getElementById(\"loginBtn\").addEventListener(\"click\", () => {\n        console.log(\"[Mock] Navigate to login (placeholder). No navigation in this demo.\");\n        showStatus(\"Login is a placeholder in this demo.\");\n      });\n      document.getElementById(\"back4\").addEventListener(\"click\", () => goToStep(3));\n      document.getElementById(\"restart4\").addEventListener(\"click\", startOver);\n      document.getElementById(\"save4\").addEventListener(\"click\", () => saveState(true));\n      document.getElementById(\"helpInline4\").addEventListener(\"click\", openHelp);\n    }\n\n    /* [Rendering] Main render switch */\n    function render() {\n      updateProgressHeader();\n      if (state.step === 1) return renderStep1();\n      if (state.step === 2) return renderStep2();\n      if (state.step === 3) return renderStep3();\n      return renderStep4();\n    }\n\n    /* [Help panel] Open/Close with focus management; ESC to close */\n    let helpTriggerEl = null;\n    function openHelp(ev) {\n      helpTriggerEl = ev && ev.target ? ev.target : document.getElementById(\"helpBtn\");\n      const overlay = document.getElementById(\"helpOverlay\");\n      const panel = document.getElementById(\"helpPanel\");\n      overlay.hidden = false;\n      panel.hidden = false;\n      overlay.classList.add(\"open\");\n      panel.classList.add(\"open\");\n      document.getElementById(\"helpBtn\").setAttribute(\"aria-expanded\", \"true\");\n      // Move focus inside\n      panel.focus();\n      // Close handlers\n      overlay.addEventListener(\"click\", closeHelp, { once: true });\n      document.addEventListener(\"keydown\", escCloseHandler);\n    }\n    function closeHelp() {\n      const overlay = document.getElementById(\"helpOverlay\");\n      const panel = document.getElementById(\"helpPanel\");\n      overlay.classList.remove(\"open\");\n      panel.classList.remove(\"open\");\n      overlay.hidden = true;\n      panel.hidden = true;\n      document.getElementById(\"helpBtn\").setAttribute(\"aria-expanded\", \"false\");\n      document.removeEventListener(\"keydown\", escCloseHandler);\n      if (helpTriggerEl) helpTriggerEl.focus();\n    }\n    function escCloseHandler(e) {\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        closeHelp();\n      }\n    }\n\n    /* [Helpers] Escape HTML for safe re-rendering of input values */\n    function escapeHTML(str) {\n      return String(str ?? \"\")\n        .replaceAll(\"&\", \"&amp;\")\n        .replaceAll(\"<\", \"&lt;\")\n        .replaceAll(\">\", \"&gt;\")\n        .replaceAll('\"', \"&quot;\")\n        .replaceAll(\"'\", \"&#39;\");\n    }\n\n    /* [Init] Wire global controls and render current step */\n    (function init() {\n      // Header buttons\n      document.getElementById(\"startOverBtn\").addEventListener(\"click\", startOver);\n      document.getElementById(\"helpBtn\").addEventListener(\"click\", openHelp);\n      document.getElementById(\"closeHelpBtn\").addEventListener(\"click\", closeHelp);\n\n      // First render\n      render();\n      updateProgressHeader();\n\n      // Restore reassurance note if we have savedAt\n      if (state.savedAt) {\n        showPersistentNote(\"Your progress is saved on this device.\");\n      }\n    })();\n\n  </script>\n\n  <!--\n    Manual Test Checklist (for evaluators) — No build, offline, client-only\n    1. Load file offline. App renders with Step 1 and progress shows 1/4.\n    2. Keyboard nav:\n       - Use Tab to reach \"Skip to main content\", press Enter: focus jumps to main.\n       - Tab through inputs; visible focus outline appears.\n       - Open Help with keyboard; close with ESC; focus returns to trigger.\n    3. Step 1:\n       - Enter invalid identifier; Continue stays disabled and inline error appears.\n       - Enter valid email or username; Continue enables.\n       - Click Continue: console logs code 246810; navigates to Step 2; status message announced.\n       - Click Save and return later: persistent note appears; reload page, progress and values persist.\n    4. Step 2:\n       - Resend code: console logs 246810; note updates; no timers.\n       - Enter wrong code: inline error; cannot proceed.\n       - Enter 246810: proceeds to Step 3.\n       - Back returns to Step 1 with entered identifier preserved.\n    5. Step 3:\n       - Type password; strength indicator updates; rules toggle pass/fail.\n       - Mismatch confirm blocks Continue with inline error.\n       - Weak or rule-breaking password blocks Continue.\n       - Valid + matching enables Continue, proceeding to Step 4.\n    6. Step 4:\n       - “Go to login” logs a placeholder message; no navigation.\n       - Back returns to Step 3 without losing data.\n       - Start over clears localStorage and returns to Step 1.\n    7. ARIA:\n       - Status and error messages are exposed via aria-live regions.\n       - Progress uses aria-current=\"step\".\n    8. No time-based behavior (no countdowns, no expiries). All actions are user-paced.\n  -->\n", "task_list": [], "evaluator_md": "SUMMARY:\nThe artifact is a single, self-contained index.html implementing a clear, 4-step, client-only password recovery flow with deterministic mocking, strong accessibility affordances, and ADHD-friendly UX. It uses semantic HTML, inline CSS/JS, console-based “delivery,” progress persistence via localStorage, and helpful guidance at each step. No back-end or time-based behavior is used. Overall, it meets the stated requirements and inclusivity goals.\n\nFUNCTIONAL_CHECK:\n- AC1 Single-file deliverable with inline CSS & JS and no build step: PASS — One index.html with all logic and styles inline.\n- AC2 Spec-mapping comments present: PASS — Labeled comments such as [Inclusivity], [Mocking], [Flow], [Accessibility], [Persistence] appear throughout.\n- AC3 Client-only with deterministic mocked recovery: PASS — FIXED_CODE=\"246810\"; sending/resending and login are simulated via console.log; no network calls.\n- AC4 Four-step flow with visible progress and aria-current: PASS — Steps 1–4 rendered with 1/4..4/4 labels; aria-current is updated per step.\n- AC5 Step 1 Identify with validation and clear feedback: PASS — Email/username validated; inline errors, aria-invalid, and disabled Continue until valid; clear hint text.\n- AC6 Step 2 Code entry with resend and validation: PASS — 6-digit numeric enforced; wrong code yields inline error; resend logs code and updates status; back navigation available.\n- AC7 Step 3 New password with rules, strength, and confirm: PASS — Live rules checklist, strength meter, matching confirm; Continue disabled until valid.\n- AC8 Step 4 Completion with next step guidance: PASS — Success message and clear next action (“Go to login (placeholder)”).\n- AC9 Persistence: Save & return later and auto-save: PASS — localStorage persists step and inputs; explicit Save shows a persistent reassurance note; state restored on reload.\n- AC10 Accessibility fundamentals: PASS — Semantic landmarks (header/nav/main/section/aside/footer), skip link, visible focus, live regions for status/alert, focus sent to step heading, labels and aria-describedby on fields.\n- AC11 ADHD-friendly UX (simple steps, clear language, no time pressure, visible progress, back, reminders): PASS — Clear short instructions, no timers, progress always visible, back buttons preserve inputs, reassuring notes.\n- AC12 Reduced cognitive load (clean UI, high contrast, large text): PASS — 18px base font, high-contrast palette, low clutter, clear buttons.\n- AC13 Help options easy and accessible at any stage: PASS — Global Help button and per-step “Need help?” open a keyboard-accessible dialog; ESC closes; focus returns to trigger.\n- AC14 No timeouts or countdowns; user-paced: PASS — No time-based behavior anywhere.\n- AC15 Ability to restart and clear progress: PASS — “Start over” clears localStorage and returns to Step 1 with status announcement.\n- AC16 Back navigation without data loss: PASS — State is saved on input; going back preserves prior values.\n\nFAILING_ITEMS:\n- None observed against the stated requirements and derived acceptance criteria. Note: As a best-practice improvement (not a requirement), the Help dialog does not trap focus; users can tab to background content while it is open.\n\nNEW_TASKS:\n- None required. Optional improvement:\n  1) Add focus trapping within the Help dialog to prevent tabbing into the background while it is open.\n\nDECISION:\nPASS", "done": true, "iter": 1, "step": 3}
