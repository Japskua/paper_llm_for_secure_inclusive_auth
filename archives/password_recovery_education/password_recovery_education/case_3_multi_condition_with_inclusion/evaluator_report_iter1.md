SUMMARY:
The artifact is a single-file Bun HTTPS server that serves a SPA for password recovery and login, designed with strong security controls and inclusive UX. It meets most functional and security requirements: HTTPS with HSTS, CSP with nonce, CSRF tokens on sensitive POSTs, bcrypt password hashing, MFA, rate limiting, strong password policy, and a full reset flow including manual code entry and simulated delivery via in-browser logs. Two issues stand out: a CSRF gap on a GET endpoint that mutates session state, and the presence of an inline script which conflicts with the “no inline scripts” XSS requirement (even though it’s nonce-protected).

FUNCTIONAL_CHECK:
- Single-file deliverable (Bun server + UI in one app.ts): PASS — Entire app exists in app.ts; no external assets.
- TLS and certificate usage (certs/cert.pem, certs/key.pem) with HTTPS enforced: PASS — HTTPS on 3443 with HSTS; HTTP on 3000 redirects to HTTPS.
- SPA with HTML+CSS+vanilla JS, interactivity works in browser: PASS — Hash routing; UI renders and works with fetch to local APIs.
- Password recovery flow: start -> preview -> manual/auto verify -> set password: PASS — All steps implemented; manual code entry supported.
- Simulated delivery via console.log in the browser (token/code shown): PASS — Tokens and links logged in the on-page Logs panel and console.
- Internal navigation links function: PASS — Toolbar links, verify flow, and “Open verification screen” work.
- Inclusivity: clear language, bullet points, readable fonts, high contrast, read aloud, copy helpers, simple feedback: PASS — Implemented throughout; ARIA live region present.
- Timeouts/deadlines visibility: PASS — Link expiry communicated (“about 10 minutes”) and exact expiry logged; no forced timeouts during password entry.
- Security: CSRF enforced with unique per-session tokens on sensitive requests: FAIL — GET /api/reset/preview mutates session without CSRF.
- Security: XSS mitigations (sanitize inputs, escape outputs, no inline or untrusted scripts): FAIL — Inline script is used (nonce-protected), violating “no inline scripts” criterion; output is safely rendered via textContent.
- Security: Misconfiguration protections (HSTS, CSP, secure headers, frame-ancestors, nosniff): PASS — Strong headers configured.
- Security: Password reset tokens (random, single-use, short-lived): PASS — 24-byte random hex; single-use, 10-minute expiry.
- Security: Identification & Authentication (bcrypt, strong password policy, MFA/SSO, throttling/lockout): PASS — bcrypt; policy checks; MFA; throttling on login/MFA/reset.
- Security: No PII leakage (usernames/emails not exposed), generic messages: PASS — Generic responses; no info leaks.
- SSRF/Open redirect protections: PASS — No external redirects or URL fetches; no open redirects.
- No external network calls or build tools: PASS — All local; no external calls.

FAILING_ITEMS:
- CSRF on GET /api/reset/preview: This endpoint changes session state (sets session.resetPreviewToken) without CSRF protection and via GET. Requirement states CSRF tokens must be validated on all sensitive requests; mutation should not occur on a CSRF-exempt GET.
- Inline script present: The SPA JavaScript is embedded inline (though nonce-protected). The security requirement states “No inline or untrusted scripts are allowed.” This conflicts with current implementation.

NEW_TASKS:
1. Eliminate session mutation on CSRF-exempt GET:
   - Option A: Convert /api/reset/preview to POST with CSRF validation and body { token }, and keep setting session.resetPreviewToken in that POST.
   - Option B: Keep /api/reset/preview as GET but do not mutate session in this route. Only validate and return ok/err. Require users to POST /api/reset/verify with the token they paste.
   - Update verifyView to use the chosen approach (send CSRF header and POST body when needed).
2. Remove inline script to satisfy “No inline scripts”:
   - Serve the SPA JavaScript from a dedicated route (e.g., GET /app.js) generated by app.ts (no extra files on disk).
   - Replace the inline <script> with <script src="/app.js" defer></script>.
   - Adjust CSP to allow script-src 'self' (and remove reliance on inline nonce for scripts). Keep strict CSP otherwise.
   - Ensure no inline event handlers are introduced and that all DOM updates remain text-only (textContent).

DECISION:
FAIL