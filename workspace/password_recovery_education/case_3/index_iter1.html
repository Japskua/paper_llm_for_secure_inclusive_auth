
<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    Password Recovery System — Single-Page, Client-Only, Mocked
    This file implements the full flow per the Requirements.
    - All logic runs in-browser. No servers or external requests.
    - “Delivery” and verification use deterministic mock values + console.log.
    - Inclusive UX for dyslexia: plain language, readable layout, TTS, copy helpers, clear steps, forgiving interactions.
  -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Password Reset and Submission (Mock Demo)</title>
  <style>
    /* ===============================
       [Inclusivity + Readability Basics]
       - High contrast
       - Large, readable text
       - Generous spacing
       - No italics / all-caps
       - Clear focus styles
       =============================== */
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#444444;
      --accent:#175fe6;     /* Accessible blue */
      --accent-ink:#ffffff;
      --ok:#1b8d4f;
      --warn:#b85c00;
      --error:#b00020;
      --soft:#f5f7fb;
      --border:#dce3ef;
      --focus:#ffbf47;      /* Strong focus indicator */
    }
    html, body { background: var(--bg); color: var(--text); }
    html { font-size: 18px; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height: 1.6;
      letter-spacing: 0.01em;
    }
    body.large-text { font-size: 20px; }
    * { box-sizing: border-box; }
    .container { max-width: 880px; margin: 0 auto; padding: 1rem; }
    header {
      position: sticky; top: 0; z-index: 2;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
    }
    h1, h2, h3 {
      margin: 0.2rem 0 0.4rem 0;
      letter-spacing: 0.005em;
      font-weight: 700;
    }
    p { margin: 0.3rem 0 0.6rem 0; }
    ul { margin: 0.3rem 0 0.6rem 1.2rem; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    /* Focus and interactive elements */
    a, button, input, select, textarea {
      font: inherit; color: inherit;
    }
    :focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
      border-radius: 2px;
    }
    /* Preference bar */
    .prefbar {
      display: flex; gap: 0.5rem; flex-wrap: wrap;
      padding: 0.6rem 0; align-items: center; justify-content: space-between;
    }
    .prefbar .left, .prefbar .right { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; }
    .pill {
      border: 1px solid var(--border);
      background: var(--soft);
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      display: inline-flex; align-items: center; gap: 0.4rem;
    }
    .pill input[type="checkbox"] { transform: scale(1.1); }
    .deadline {
      display: inline-flex; align-items: center; gap: 0.5rem;
      padding: 0.35rem 0.6rem; border-radius: 0.6rem;
      background: #fff7e6; color: #5a3d00; border: 1px solid #ffd88a;
      font-weight: 600;
    }
    .deadline small { font-weight: 400; color: #7a5d1a; }
    /* Stepper */
    .stepper {
      display: grid; grid-template-columns: repeat(5, 1fr);
      gap: 0.4rem; margin: 0.6rem 0 0.8rem 0;
    }
    .step {
      display: flex; flex-direction: column; gap: 0.25rem;
      align-items: flex-start; border: 1px dashed var(--border); border-radius: 0.6rem;
      padding: 0.5rem; background: #fff;
    }
    .step .num {
      width: 1.6rem; height: 1.6rem; border-radius: 50%;
      display: grid; place-items: center;
      background: var(--soft);
      border: 1px solid var(--border);
      font-weight: 700;
    }
    .step.active { border-style: solid; border-color: var(--accent); background: #f0f6ff; }
    .step.done { border-style: solid; border-color: var(--ok); background: #f3fcf7; }
    .step small { color: var(--muted); }
    /* Cards / sections */
    .card {
      border: 1px solid var(--border); background: #fff; border-radius: 0.8rem;
      padding: 1rem; margin: 0.8rem 0;
    }
    .section-title { display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; }
    .helpers { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .btn, button[type=button], input[type=submit] {
      appearance: none; border: none; cursor: pointer;
      background: var(--accent); color: var(--accent-ink);
      padding: 0.65rem 0.9rem; border-radius: 0.6rem;
      font-weight: 700; letter-spacing: 0.01em;
    }
    .btn.secondary {
      background: #e9eef9; color: #0f3f9e; border: 1px solid var(--border);
    }
    .btn.ghost {
      background: transparent; color: var(--accent); border: 1px dashed var(--accent);
    }
    .btn.warn { background: var(--warn); color: #fff; }
    .btn.ok { background: var(--ok); color: #fff; }
    .row { display: flex; gap: 0.6rem; flex-wrap: wrap; align-items: center; }
    /* Forms */
    .field { margin: 0.6rem 0; }
    label { display: block; font-weight: 700; margin-bottom: 0.25rem; }
    .hint { color: var(--muted); font-size: 0.95rem; }
    .error { color: var(--error); font-weight: 700; margin-top: 0.25rem; }
    .oktext { color: var(--ok); font-weight: 700; }
    input[type=text], input[type=email], input[type=password], input[type=number], select, textarea {
      width: 100%; padding: 0.6rem 0.7rem; border-radius: 0.6rem;
      border: 1px solid var(--border); background: #fff;
    }
    input::placeholder { color: #8a8f99; }
    .inline { display: flex; align-items: center; gap: 0.5rem; }
    .input-with-btn {
      display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; align-items: center;
    }
    .pw-row { display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; }
    .req-list {
      display: grid; gap: 0.25rem; margin-top: 0.5rem;
      list-style: none; padding: 0;
    }
    .req-list li { display: flex; align-items: center; gap: 0.4rem; }
    .req-ok::before { content: "✔"; color: var(--ok); font-weight: 900; }
    .req-bad::before { content: "•"; color: var(--muted); }
    .meter {
      height: 8px; border-radius: 6px; background: #ecf0f7; overflow: hidden;
      margin: 0.5rem 0;
    }
    .meter > span { display: block; height: 100%; background: var(--warn); width: 10%; transition: width 120ms linear, background 120ms linear; }
    .meter.good > span { background: var(--ok); }
    /* Code input styling kept simple for reduced cognitive load */
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; letter-spacing: 0.08em; }
    /* File upload */
    .drop {
      border: 2px dashed var(--border); border-radius: 0.8rem; padding: 1rem;
      background: #fbfcff;
      text-align: center;
    }
    .drop.drag { background: #eef4ff; border-color: var(--accent); }
    .muted { color: var(--muted); }
    /* Status area */
    .status { margin: 0.6rem 0; }
    [aria-live] { min-height: 1.2em; }
    /* Footer help */
    footer { margin: 2rem 0 3rem 0; color: var(--muted); font-size: 0.95rem; }
    .no-timeout {
      background: #eaf7ff; border: 1px solid #bfe3ff; color: #0b3b59;
      padding: 0.6rem 0.8rem; border-radius: 0.6rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="prefbar" aria-label="Quick settings">
        <div class="left">
          <div class="pill">
            <input id="toggleLargeText" type="checkbox" />
            <label for="toggleLargeText">Large text</label>
          </div>
          <div class="pill">
            <input id="toggleCalm" type="checkbox" />
            <label for="toggleCalm">Calm mode</label>
          </div>
        </div>
        <div class="right" role="status" aria-live="polite" aria-atomic="true">
          <div class="deadline" title="Local time to midnight">
            ⏰ Deadline: <span id="midnightCountdown">calculating…</span>
            <small>(this page will not log you out)</small>
          </div>
        </div>
      </div>

      <h1>Password reset and assignment upload</h1>
      <p class="hint">Short steps. Clear messages. You can listen to the text or copy it.</p>

      <nav aria-label="Progress">
        <div class="stepper" id="stepper">
          <div class="step active" data-step="1">
            <div class="num">1</div>
            <strong>Find account</strong>
            <small>Enter email</small>
          </div>
          <div class="step" data-step="2">
            <div class="num">2</div>
            <strong>Get code</strong>
            <small>Check email</small>
          </div>
          <div class="step" data-step="3">
            <div class="num">3</div>
            <strong>New password</strong>
            <small>Type once, confirm</small>
          </div>
          <div class="step" data-step="4">
            <div class="num">4</div>
            <strong>Log in</strong>
            <small>Use new password</small>
          </div>
          <div class="step" data-step="5">
            <div class="num">5</div>
            <strong>Submit file</strong>
            <small>Pick course</small>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- ===============================
         [Step 1] Find account
         - Plain instructions
         - Copy + Read Aloud
         - Deterministic mock delivery logged to console
         =============================== -->
    <section class="card" id="step1" aria-labelledby="s1h">
      <div class="section-title">
        <h2 id="s1h">Step 1 — Find your account</h2>
        <div class="helpers">
          <button class="btn secondary" type="button" data-tts="#s1text">Read aloud</button>
          <button class="btn secondary" type="button" data-copy="#s1text">Copy text</button>
        </div>
      </div>
      <div id="s1text">
        <ul>
          <li>Type your school email. Any valid email works in this demo.</li>
          <li>We will send a 6‑digit code. In this demo, it goes to the console.</li>
          <li>Next, enter that code.</li>
        </ul>
      </div>
      <form id="formAccount" class="form" autocomplete="on" novalidate>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" inputmode="email" placeholder="name@school.edu" required />
          <div class="hint">Example: alex@student.university.edu</div>
        </div>
        <div class="row">
          <button class="btn" type="submit">Send reset code</button>
          <button class="btn ghost" type="button" id="prefillAlex">Use Alex’s example</button>
        </div>
        <div class="status" aria-live="polite" id="s1status"></div>
      </form>
    </section>

    <!-- ===============================
         [Step 2] Verify code
         - Simple single input (less error-prone)
         - Resend logs same deterministic code
         - Read aloud + copy
         =============================== -->
    <section class="card" id="step2" aria-labelledby="s2h" hidden>
      <div class="section-title">
        <h2 id="s2h">Step 2 — Enter the 6‑digit code</h2>
        <div class="helpers">
          <button class="btn secondary" type="button" data-tts="#s2text">Read aloud</button>
          <button class="btn secondary" type="button" data-copy="#s2text">Copy text</button>
        </div>
      </div>
      <div id="s2text">
        <ul>
          <li>Check your email for the 6‑digit code.</li>
          <li>In this demo, the code is printed in the browser console.</li>
          <li>You can paste the whole code. Spaces are okay.</li>
        </ul>
      </div>
      <form id="formCode" novalidate>
        <div class="field">
          <label for="code" class="inline">Code
            <span class="hint">(6 digits)</span>
          </label>
          <div class="input-with-btn">
            <input id="code" class="mono" inputmode="numeric" autocomplete="one-time-code" placeholder="000000" maxlength="12" />
            <button class="btn secondary" type="button" id="resendCode">Resend code</button>
          </div>
          <div class="hint">Tip: open your console (F12) to see the mock code.</div>
          <div class="row" style="margin-top:0.4rem;">
            <button class="btn ghost" type="button" id="showMockCode" aria-live="polite">Reveal code (demo)</button>
          </div>
        </div>
        <div class="row">
          <button class="btn" type="submit">Verify</button>
          <button class="btn secondary" type="button" data-back="#step1">Back</button>
        </div>
        <div class="status" aria-live="polite" id="s2status"></div>
      </form>
    </section>

    <!-- ===============================
         [Step 3] New password
         - Short rules; live feedback; show/hide
         - Suggest easy passphrase
         - Read aloud + copy
         =============================== -->
    <section class="card" id="step3" aria-labelledby="s3h" hidden>
      <div class="section-title">
        <h2 id="s3h">Step 3 — Make a new password</h2>
        <div class="helpers">
          <button class="btn secondary" type="button" data-tts="#s3text">Read aloud</button>
          <button class="btn secondary" type="button" data-copy="#s3text">Copy text</button>
        </div>
      </div>
      <div id="s3text">
        <ul>
          <li>Use at least 8 characters.</li>
          <li>Include letters and a number.</li>
          <li>Type it once. Then confirm.</li>
        </ul>
      </div>
      <form id="formPassword" novalidate>
        <div class="field">
          <label for="pw1">New password</label>
          <div class="pw-row">
            <input id="pw1" type="password" autocomplete="new-password" aria-describedby="pwReq" />
            <button class="btn secondary" type="button" data-toggles="#pw1">Show</button>
          </div>
          <div class="meter" id="pwMeter" aria-hidden="true"><span></span></div>
          <ul id="pwReq" class="req-list">
            <li id="reqLen" class="req-bad">8 or more characters</li>
            <li id="reqAlpha" class="req-bad">At least one letter</li>
            <li id="reqNum" class="req-bad">At least one number</li>
          </ul>
          <div class="row" style="margin-top:0.4rem;">
            <button class="btn ghost" type="button" id="suggestPW" aria-describedby="suggestHint">Use easy passphrase: green-robot-27</button>
            <span id="suggestHint" class="hint">You can edit it.</span>
          </div>
        </div>

        <div class="field">
          <label for="pw2">Confirm password</label>
          <div class="pw-row">
            <input id="pw2" type="password" autocomplete="new-password" />
            <button class="btn secondary" type="button" data-toggles="#pw2">Show</button>
          </div>
          <div id="matchMsg" class="hint">We will check that both match.</div>
        </div>

        <div class="row">
          <button class="btn" type="submit" id="savePW" disabled>Save new password</button>
          <button class="btn secondary" type="button" data-back="#step2">Back</button>
        </div>
        <div class="status" aria-live="polite" id="s3status"></div>
      </form>
    </section>

    <!-- ===============================
         [Step 4] Log in with new password
         - Prefill email; show/hide password
         - Clear error help
         =============================== -->
    <section class="card" id="step4" aria-labelledby="s4h" hidden>
      <div class="section-title">
        <h2 id="s4h">Step 4 — Log in</h2>
        <div class="helpers">
          <button class="btn secondary" type="button" data-tts="#s4text">Read aloud</button>
          <button class="btn secondary" type="button" data-copy="#s4text">Copy text</button>
        </div>
      </div>
      <div id="s4text">
        <ul>
          <li>Your email is filled in.</li>
          <li>Type your new password. You can show it to check.</li>
        </ul>
      </div>
      <form id="formLogin" novalidate>
        <div class="field">
          <label for="loginEmail">Email</label>
          <input id="loginEmail" type="email" autocomplete="username" />
        </div>
        <div class="field">
          <label for="loginPw">Password</label>
          <div class="pw-row">
            <input id="loginPw" type="password" autocomplete="current-password" />
            <button class="btn secondary" type="button" data-toggles="#loginPw">Show</button>
          </div>
          <div class="hint">If it does not work, you can go back and reset again.</div>
        </div>
        <div class="row">
          <button class="btn" type="submit">Log in</button>
          <button class="btn secondary" type="button" data-back="#step3">Back</button>
        </div>
        <div class="status" aria-live="polite" id="s4status"></div>
      </form>
    </section>

    <!-- ===============================
         [Step 5] Submit assignment
         - Simple course selection
         - Clear file upload
         - Deadline countdown visible
         - No timeouts enforced
         =============================== -->
    <section class="card" id="step5" aria-labelledby="s5h" hidden>
      <div class="section-title">
        <h2 id="s5h">Step 5 — Submit your assignment</h2>
        <div class="helpers">
          <button class="btn secondary" type="button" data-tts="#s5text">Read aloud</button>
          <button class="btn secondary" type="button" data-copy="#s5text">Copy text</button>
        </div>
      </div>
      <div id="s5text">
        <ul>
          <li>Select your course. Then add your file.</li>
          <li>You can replace the file before you submit.</li>
          <li>The countdown shows time to midnight. This page will not log you out.</li>
        </ul>
      </div>

      <form id="formSubmit" novalidate>
        <div class="field">
          <label for="course">Course</label>
          <select id="course">
            <option value="AI101">AI 101 — Intro to AI</option>
            <option value="CS105">CS 105 — Programming Basics</option>
            <option value="DS220">DS 220 — Data Science</option>
          </select>
        </div>

        <div class="field">
          <label for="file">Your file</label>
          <div class="drop" id="dropArea" aria-label="Dropzone">
            <p class="muted">Drag and drop your file here, or</p>
            <p><input id="file" type="file" accept=".pdf,.doc,.docx,.zip" /></p>
            <p class="hint">Tip: Name it like “lastname-assignment-1.pdf”.</p>
          </div>
          <div id="fileInfo" class="hint"></div>
        </div>

        <div class="row">
          <button class="btn" type="submit" id="btnSubmit" disabled>Submit file</button>
          <button class="btn secondary" type="button" id="btnReplace" disabled>Replace file</button>
        </div>
        <div class="status" aria-live="polite" id="s5status"></div>
      </form>
    </section>

    <!-- ===============================
         Support + reassurance
         =============================== -->
    <section class="card">
      <div class="no-timeout" role="status" aria-live="polite">
        This page will not log you out. Take your time. The countdown is for your awareness only.
      </div>
      <p class="hint" style="margin-top:0.6rem;">
        Need to keep instructions? Use “Copy text” above, or “Read aloud” to listen. You can pause or stop at any time.
      </p>
    </section>
  </main>

  <footer class="container">
    <!--
      [Commented mapping to spec]
      - Use-case: Alex can quickly reset his password and submit before midnight: steps 1–5.
      - Inclusivity: Plain language, short bullets, high contrast, focus styles, TTS, copy buttons, show/hide passwords, simple errors.
      - Deterministic mocks: Code is fixed as 246810; delivery via console.log; resend logs same code.
      - Time visibility: Countdown to midnight shown at top and reassured no auto-timeouts.
      - Client-only: No external calls. All logic in this file.
    -->
    <p class="muted">Demo only. Do not use real passwords here.</p>
  </footer>

  <script>
    /* ===============================
       [Global State + Deterministic Mocks]
       =============================== */
    const MOCK_CODE = "246810"; // deterministic mock value
    let savedEmail = "";
    let savedPassword = "";
    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));

    /* ===============================
       [Accessibility Helpers: TTS + Copy]
       =============================== */
    function speakText(el) {
      stopSpeak();
      const text = (typeof el === 'string' ? document.querySelector(el) : el)?.innerText || '';
      if (!text) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 1.0; // steady pace
      utter.pitch = 1.0;
      utter.onend = () => {};
      window.speechSynthesis.speak(utter);
    }
    function stopSpeak() {
      if ('speechSynthesis' in window) window.speechSynthesis.cancel();
    }
    async function copyText(el) {
      const text = (typeof el === 'string' ? document.querySelector(el) : el)?.innerText || '';
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        announce("Copied text.");
      } catch {
        announce("Copy failed. You can select and copy manually.");
      }
    }
    // Bind TTS/Copy to helper buttons
    document.addEventListener('click', (e) => {
      const ttsSel = e.target.closest('[data-tts]')?.getAttribute('data-tts');
      const copySel = e.target.closest('[data-copy]')?.getAttribute('data-copy');
      const toggleSel = e.target.closest('[data-toggles]')?.getAttribute('data-toggles');
      const backSel = e.target.closest('[data-back]')?.getAttribute('data-back');

      if (ttsSel) { speakText(ttsSel); }
      if (copySel) { copyText(copySel); }
      if (toggleSel) { togglePassword(toggleSel, e.target.closest('button')); }
      if (backSel) { goTo(backSel); }
    });

    /* ===============================
       [Preferences: Large Text + Calm Mode]
       =============================== */
    qs('#toggleLargeText').addEventListener('change', (e) => {
      document.body.classList.toggle('large-text', e.target.checked);
      localStorage.setItem('pref.largeText', e.target.checked ? '1':'0');
    });
    qs('#toggleCalm').addEventListener('change', (e) => {
      const calm = e.target.checked;
      document.querySelectorAll('.helpers').forEach(h => h.style.display = calm ? 'none' : '');
      localStorage.setItem('pref.calm', calm ? '1':'0');
    });
    // Load prefs
    (function loadPrefs(){
      if (localStorage.getItem('pref.largeText') === '1') {
        qs('#toggleLargeText').checked = true;
        document.body.classList.add('large-text');
      }
      if (localStorage.getItem('pref.calm') === '1') {
        qs('#toggleCalm').checked = true;
        document.querySelectorAll('.helpers').forEach(h => h.style.display = 'none');
      }
    })();

    /* ===============================
       [Stepper Navigation]
       =============================== */
    function setStepper(stepNum) {
      qsa('.stepper .step').forEach((el, idx) => {
        const n = idx + 1;
        el.classList.toggle('active', n === stepNum);
        el.classList.toggle('done', n < stepNum);
      });
    }
    function goTo(selectorOrEl) {
      stopSpeak();
      const targetEl = typeof selectorOrEl === 'string' ? qs(selectorOrEl) : selectorOrEl;
      const all = ['#step1', '#step2', '#step3', '#step4', '#step5'].map(qs);
      const stepNum = { step1:1, step2:2, step3:3, step4:4, step5:5 }[targetEl.id] || 1;
      all.forEach(s => s.hidden = true);
      targetEl.hidden = false;
      setStepper(stepNum);
      targetEl.scrollIntoView({ behavior: 'instant', block: 'start' });
      // Focus first input in section for quick keyboard entry
      const firstInput = targetEl.querySelector('input, select, button');
      if (firstInput) firstInput.focus({ preventScroll: true });
    }

    /* ===============================
       [Deadline Countdown: to Local Midnight]
       =============================== */
    function nextMidnight() {
      const now = new Date();
      const end = new Date(now);
      end.setHours(24,0,0,0);
      return end;
    }
    function formatLeft(ms){
      const total = Math.max(0, Math.floor(ms/1000));
      const h = Math.floor(total / 3600);
      const m = Math.floor((total % 3600) / 60);
      const s = total % 60;
      return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }
    (function startCountdown(){
      const el = qs('#midnightCountdown');
      function tick(){
        const ms = nextMidnight() - new Date();
        el.textContent = formatLeft(ms);
      }
      tick();
      setInterval(tick, 1000);
    })();

    /* ===============================
       [Announce utility for aria-live]
       =============================== */
    function announce(msg, sel) {
      const el = sel ? qs(sel) : null;
      if (el) { el.textContent = msg; }
      else {
        // find any visible status box in current step
        const visible = qsa('section.card').filter(s => !s.hidden);
        const statusEl = visible[0]?.querySelector('.status[aria-live]');
        if (statusEl) statusEl.textContent = msg;
      }
    }

    /* ===============================
       [Password Visibility Toggle]
       =============================== */
    function togglePassword(selector, btn) {
      const input = qs(selector);
      if (!input) return;
      const isPw = input.getAttribute('type') === 'password';
      input.setAttribute('type', isPw ? 'text' : 'password');
      if (btn) btn.textContent = isPw ? 'Hide' : 'Show';
      input.focus();
      input.setSelectionRange(input.value.length, input.value.length);
    }

    /* ===============================
       [Step 1] Find account (Send code)
       =============================== */
    qs('#prefillAlex').addEventListener('click', () => {
      qs('#email').value = 'alex@student.university.edu';
      qs('#email').focus();
      announce('Example email filled in.', '#s1status');
    });

    qs('#formAccount').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = qs('#email').value.trim();
      if (!email || !email.includes('@')) {
        announce('Please enter a valid email.', '#s1status');
        qs('#email').focus();
        return;
      }
      savedEmail = email;
      qs('#loginEmail').value = email; // prefill for Step 4

      // Mock delivery via console.log (deterministic)
      console.log(`[Mock delivery] Sent reset code ${MOCK_CODE} to ${email}.`);
      announce('We sent a 6‑digit code. Check your email. In this demo, open the console to see it.', '#s1status');

      // Move to Step 2
      goTo('#step2');
      // Pre-announce on Step 2
      announce('Code sent. Paste it here.', '#s2status');
    });

    /* ===============================
       [Step 2] Verify code
       =============================== */
    qs('#resendCode').addEventListener('click', () => {
      console.log(`[Mock delivery] Resent reset code ${MOCK_CODE} to ${savedEmail || '(no email set)'}.`);
      announce('Code resent. Check console.', '#s2status');
    });

    qs('#showMockCode').addEventListener('click', (e) => {
      e.target.textContent = `Code: ${MOCK_CODE}`;
      e.target.disabled = true;
      announce('Code shown for demo.', '#s2status');
    });

    qs('#formCode').addEventListener('submit', (e) => {
      e.preventDefault();
      const codeRaw = qs('#code').value || '';
      const code = codeRaw.replace(/\D/g,''); // keep digits only
      if (code.length !== 6) {
        announce('Please enter the 6 digits.', '#s2status');
        qs('#code').focus();
        return;
      }
      if (code !== MOCK_CODE) {
        announce('That code does not match. Try again or resend.', '#s2status');
        qs('#code').focus();
        return;
      }
      announce('Code verified.', '#s2status');
      goTo('#step3');
      // Put focus on password
      setTimeout(() => qs('#pw1').focus(), 50);
    });

    /* ===============================
       [Step 3] New password
       =============================== */
    const pw1 = qs('#pw1'), pw2 = qs('#pw2');
    const reqLen = qs('#reqLen'), reqAlpha = qs('#reqAlpha'), reqNum = qs('#reqNum');
    const meter = qs('#pwMeter');
    const savePwBtn = qs('#savePW');
    function assessPassword(p) {
      const hasLen = p.length >= 8;
      const hasAlpha = /[A-Za-z]/.test(p);
      const hasNum = /\d/.test(p);
      const score = [hasLen, hasAlpha, hasNum].filter(Boolean).length;
      reqLen.className = hasLen ? 'req-ok' : 'req-bad';
      reqAlpha.className = hasAlpha ? 'req-ok' : 'req-bad';
      reqNum.className = hasNum ? 'req-ok' : 'req-bad';
      meter.firstElementChild.style.width = `${Math.max(10, score*33)}%`;
      meter.classList.toggle('good', score === 3);
      return score === 3;
    }
    function checkMatch() {
      const a = pw1.value, b = pw2.value;
      const ok = a && b && a === b;
      const msg = qs('#matchMsg');
      if (!a && !b) {
        msg.textContent = 'We will check that both match.';
        msg.className = 'hint';
      } else if (ok) {
        msg.textContent = 'Looks good. They match.';
        msg.className = 'oktext';
      } else {
        msg.textContent = 'They do not match yet.';
        msg.className = 'error';
      }
      const meets = assessPassword(a);
      savePwBtn.disabled = !(ok && meets);
    }
    pw1.addEventListener('input', checkMatch);
    pw2.addEventListener('input', checkMatch);
    qs('#suggestPW').addEventListener('click', () => {
      pw1.value = 'green-robot-27';
      pw2.value = '';
      checkMatch();
      pw1.focus();
      announce('Suggestion filled. You can edit it.', '#s3status');
    });

    qs('#formPassword').addEventListener('submit', (e) => {
      e.preventDefault();
      const p1 = pw1.value, p2 = pw2.value;
      if (p1 !== p2) {
        announce('The two passwords do not match.', '#s3status');
        pw2.focus();
        return;
      }
      if (!assessPassword(p1)) {
        announce('Please meet the simple rules above.', '#s3status');
        pw1.focus();
        return;
      }
      savedPassword = p1; // store in-memory for demo
      announce('New password saved.', '#s3status');
      goTo('#step4');
      setTimeout(() => qs('#loginPw').focus(), 50);
    });

    /* ===============================
       [Step 4] Log in with new password
       =============================== */
    qs('#formLogin').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = qs('#loginEmail').value.trim();
      const pw = qs('#loginPw').value;
      if (!email || !pw) {
        announce('Please enter email and password.', '#s4status');
        return;
      }
      if (email !== savedEmail || pw !== savedPassword) {
        announce('That does not match your new password. Show it to check or go back.', '#s4status');
        qs('#loginPw').focus();
        return;
      }
      announce('Logged in.', '#s4status');
      goTo('#step5');
      setTimeout(() => qs('#course').focus(), 50);
    });

    /* ===============================
       [Step 5] Upload submission
       =============================== */
    const drop = qs('#dropArea');
    const fileInput = qs('#file');
    const fileInfo = qs('#fileInfo');
    const btnSubmit = qs('#btnSubmit');
    const btnReplace = qs('#btnReplace');

    function setFileInfo(file) {
      if (!file) {
        fileInfo.textContent = '';
        btnSubmit.disabled = true;
        btnReplace.disabled = true;
        return;
      }
      const kb = (file.size/1024).toFixed(1);
      fileInfo.textContent = `Selected: ${file.name} (${kb} KB)`;
      btnSubmit.disabled = false;
      btnReplace.disabled = false;
    }

    ['dragenter', 'dragover'].forEach(evt => {
      drop.addEventListener(evt, (e) => {
        e.preventDefault(); e.stopPropagation();
        drop.classList.add('drag');
      });
    });
    ['dragleave', 'drop'].forEach(evt => {
      drop.addEventListener(evt, (e) => {
        e.preventDefault(); e.stopPropagation();
        drop.classList.remove('drag');
      });
    });
    drop.addEventListener('drop', (e) => {
      const file = e.dataTransfer.files?.[0];
      if (file) {
        setFileInfo(file);
      }
    });
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      setFileInfo(file);
    });
    btnReplace.addEventListener('click', () => {
      fileInput.value = '';
      setFileInfo(null);
      fileInput.click();
    });
    qs('#formSubmit').addEventListener('submit', (e) => {
      e.preventDefault();
      const file = fileInput.files?.[0];
      if (!file) {
        announce('Please choose a file first.', '#s5status');
        return;
      }
      const courseText = qs('#course').selectedOptions[0].textContent;
      const now = new Date().toLocaleString();
      announce(`Submitted to ${courseText} at ${now}. You can replace the file if needed.`, '#s5status');
      btnSubmit.textContent = 'Submitted ✓';
      btnSubmit.classList.add('ok');
      btnSubmit.disabled = true;
    });

    /* ===============================
       [Init focus and hints]
       =============================== */
    // Initial console hint for evaluators
    console.log('[Mock delivery] The deterministic reset code is:', MOCK_CODE);
    // Ensure step 1 visible
    goTo('#step1');
  </script>
</body>
</html>
