{"code_html": "\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n  <title>Password Recovery (Mock, Client-Only)</title>\n  <!--\n    Password Recovery System — Requirements (Single-Page, Client-Only, Mocked)\n\n    Purpose\n    - Self-contained single HTML file\n    - All logic in-browser; “delivery” via console.log\n    - Deterministic mock values\n    - Not for production\n\n    Deliverables\n    - One file: index.html\n    - Semantic HTML, inline CSS & JS\n    - Commented sections mapping to this spec\n\n    Use-case description\n    - Alex (student with dyslexia) must quickly reset password and submit assignment.\n    - Design prioritizes clarity, error recovery, and guidance through steps.\n    - Simulates post-login task (finding course and uploading file).\n\n    Notes\n    - No external network requests or servers.\n    - Accessibility and good UX emphasized.\n  -->\n  <style>\n    /* =========================================================\n       [Purpose] Base styles for semantic layout and accessibility\n       ========================================================= */\n    :root{\n      --bg: #f7f9fc;\n      --panel: #ffffff;\n      --text: #1c1e21;\n      --muted: #5a6772;\n      --accent: #3b82f6;\n      --accent-2:#0ea5e9;\n      --danger:#dc2626;\n      --success:#16a34a;\n      --warning:#ca8a04;\n      --border:#d7dde5;\n      --focus:#ffbf47;\n      --radius: 12px;\n      --shadow: 0 10px 30px rgba(0,0,0,0.08);\n      --font: system-ui, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\",\"Segoe UI Emoji\";\n      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, \"Liberation Mono\", monospace;\n    }\n    @media (prefers-color-scheme: dark){\n      :root{\n        --bg:#0f172a;\n        --panel:#0b1220;\n        --text:#e5eefc;\n        --muted:#a5b4cf;\n        --border:#1e293b;\n        --shadow: 0 10px 30px rgba(0,0,0,0.5);\n      }\n    }\n    body{\n      margin:0;\n      font-family: var(--font);\n      background: radial-gradient(1000px 600px at 10% -10%, rgba(59,130,246,0.06), transparent 60%),\n                  radial-gradient(800px 500px at 90% 10%, rgba(14,165,233,0.07), transparent 60%),\n                  var(--bg);\n      color:var(--text);\n      line-height:1.5;\n      -webkit-font-smoothing: antialiased;\n      text-rendering: optimizeLegibility;\n    }\n    .container{\n      max-width: 960px;\n      margin: 0 auto;\n      padding: 24px;\n    }\n    header{\n      position: sticky;\n      top: 0;\n      backdrop-filter: blur(8px);\n      background: color-mix(in srgb, var(--bg) 80%, transparent);\n      border-bottom: 1px solid var(--border);\n      z-index: 5;\n    }\n    .topbar{\n      display:flex;\n      align-items:center;\n      justify-content:space-between;\n      gap:12px;\n    }\n    .brand{\n      display:flex;\n      align-items:center;\n      gap:12px;\n    }\n    .logo{\n      width:40px;height:40px;\n      border-radius:10px;\n      background: conic-gradient(from 200deg, var(--accent), var(--accent-2));\n      box-shadow: 0 6px 16px rgba(59,130,246,0.45);\n    }\n    h1{\n      font-size: clamp(1.25rem, 2.5vw, 1.6rem);\n      margin:0;\n    }\n    nav.tools{\n      display:flex; gap:8px; flex-wrap:wrap;\n    }\n    .btn{\n      appearance:none;\n      border:1px solid var(--border);\n      background: var(--panel);\n      color:var(--text);\n      padding:10px 14px;\n      border-radius:10px;\n      cursor:pointer;\n      transition: transform .06s ease, box-shadow .15s ease, background .15s ease;\n      box-shadow: 0 2px 6px rgba(0,0,0,0.04);\n    }\n    .btn:hover{ transform: translateY(-1px); }\n    .btn:active{ transform: translateY(0); }\n    .btn.primary{\n      background: linear-gradient(180deg, var(--accent), var(--accent-2));\n      color:#fff;\n      border-color: transparent;\n      box-shadow: 0 6px 16px rgba(59,130,246,0.45);\n    }\n    .btn.ghost{\n      background: transparent;\n    }\n    .btn[disabled]{ opacity:.6; cursor:not-allowed; }\n    .switch{\n      display:inline-flex; align-items:center; gap:8px;\n    }\n    .switch input{ accent-color: var(--accent); }\n    main{\n      padding-block: clamp(16px, 4vw, 36px);\n    }\n    .panel{\n      background: var(--panel);\n      border:1px solid var(--border);\n      border-radius: var(--radius);\n      box-shadow: var(--shadow);\n      padding: clamp(16px, 3vw, 28px);\n    }\n    .grid{\n      display:grid;\n      grid-template-columns:1fr;\n      gap:18px;\n    }\n    .progress{\n      height:10px;\n      background: linear-gradient(90deg, rgba(59,130,246,0.2), rgba(14,165,233,0.2));\n      border-radius: 999px;\n      overflow:hidden;\n      border:1px solid var(--border);\n    }\n    .progress > span{\n      display:block; height:100%; width:0%;\n      background: linear-gradient(90deg, var(--accent), var(--accent-2));\n      transition: width .3s ease;\n    }\n    .steps{\n      display:flex; flex-wrap:wrap; gap:8px;\n      list-style:none; padding:0; margin:0;\n    }\n    .steps li{\n      padding:6px 10px; border:1px dashed var(--border); border-radius:999px;\n      font-size:.95rem; color:var(--muted); background: color-mix(in srgb, var(--panel) 80%, transparent);\n    }\n    .steps li[aria-current=\"step\"]{\n      border-style:solid; color:var(--text); font-weight:600;\n    }\n\n    /* Forms */\n    form{ display:grid; gap:14px; }\n    label{ font-weight:600; }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"], select{\n      padding:12px 14px;\n      border-radius:10px;\n      border:1px solid var(--border);\n      background: #fff0; /* transparent for light/dark */\n      color:var(--text);\n      outline:none;\n      transition: box-shadow .15s ease, border-color .15s ease;\n    }\n    input:focus, select:focus{\n      border-color: var(--accent);\n      box-shadow: 0 0 0 4px color-mix(in srgb, var(--accent) 20%, transparent);\n    }\n    .hint{ color:var(--muted); font-size:.95rem; }\n    .error{ color:var(--danger); }\n    .success{ color:var(--success); }\n    .warning{ color:var(--warning); }\n    .field-row{ display:flex; gap:8px; align-items:center; }\n    .inline-actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }\n    .input-inline{\n      display:flex; align-items:center; gap:8px;\n      background: color-mix(in srgb, var(--panel) 85%, transparent);\n      border:1px solid var(--border);\n      border-radius:10px; padding: 6px 8px;\n    }\n    .input-inline input{ border:none; flex:1; padding:8px; }\n    .small{ font-size:.92rem; }\n    .sr-only{\n      position:absolute !important; width:1px; height:1px; padding:0; margin:-1px;\n      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;\n    }\n    .kpi{\n      display:flex; gap:12px; align-items:center; flex-wrap:wrap;\n      padding:8px; border-radius:10px; background: color-mix(in srgb, var(--panel) 85%, transparent);\n      border:1px solid var(--border);\n    }\n    .badge{\n      display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted);\n      background: color-mix(in srgb, var(--panel) 85%, transparent);\n      font-size:.85rem;\n    }\n    .req-list{ list-style: none; padding-left:0; margin:8px 0 0 0; display:grid; gap:6px; }\n    .req-list li{ display:flex; align-items:center; gap:8px; }\n    .req-list .ok{ color:var(--success); }\n    .req-list .no{ color:var(--muted); }\n\n    /* Password strength meter */\n    .meter{ height:10px; background:#e6eaf2; border-radius:8px; overflow:hidden; border:1px solid var(--border); }\n    .meter > i{ display:block; height:100%; width:0%; background: linear-gradient(90deg,#ef4444,#f59e0b,#22c55e); transition: width .25s ease; }\n\n    /* Portal mock */\n    .portal-grid{ display:grid; grid-template-columns: 1fr; gap:18px; }\n    .tile{\n      padding:14px; border:1px solid var(--border); border-radius:12px; background: color-mix(in srgb, var(--panel) 92%, transparent);\n    }\n    .upload{\n      border:2px dashed var(--border);\n      border-radius:12px; padding:20px; text-align:center;\n      background: color-mix(in srgb, var(--panel) 88%, transparent);\n    }\n\n    /* Easy Read (Use-case: dyslexia support) */\n    .easy-read{\n      font-size: 18.5px;\n      letter-spacing: .015em;\n      word-spacing: .05em;\n      line-height: 1.65;\n    }\n    .easy-read h1, .easy-read h2, .easy-read h3{ letter-spacing: .01em; }\n    .easy-read .btn{ padding:12px 16px; }\n    .easy-read input, .easy-read select{ padding:14px 16px; }\n    .easy-read :focus{ outline: 3px solid var(--focus); outline-offset: 2px; }\n\n    /* High contrast theme toggle */\n    .theme-high-contrast{\n      --bg:#000;\n      --panel:#000;\n      --text:#fff;\n      --muted:#cbd5e1;\n      --border:#334155;\n      --accent:#38bdf8;\n      --accent-2:#06b6d4;\n      --focus:#fde047;\n    }\n    .theme-high-contrast .panel{ box-shadow:none; }\n    .theme-high-contrast .logo{ box-shadow:none; }\n\n    /* Reduced motion */\n    @media (prefers-reduced-motion: reduce){\n      *{ transition:none !important; scroll-behavior: auto !important; }\n    }\n\n    /* Skip link */\n    .skip-link{\n      position:absolute; left:8px; top:-100px;\n      background: var(--accent); color:#fff; padding:8px 10px; border-radius:8px; z-index:999;\n    }\n    .skip-link:focus{ top:8px; }\n\n    /* Code inputs */\n    .code-inputs{\n      display:flex; gap:8px; justify-content:flex-start; align-items:center;\n    }\n    .code-inputs input{\n      width: 48px; text-align:center; font-size:1.1rem; letter-spacing:.08em; font-family: var(--mono);\n    }\n\n    /* Footer */\n    footer{\n      border-top:1px solid var(--border);\n      color:var(--muted);\n      padding:20px 0 60px;\n    }\n  </style>\n</head>\n<body>\n  <a class=\"skip-link\" href=\"#main\">Skip to main content</a>\n  <header>\n    <div class=\"container topbar\" role=\"banner\">\n      <div class=\"brand\">\n        <div aria-hidden=\"true\" class=\"logo\"></div>\n        <div>\n          <h1>Password Recovery (Mock)</h1>\n          <p class=\"hint small\" id=\"subtitle\">Client-only demo. Codes are logged to your console. No data leaves this page.</p>\n        </div>\n      </div>\n      <nav class=\"tools\" aria-label=\"Accessibility and help\">\n        <!-- [Use-case] Dyslexia-friendly toggles -->\n        <button id=\"easyReadBtn\" class=\"btn\" aria-pressed=\"false\" title=\"Increase readability (spacing, size)\">Easy Read</button>\n        <button id=\"contrastBtn\" class=\"btn\" aria-pressed=\"false\" title=\"High contrast theme\">High Contrast</button>\n        <button id=\"speakBtn\" class=\"btn\" aria-pressed=\"false\" title=\"Read instructions aloud\">Read Aloud</button>\n        <button id=\"helpBtn\" class=\"btn ghost\" title=\"Open help tips\">Help</button>\n      </nav>\n    </div>\n  </header>\n\n  <main id=\"main\" class=\"container\" tabindex=\"-1\">\n    <!-- [Purpose] Progress overview -->\n    <section aria-labelledby=\"progressTitle\" class=\"panel\" style=\"margin-bottom:16px;\">\n      <h2 id=\"progressTitle\" class=\"sr-only\">Progress</h2>\n      <div class=\"grid\">\n        <div class=\"progress\" aria-hidden=\"true\"><span id=\"progressBar\"></span></div>\n        <ul class=\"steps\" role=\"list\" aria-label=\"Steps\">\n          <li id=\"stepLabel1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"stepLabel2\">2. Verify</li>\n          <li id=\"stepLabel3\">3. New password</li>\n          <li id=\"stepLabel4\">4. Done</li>\n        </ul>\n      </div>\n    </section>\n\n    <!-- [Deliverables] All sections in a single page; we show/hide per step -->\n    <section id=\"step-1\" class=\"panel\" aria-labelledby=\"s1-title\" data-step=\"1\">\n      <h2 id=\"s1-title\">Step 1 of 4 — Identify your account</h2>\n      <p class=\"hint\">Enter your school email or username. We will generate a 6‑digit recovery code and “send” it via console for this demo.</p>\n      <form id=\"identifyForm\" novalidate>\n        <div>\n          <label for=\"identifier\">Email or username</label>\n          <div class=\"input-inline\">\n            <input id=\"identifier\" name=\"identifier\" type=\"text\" inputmode=\"email\" autocomplete=\"username\"\n                   placeholder=\"e.g., alex@example.edu or a.smith23\" required aria-describedby=\"idHelp\" />\n            <button id=\"clearId\" class=\"btn\" type=\"button\" aria-label=\"Clear input\">✕</button>\n          </div>\n          <p id=\"idHelp\" class=\"hint small\">Tip: Open the browser console to see the code (Ctrl/Cmd+Shift+J). The code is deterministic per identifier.</p>\n          <p id=\"idError\" class=\"error small\" role=\"alert\" aria-live=\"polite\"></p>\n        </div>\n        <div class=\"inline-actions\">\n          <button id=\"sendCode\" class=\"btn primary\" type=\"submit\" disabled>Send code</button>\n          <span class=\"badge\" aria-live=\"polite\" id=\"deliveryNote\">Waiting for input…</span>\n        </div>\n      </form>\n    </section>\n\n    <section id=\"step-2\" class=\"panel\" aria-labelledby=\"s2-title\" hidden data-step=\"2\">\n      <h2 id=\"s2-title\">Step 2 of 4 — Enter the 6‑digit code</h2>\n      <div class=\"kpi\" role=\"status\" aria-live=\"polite\">\n        <div>We “sent” a code to your account (simulated). Check the console for the code.</div>\n        <code class=\"badge small\" aria-label=\"Identifier\" id=\"idEcho\"></code>\n      </div>\n      <form id=\"codeForm\" novalidate>\n        <fieldset>\n          <legend class=\"sr-only\">Verification code</legend>\n          <div class=\"hint\" id=\"codeTip\">Enter the 6 digits. We ignore spaces and dashes.</div>\n          <div class=\"code-inputs\" aria-describedby=\"codeTip\">\n            <input maxlength=\"1\" inputmode=\"numeric\" pattern=\"[0-9]*\" aria-label=\"Digit 1\" />\n            <input maxlength=\"1\" inputmode=\"numeric\" pattern=\"[0-9]*\" aria-label=\"Digit 2\" />\n            <input maxlength=\"1\" inputmode=\"numeric\" pattern=\"[0-9]*\" aria-label=\"Digit 3\" />\n            <input maxlength=\"1\" inputmode=\"numeric\" pattern=\"[0-9]*\" aria-label=\"Digit 4\" />\n            <input maxlength=\"1\" inputmode=\"numeric\" pattern=\"[0-9]*\" aria-label=\"Digit 5\" />\n            <input maxlength=\"1\" inputmode=\"numeric\" pattern=\"[0-9]*\" aria-label=\"Digit 6\" />\n          </div>\n          <p id=\"codeError\" class=\"error small\" role=\"alert\" aria-live=\"assertive\"></p>\n        </fieldset>\n        <div class=\"inline-actions\">\n          <button id=\"verifyBtn\" class=\"btn primary\" type=\"submit\" disabled>Verify</button>\n          <button id=\"pasteBtn\" class=\"btn\" type=\"button\">Paste code</button>\n          <button id=\"resendBtn\" class=\"btn\" type=\"button\">Resend</button>\n          <span class=\"badge small\" id=\"resendNote\" aria-live=\"polite\"></span>\n        </div>\n      </form>\n    </section>\n\n    <section id=\"step-3\" class=\"panel\" aria-labelledby=\"s3-title\" hidden data-step=\"3\">\n      <h2 id=\"s3-title\">Step 3 of 4 — Create a new password</h2>\n      <p class=\"hint\">Use a strong, easy-to-remember passphrase. You can show the password or generate a suggestion.</p>\n      <form id=\"passwordForm\" novalidate>\n        <div>\n          <label for=\"newPassword\">New password</label>\n          <div class=\"input-inline\">\n            <input id=\"newPassword\" name=\"newPassword\" type=\"password\" autocomplete=\"new-password\"\n                   aria-describedby=\"pwHelp pwReq\" required />\n            <button class=\"btn\" type=\"button\" id=\"togglePw\" aria-pressed=\"false\" aria-controls=\"newPassword\">Show</button>\n          </div>\n          <p id=\"pwHelp\" class=\"hint small\">Avoid using your name or email. Consider a 3–5 word passphrase with separators.</p>\n          <div class=\"meter\" aria-hidden=\"true\"><i id=\"pwMeter\"></i></div>\n          <ul id=\"pwReq\" class=\"req-list small\">\n            <li id=\"reqLen\" class=\"no\">• At least 12 characters</li>\n            <li id=\"reqVar\" class=\"no\">• Use at least 3 of: lowercase, UPPERCASE, numbers, symbols</li>\n            <li id=\"reqCommon\" class=\"no\">• Not a common/breached password</li>\n          </ul>\n          <p id=\"capsLockMsg\" class=\"warning small\" role=\"alert\" aria-live=\"polite\" hidden>Caps Lock is on.</p>\n        </div>\n\n        <div>\n          <label for=\"confirmPassword\">Type it again</label>\n          <div class=\"input-inline\">\n            <input id=\"confirmPassword\" name=\"confirmPassword\" type=\"password\" autocomplete=\"new-password\"\n                   aria-describedby=\"matchHint\" required />\n            <button class=\"btn\" type=\"button\" id=\"toggleConfirm\" aria-pressed=\"false\" aria-controls=\"confirmPassword\">Show</button>\n          </div>\n          <p id=\"matchHint\" class=\"hint small\">We’ll tell you where it differs if it doesn’t match.</p>\n          <p id=\"mismatch\" class=\"error small\" role=\"alert\" aria-live=\"assertive\"></p>\n        </div>\n\n        <div class=\"inline-actions\">\n          <button id=\"genPass\" class=\"btn\" type=\"button\">Suggest passphrase</button>\n          <button id=\"copyPass\" class=\"btn\" type=\"button\">Copy</button>\n          <button id=\"updateBtn\" class=\"btn primary\" type=\"submit\" disabled>Update password</button>\n        </div>\n      </form>\n    </section>\n\n    <section id=\"step-4\" class=\"panel\" aria-labelledby=\"s4-title\" hidden data-step=\"4\">\n      <h2 id=\"s4-title\">Step 4 of 4 — Password updated</h2>\n      <div class=\"kpi\">\n        <span class=\"success\">Success! Your password has been reset.</span>\n        <span class=\"badge\">For demo only — no server involved.</span>\n      </div>\n      <div class=\"inline-actions\" style=\"margin-top:8px\">\n        <button id=\"loginBtn\" class=\"btn primary\" type=\"button\">Log in now</button>\n        <button id=\"restartBtn\" class=\"btn\" type=\"button\">Start over</button>\n      </div>\n    </section>\n\n    <!-- [Use-case] After logging in, help Alex find course and upload -->\n    <section id=\"portal\" class=\"panel\" aria-labelledby=\"portal-title\" hidden>\n      <h2 id=\"portal-title\">Mock Portal — Quick Navigation to Submit Assignment</h2>\n      <div class=\"portal-grid\">\n        <div class=\"tile\">\n          <h3>Find your course</h3>\n          <div class=\"field-row\">\n            <label for=\"courseSelect\" class=\"sr-only\">Course</label>\n            <select id=\"courseSelect\">\n              <option>AI 101 — Intro to Artificial Intelligence</option>\n              <option>CS 241 — Data Structures</option>\n              <option>ENG 140 — Academic Writing</option>\n              <option>MATH 210 — Linear Algebra</option>\n            </select>\n            <button class=\"btn\" id=\"goAssignments\" type=\"button\">Go to Assignments</button>\n          </div>\n          <p class=\"hint small\">We’ll jump straight to the “Assignment Upload” section.</p>\n        </div>\n\n        <div class=\"tile\">\n          <h3>Assignment Upload</h3>\n          <div class=\"upload\" id=\"dropZone\" tabindex=\"0\" aria-label=\"File upload drop zone\">\n            <p>Drop your file here, or choose a file.</p>\n            <input id=\"fileInput\" type=\"file\" accept=\".pdf,.doc,.docx,.zip\" />\n            <p class=\"hint small\">Accepted: PDF, DOC, DOCX, ZIP. Max 50 MB (not enforced in mock).</p>\n            <div class=\"meter\" aria-hidden=\"true\" style=\"margin-top:10px\"><i id=\"uploadMeter\"></i></div>\n            <p id=\"uploadMsg\" class=\"hint small\" aria-live=\"polite\"></p>\n          </div>\n        </div>\n\n        <div class=\"tile\">\n          <h3>Deadline helper</h3>\n          <p class=\"hint\">Time until midnight: <strong id=\"countdown\" aria-live=\"polite\">--:--:--</strong></p>\n          <p class=\"hint small\">Tip: You can still replace your upload until the deadline.</p>\n        </div>\n      </div>\n    </section>\n\n    <!-- Live region for polite updates -->\n    <div id=\"live\" class=\"sr-only\" role=\"status\" aria-live=\"polite\"></div>\n\n    <!-- [Purpose] Help / guidance -->\n    <dialog id=\"helpDialog\" aria-labelledby=\"helpTitle\">\n      <form method=\"dialog\" style=\"max-width: 640px;\">\n        <h2 id=\"helpTitle\">Help and tips</h2>\n        <ul>\n          <li>Easy Read increases spacing and font size for better readability.</li>\n          <li>Open the browser console to see your mock recovery code.</li>\n          <li>You can paste the 6‑digit code with spaces or dashes — we clean it.</li>\n          <li>Use a passphrase like three simple words with symbols, e.g., \"green-apple-clouds!\".</li>\n          <li>If passwords don’t match, we show where they differ.</li>\n          <li>No information leaves this page; this is a simulation for evaluation.</li>\n        </ul>\n        <div class=\"inline-actions\" style=\"margin-top:10px\">\n          <button class=\"btn primary\">Close</button>\n        </div>\n      </form>\n    </dialog>\n  </main>\n\n  <footer class=\"container\">\n    <p>Academic evaluation demo. Codes are deterministic and printed to the console. No servers or external calls.</p>\n  </footer>\n\n  <script>\n    /* =========================================================\n       [Purpose] Deterministic mock “delivery” and utilities\n       ========================================================= */\n    const $ = (sel, ctx=document) => ctx.querySelector(sel);\n    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));\n\n    const state = {\n      step: 1,\n      identifier: '',\n      expectedCode: '',\n      speechOn: false\n    };\n\n    function announce(msg){\n      const live = $('#live');\n      live.textContent = '';\n      // force DOM update for assistive tech\n      setTimeout(()=> live.textContent = msg, 10);\n    }\n\n    // Deterministic 6-digit code based on identifier (stable hash % 1e6)\n    function codeForIdentifier(id){\n      let h = 0 >>> 0;\n      const s = (id || '').trim().toLowerCase();\n      for (let i=0;i<s.length;i++){\n        h = (((h << 5) - h) + s.charCodeAt(i)) >>> 0; // h = h*31 + char\n      }\n      const mod = h % 1000000;\n      return String(mod).padStart(6,'0');\n    }\n\n    function mockSendCode(id){\n      const code = codeForIdentifier(id);\n      // Simulate delivery via console.log as required\n      console.log('[mock] Recovery code for', `\"${id}\"`, 'is:', code, '(deterministic)');\n      announce('A 6 digit code was sent. Check console.');\n      return code;\n    }\n\n    function setStep(n, {focus=true}={}){\n      state.step = n;\n      // Panels\n      $$('[data-step]').forEach(sec => sec.hidden = Number(sec.dataset.step) !== n);\n      if (n === 4){\n        $('#portal').hidden = true;\n      }\n      // Progress bar and labels\n      const pct = ((n-1) / 3) * 100;\n      $('#progressBar').style.width = pct + '%';\n      for (let i=1;i<=4;i++){\n        const li = $('#stepLabel'+i);\n        if (li) li.setAttribute('aria-current', i===n ? 'step' : 'false');\n      }\n      // hash for navigation\n      location.hash = '#step-' + n;\n      // Focus the first field of the step\n      if (focus){\n        const current = document.querySelector(`[data-step=\"${n}\"]`);\n        const focusable = current ? current.querySelector('input, button, select, [tabindex]') : null;\n        focusable && focusable.focus();\n      }\n      // Read aloud summary if enabled\n      speakVisibleInstructions();\n    }\n\n    /* =========================================================\n       [Use-case] Accessibility toggles (Easy Read, High Contrast, Read Aloud)\n       ========================================================= */\n    const easyBtn = $('#easyReadBtn');\n    const contrastBtn = $('#contrastBtn');\n    const speakBtn = $('#speakBtn');\n    easyBtn.addEventListener('click', () => {\n      const on = !document.body.classList.contains('easy-read');\n      document.body.classList.toggle('easy-read', on);\n      easyBtn.setAttribute('aria-pressed', String(on));\n      announce(on ? 'Easy Read turned on' : 'Easy Read turned off');\n    });\n    contrastBtn.addEventListener('click', () => {\n      const on = !document.body.classList.contains('theme-high-contrast');\n      document.body.classList.toggle('theme-high-contrast', on);\n      contrastBtn.setAttribute('aria-pressed', String(on));\n      announce(on ? 'High contrast on' : 'High contrast off');\n    });\n    speakBtn.addEventListener('click', () => {\n      state.speechOn = !state.speechOn;\n      speakBtn.setAttribute('aria-pressed', String(state.speechOn));\n      if (state.speechOn) speakVisibleInstructions();\n      else window.speechSynthesis && window.speechSynthesis.cancel();\n    });\n\n    function visibleTextForSpeech(){\n      const sec = document.querySelector(`[data-step=\"${state.step}\"]`);\n      if (!sec) return '';\n      const title = sec.querySelector('h2')?.textContent || '';\n      const hints = Array.from(sec.querySelectorAll('.hint'))\n        .map(n => n.textContent.trim())\n        .slice(0, 2) // keep it brief\n        .join('. ');\n      return `${title}. ${hints}`;\n    }\n    function speakVisibleInstructions(){\n      if (!state.speechOn) return;\n      const text = visibleTextForSpeech();\n      if (!('speechSynthesis' in window) || !text) return;\n      window.speechSynthesis.cancel();\n      const u = new SpeechSynthesisUtterance(text);\n      u.rate = 1.03;\n      u.pitch = 1;\n      try { u.lang = navigator.language || 'en-US'; } catch {}\n      window.speechSynthesis.speak(u);\n    }\n\n    /* =========================================================\n       [Deliverables] Step 1 — Identify account\n       ========================================================= */\n    const idInput = $('#identifier');\n    const idError = $('#idError');\n    const idEcho = $('#idEcho');\n    const sendBtn = $('#sendCode');\n    const deliveryNote = $('#deliveryNote');\n    $('#clearId').addEventListener('click', () => {\n      idInput.value = '';\n      idInput.focus();\n      sendBtn.disabled = true;\n      idError.textContent = '';\n      deliveryNote.textContent = 'Waiting for input…';\n    });\n\n    function idLooksOkay(v){\n      // Accept simple usernames or emails\n      if (!v) return false;\n      const s = v.trim();\n      if (s.includes('@')){\n        // loose email check\n        return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$/.test(s);\n      }\n      // username >= 3 chars with letters/digits/._-\n      return /^[a-zA-Z0-9._-]{3,}$/.test(s);\n    }\n\n    idInput.addEventListener('input', () => {\n      const val = idInput.value.trim();\n      const ok = idLooksOkay(val);\n      sendBtn.disabled = !ok;\n      idError.textContent = ok ? '' : 'Enter a valid email or username.';\n      deliveryNote.textContent = ok ? 'Ready to send.' : 'Waiting for input…';\n    });\n\n    $('#identifyForm').addEventListener('submit', (e) => {\n      e.preventDefault();\n      const id = idInput.value.trim();\n      if (!idLooksOkay(id)){ idError.textContent = 'Please provide a valid identifier.'; return; }\n      state.identifier = id;\n      state.expectedCode = mockSendCode(id);\n      idEcho.textContent = id;\n      deliveryNote.textContent = 'Code sent (see console).';\n      setStep(2);\n    });\n\n    /* =========================================================\n       [Deliverables] Step 2 — Code verification\n       ========================================================= */\n    const codeInputs = $$('#step-2 .code-inputs input');\n    const pasteBtn = $('#pasteBtn');\n    const resendBtn = $('#resendBtn');\n    const verifyBtn = $('#verifyBtn');\n    const codeError = $('#codeError');\n    const resendNote = $('#resendNote');\n\n    function combinedCode(){\n      return codeInputs.map(i => i.value).join('');\n    }\n    function setCodeFromString(s){\n      const clean = (s || '').replace(/\\D/g,'').slice(0,6);\n      codeInputs.forEach((inp, idx) => {\n        inp.value = clean[idx] || '';\n      });\n      verifyBtn.disabled = clean.length !== 6;\n    }\n\n    codeInputs.forEach((inp, idx) => {\n      inp.addEventListener('input', (e) => {\n        inp.value = inp.value.replace(/\\D/g,''); // digits only\n        if (inp.value && idx < codeInputs.length - 1){\n          codeInputs[idx+1].focus();\n        }\n        verifyBtn.disabled = combinedCode().length !== 6;\n        codeError.textContent = '';\n      });\n      inp.addEventListener('keydown', (e) => {\n        if (e.key === 'Backspace' && !inp.value && idx > 0){\n          codeInputs[idx-1].focus();\n        }\n        if (e.key === 'ArrowLeft' && idx > 0) codeInputs[idx-1].focus();\n        if (e.key === 'ArrowRight' && idx < codeInputs.length-1) codeInputs[idx+1].focus();\n        if (e.key === 'Enter' && !verifyBtn.disabled){\n          e.preventDefault();\n          $('#codeForm').requestSubmit();\n        }\n      });\n    });\n\n    pasteBtn.addEventListener('click', async () => {\n      try{\n        const text = await navigator.clipboard.readText();\n        setCodeFromString(text);\n        announce('Code pasted.');\n      }catch{\n        codeError.textContent = 'Clipboard access unavailable. Paste with Ctrl/Cmd+V into the first box.';\n        codeInputs[0].focus();\n      }\n    });\n\n    resendBtn.addEventListener('click', () => {\n      if (!state.identifier) return;\n      const code = mockSendCode(state.identifier);\n      state.expectedCode = code;\n      resendNote.textContent = 'Code re-sent (console).';\n      setTimeout(()=> resendNote.textContent = '', 3000);\n    });\n\n    $('#codeForm').addEventListener('submit', (e) => {\n      e.preventDefault();\n      const entered = combinedCode();\n      if (entered.length !== 6){\n        codeError.textContent = 'Please enter all 6 digits.';\n        return;\n      }\n      if (entered !== state.expectedCode){\n        codeError.textContent = 'That code did not match. Check the console and try again.';\n        codeInputs.forEach(i => i.classList.add('shake'));\n        announce('Code incorrect.');\n        return;\n      }\n      announce('Code verified.');\n      setStep(3);\n    });\n\n    /* =========================================================\n       [Deliverables] Step 3 — New password, live validation\n       ========================================================= */\n    const newPw = $('#newPassword');\n    const confPw = $('#confirmPassword');\n    const togglePw = $('#togglePw');\n    const toggleConfirm = $('#toggleConfirm');\n    const meter = $('#pwMeter');\n    const reqLen = $('#reqLen');\n    const reqVar = $('#reqVar');\n    const reqCommon = $('#reqCommon');\n    const capsMsg = $('#capsLockMsg');\n    const mismatch = $('#mismatch');\n    const updateBtn = $('#updateBtn');\n    const genBtn = $('#genPass');\n    const copyBtn = $('#copyPass');\n\n    const commonList = new Set([\n      'password','123456','qwerty','letmein','welcome','abc123','passw0rd','iloveyou','admin','monkey',\n      'dragon','baseball','football','princess','sunshine','login','starwars','hello','freedom','whatever'\n    ]);\n\n    function strengthScore(pw){\n      let score = 0;\n      if (pw.length >= 8) score += 1;\n      if (pw.length >= 12) score += 1;\n      if (pw.length >= 16) score += 1;\n      const sets = [\n        /[a-z]/.test(pw),\n        /[A-Z]/.test(pw),\n        /[0-9]/.test(pw),\n        /[^A-Za-z0-9]/.test(pw)\n      ].filter(Boolean).length;\n      score += Math.max(0, sets - 1); // 0..3\n      if (commonList.has(pw.toLowerCase())) score = Math.max(0, score - 2);\n      return Math.min(6, score); // 0..6\n    }\n    function updateMeter(pw){\n      const s = strengthScore(pw);\n      const pct = (s / 6) * 100;\n      meter.style.width = pct + '%';\n    }\n    function validatePassword(){\n      const pw = newPw.value;\n      const variety = [/[a-z]/, /[A-Z]/, /[0-9]/, /[^A-Za-z0-9]/].reduce((a,rx)=> a + (rx.test(pw)?1:0),0);\n      const lenOK = pw.length >= 12;\n      const varOK = variety >= 3;\n      const notCommon = !commonList.has(pw.toLowerCase());\n      setReq(reqLen, lenOK);\n      setReq(reqVar, varOK);\n      setReq(reqCommon, notCommon);\n      updateMeter(pw);\n      // match check\n      checkMatch();\n      // enable submit if all satisfied and match\n      updateBtn.disabled = !(lenOK && varOK && notCommon && newPw.value && confPw.value && newPw.value === confPw.value);\n    }\n    function setReq(node, ok){\n      node.classList.toggle('ok', ok);\n      node.classList.toggle('no', !ok);\n    }\n    function checkMatch(){\n      mismatch.textContent = '';\n      if (!newPw.value || !confPw.value) return;\n      if (newPw.value !== confPw.value){\n        const diff = firstDiffIndex(newPw.value, confPw.value);\n        mismatch.textContent = diff >= 0\n          ? `They differ at position ${diff+1}.`\n          : 'Passwords do not match.';\n        return false;\n      }\n      return true;\n    }\n    function firstDiffIndex(a,b){\n      const min = Math.min(a.length, b.length);\n      for (let i=0;i<min;i++) if (a[i]!==b[i]) return i;\n      if (a.length !== b.length) return min;\n      return -1;\n    }\n\n    newPw.addEventListener('input', validatePassword);\n    confPw.addEventListener('input', validatePassword);\n\n    newPw.addEventListener('keydown', (e)=>{\n      if (e.getModifierState && e.getModifierState('CapsLock')) {\n        capsMsg.hidden = false;\n      } else {\n        capsMsg.hidden = true;\n      }\n    });\n    confPw.addEventListener('keydown', (e)=>{\n      if (e.getModifierState && e.getModifierState('CapsLock')) {\n        capsMsg.hidden = false;\n      } else {\n        capsMsg.hidden = true;\n      }\n    });\n\n    togglePw.addEventListener('click', ()=>{\n      const showing = newPw.type === 'text';\n      newPw.type = showing ? 'password' : 'text';\n      togglePw.textContent = showing ? 'Show' : 'Hide';\n      togglePw.setAttribute('aria-pressed', String(!showing));\n      newPw.focus();\n    });\n    toggleConfirm.addEventListener('click', ()=>{\n      const showing = confPw.type === 'text';\n      confPw.type = showing ? 'password' : 'text';\n      toggleConfirm.textContent = showing ? 'Show' : 'Hide';\n      toggleConfirm.setAttribute('aria-pressed', String(!showing));\n      confPw.focus();\n    });\n\n    const easyWords = [\n      'green','apple','cloud','river','stone','paper','gold','silver','lucky','panda','sunny','ocean',\n      'forest','coffee','music','rocket','cookie','tiger','eagle','pearl','maple','winter','summer','autumn',\n      'spring','honey','candle','storm','breeze','melon','berry','orange','violet','sky','mountain','garden',\n      'sunrise','sunset','planet','comet','orbit','spark','stripe','smile','dream','story','puzzle','quiet',\n      'bright','swift','brave','calm','noble','chess','jazz','violin','camera','cosmic','ember','pixel'\n    ];\n    function suggestPass(){\n      function pick(){ return easyWords[Math.floor(Math.random()*easyWords.length)]; }\n      const suggestion = `${pick()}-${pick()}-${pick()}!${Math.floor(Math.random()*90+10)}`;\n      newPw.value = suggestion;\n      confPw.value = '';\n      validatePassword();\n      newPw.focus();\n      announce('Passphrase suggested.');\n    }\n    genBtn.addEventListener('click', suggestPass);\n    copyBtn.addEventListener('click', async ()=>{\n      try{\n        await navigator.clipboard.writeText(newPw.value);\n        announce('Password copied to clipboard.');\n      }catch{\n        announce('Unable to copy. Select and press Ctrl or Cmd C.');\n      }\n    });\n\n    $('#passwordForm').addEventListener('submit', (e) => {\n      e.preventDefault();\n      if (updateBtn.disabled) return;\n      // Mock \"update\" (no server). In a real app we’d submit a request.\n      console.log('[mock] Password for', `\"${state.identifier}\"`, 'updated.');\n      announce('Password updated.');\n      setStep(4);\n    });\n\n    /* =========================================================\n       [Deliverables] Step 4 — Success & mock login\n       ========================================================= */\n    $('#loginBtn').addEventListener('click', () => {\n      // Simulate login and jump to portal helper\n      $('#portal').hidden = false;\n      // Hide the reset steps visually\n      $$('[data-step]').forEach(sec => sec.hidden = true);\n      for (let i=1;i<=4;i++){\n        const li = $('#stepLabel'+i);\n        if (li) li.setAttribute('aria-current','false');\n      }\n      $('#progressBar').style.width = '100%';\n      announce('Logged in. Showing quick navigation to assignments.');\n      $('#portal-title').scrollIntoView({behavior:'smooth', block:'start'});\n      speakVisibleInstructions();\n    });\n\n    $('#restartBtn').addEventListener('click', () => {\n      // Reset everything to initial\n      state.step = 1;\n      state.identifier = '';\n      state.expectedCode = '';\n      idInput.value = '';\n      deliveryNote.textContent = 'Waiting for input…';\n      idError.textContent = '';\n      setStep(1);\n    });\n\n    /* =========================================================\n       [Use-case] Portal: quick navigation and upload\n       ========================================================= */\n    $('#goAssignments').addEventListener('click', ()=>{\n      announce('Jumped to assignments section.');\n      $('#dropZone').focus();\n    });\n\n    const dz = $('#dropZone');\n    const fileInput = $('#fileInput');\n    const upMeter = $('#uploadMeter');\n    const upMsg = $('#uploadMsg');\n\n    function startUpload(file){\n      if (!file){ upMsg.textContent = 'No file selected.'; return; }\n      upMsg.textContent = `Uploading “${file.name}”…`;\n      upMeter.style.width = '0%';\n      const start = performance.now();\n      let pct = 0;\n      const tick = () => {\n        // Simulate faster progress for small files\n        pct += Math.random()*18 + 8;\n        if (pct >= 100) pct = 100;\n        upMeter.style.width = pct + '%';\n        if (pct < 100){\n          setTimeout(tick, 200);\n        } else {\n          const secs = ((performance.now()-start)/1000).toFixed(1);\n          upMsg.textContent = `Uploaded “${file.name}” in ${secs}s. You can upload again to replace the file before the deadline.`;\n          announce('Upload complete.');\n        }\n      };\n      setTimeout(tick, 200);\n    }\n\n    fileInput.addEventListener('change', (e) => {\n      const file = e.target.files?.[0];\n      startUpload(file);\n    });\n\n    ;['dragenter','dragover'].forEach(evt=>{\n      dz.addEventListener(evt, e => {\n        e.preventDefault(); e.stopPropagation();\n        dz.style.borderColor = 'var(--accent)';\n      });\n    });\n    ;['dragleave','drop'].forEach(evt=>{\n      dz.addEventListener(evt, e => {\n        e.preventDefault(); e.stopPropagation();\n        dz.style.borderColor = 'var(--border)';\n      });\n    });\n    dz.addEventListener('drop', (e)=>{\n      const file = e.dataTransfer?.files?.[0];\n      startUpload(file);\n    });\n\n    // Midnight countdown\n    function updateCountdown(){\n      const now = new Date();\n      const midnight = new Date(now);\n      midnight.setHours(24,0,0,0);\n      const ms = midnight - now;\n      const hrs = Math.floor(ms/3600000);\n      const mins = Math.floor((ms%3600000)/60000);\n      const secs = Math.floor((ms%60000)/1000);\n      $('#countdown').textContent = `${String(hrs).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;\n    }\n    setInterval(updateCountdown, 1000);\n    updateCountdown();\n\n    /* =========================================================\n       [Deliverables] Help dialog and misc\n       ========================================================= */\n    const helpDialog = $('#helpDialog');\n    $('#helpBtn').addEventListener('click', () => {\n      if (typeof helpDialog.showModal === 'function'){\n        helpDialog.showModal();\n      } else {\n        alert('Help:\\n\\n- Turn on Easy Read for better readability.\\n- Codes are shown in the console.\\n- You can paste the 6-digit code.\\n- Use a 12+ character passphrase.\\n- This is a client-only simulation.');\n      }\n    });\n\n    // Initialize\n    setStep(1, {focus:false});\n    idInput.focus();\n\n    // Keyboard shortcut hints:\n    // Alt+E toggle Easy Read, Alt+C contrast, Alt+R read aloud\n    document.addEventListener('keydown', (e)=>{\n      if (e.altKey && !e.shiftKey && !e.ctrlKey && !e.metaKey){\n        if (e.key.toLowerCase() === 'e'){ e.preventDefault(); easyBtn.click(); }\n        if (e.key.toLowerCase() === 'c'){ e.preventDefault(); contrastBtn.click(); }\n        if (e.key.toLowerCase() === 'r'){ e.preventDefault(); speakBtn.click(); }\n      }\n    });\n  </script>\n</body>\n</html>\n", "task_list": [], "evaluator_md": "", "done": false, "iter": 1, "mode": "single"}
