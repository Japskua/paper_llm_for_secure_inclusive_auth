{"code_html": "\n<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Password Recovery Demo</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <!-- Styles — Requirements §§4,10 -->\n  <style>\n    :root{\n      --bg:#f5f7fb;\n      --card:#ffffff;\n      --fg:#0f172a;\n      --muted:#475569;\n      --primary:#2563eb;\n      --primary-600:#1d4ed8;\n      --danger:#b91c1c;\n      --success:#068466;\n      --border:#e2e8f0;\n      --focus:#7c3aed;\n    }\n    *{box-sizing:border-box}\n    html,body{height:100%}\n    body{\n      margin:0;\n      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;\n      color:var(--fg);\n      background:var(--bg);\n      line-height:1.4;\n    }\n    header,footer{\n      text-align:center;\n      padding:16px;\n    }\n    header h1{\n      margin:16px auto 8px;\n      font-size:1.25rem;\n      font-weight:700;\n    }\n    main{\n      display:flex;\n      align-items:center;\n      justify-content:center;\n      padding:16px;\n      min-height:calc(100% - 140px);\n    }\n    .card{\n      width:100%;\n      max-width:440px; /* §4 centered card layout */\n      background:var(--card);\n      border:1px solid var(--border);\n      border-radius:12px;\n      box-shadow:0 4px 24px rgba(15,23,42,0.06);\n      padding:20px;\n    }\n    h2{\n      font-size:1.125rem;\n      margin:0 0 12px;\n    }\n    p.helper{\n      color:var(--muted);\n      margin:0 0 16px;\n      font-size:0.95rem;\n    }\n    form{margin:0}\n    .field{\n      margin-bottom:14px;\n    }\n    label{\n      display:block;\n      font-weight:600;\n      margin-bottom:6px;\n    }\n    input[type=\"text\"],\n    input[type=\"email\"],\n    input[type=\"password\"],\n    input[type=\"tel\"]{\n      width:100%;\n      padding:12px 12px;\n      min-height:44px; /* §4 min tap target */\n      border:1px solid var(--border);\n      border-radius:8px;\n      font-size:1rem;\n      background:#fff;\n      outline:none;\n      transition:border-color .15s, box-shadow .15s;\n    }\n    input:focus{\n      border-color:var(--focus);\n      box-shadow:0 0 0 3px rgba(124,58,237,.2);\n    }\n    .radio{\n      display:flex;\n      gap:10px;\n      align-items:center;\n      padding:10px;\n      border:1px solid var(--border);\n      border-radius:8px;\n    }\n    .row{\n      display:flex;\n      gap:12px;\n      flex-wrap:wrap;\n    }\n    .row .grow{flex:1}\n    button{\n      border:0;\n      border-radius:10px;\n      padding:12px 16px;\n      min-height:44px; /* §4 */\n      font-weight:600;\n      cursor:pointer;\n      transition:background .15s, opacity .15s, box-shadow .15s;\n    }\n    button:focus{\n      outline:3px solid rgba(124,58,237,.25);\n      outline-offset:2px;\n    }\n    .btn-primary{\n      background:var(--primary);\n      color:#fff;\n    }\n    .btn-primary:hover{background:var(--primary-600)}\n    .btn-secondary{\n      background:#e9edf5;\n      color:#0f172a;\n    }\n    button[disabled]{\n      opacity:.6;\n      cursor:not-allowed;\n    }\n    .actions{\n      display:flex;\n      gap:10px;\n      margin-top:8px;\n      align-items:center;\n      justify-content:space-between;\n      flex-wrap:wrap;\n    }\n    .error{\n      color:var(--danger);\n      font-size:0.94rem;\n      margin:6px 0 0;\n    }\n    .notice{\n      color:var(--success);\n      font-size:0.94rem;\n      margin:6px 0 0;\n    }\n    .muted{\n      color:var(--muted);\n      font-size:0.92rem;\n    }\n    .link{\n      background:none;\n      border:none;\n      padding:0;\n      color:var(--primary);\n      text-decoration:underline;\n      cursor:pointer;\n      font-weight:600;\n      min-height:0;\n    }\n    .spinner{\n      display:inline-block;\n      width:16px;height:16px;\n      border:2px solid #c7d2fe;\n      border-top-color:var(--primary);\n      border-radius:50%;\n      animation:spin .8s linear infinite;\n      vertical-align:-3px;\n      margin-right:8px;\n    }\n    @keyframes spin{to{transform:rotate(360deg)}}\n    .loading{\n      display:flex;\n      align-items:center;\n      gap:8px;\n      color:var(--muted);\n      font-size:0.95rem;\n      margin-top:8px;\n    }\n    .checklist{\n      margin:8px 0 0;\n      padding-left:18px;\n      font-size:0.95rem;\n    }\n    .checklist li{\n      margin:4px 0;\n      color:var(--muted);\n    }\n    .checklist li.ok{color:var(--success)}\n    .strength{\n      display:flex;\n      align-items:center;\n      gap:8px;\n      margin:8px 0 0;\n    }\n    .pill{\n      padding:4px 8px;\n      border-radius:999px;\n      font-size:0.78rem;\n      font-weight:700;\n      color:#fff;\n    }\n    .weak{background:#ef4444}\n    .okay{background:#f59e0b}\n    .strong{background:#16a34a}\n    .sr-only{\n      position:absolute !important;\n      width:1px;height:1px;\n      padding:0;margin:-1px;\n      overflow:hidden;clip:rect(0,0,0,0);\n      white-space:nowrap;border:0;\n    }\n    footer{\n      color:var(--muted);\n      font-size:0.9rem;\n    }\n    /* Sections container visibility — §3 */\n    section[hidden]{display:none !important}\n  </style>\n</head>\n<body>\n  <!-- Header — §3 -->\n  <header aria-label=\"Application header\">\n    <h1>Password Recovery Demo</h1>\n    <div class=\"muted\">Mock flow for evaluation — no real email is sent.</div>\n  </header>\n\n  <!-- Main card container — §4 -->\n  <main role=\"main\" aria-live=\"polite\">\n    <div class=\"card\" id=\"card\">\n      <!-- Start View — §5.1 -->\n      <section id=\"view-start\">\n        <h2>Welcome back</h2>\n        <p class=\"helper\">This is a demo environment. Sign-in is disabled. Use “Forgot your password?” to explore the recovery flow.</p>\n        <form id=\"form-start\" aria-describedby=\"start-note\">\n          <div class=\"field\">\n            <label for=\"start-email\">Email</label>\n            <input id=\"start-email\" name=\"email\" type=\"email\" autocomplete=\"username\" placeholder=\"you@example.com\" disabled>\n          </div>\n          <div class=\"field\">\n            <label for=\"start-password\">Password</label>\n            <input id=\"start-password\" name=\"password\" type=\"password\" autocomplete=\"current-password\" placeholder=\"••••••••••\" disabled>\n          </div>\n          <div class=\"actions\">\n            <button class=\"btn-primary\" type=\"submit\" disabled aria-disabled=\"true\">Sign in</button>\n            <button id=\"btn-forgot\" class=\"link\" type=\"button\" aria-describedby=\"start-note\">Forgot your password?</button>\n          </div>\n          <p id=\"start-note\" class=\"muted\" style=\"margin-top:8px\">Real sign-in is disabled in this demo.</p>\n        </form>\n      </section>\n\n      <!-- Identify Account — §5.2 -->\n      <section id=\"view-identify\" hidden>\n        <h2>Identify your account</h2>\n        <p class=\"helper\">Enter your email or username.</p>\n        <form id=\"form-identify\" novalidate>\n          <div class=\"field\">\n            <label for=\"identify-input\">Email or username</label>\n            <input id=\"identify-input\" type=\"text\" autocomplete=\"username email\" placeholder=\"jane.doe@example.com or testuser\" required>\n            <div id=\"identify-error\" class=\"error\" role=\"alert\" aria-live=\"assertive\"></div>\n          </div>\n          <div class=\"actions\">\n            <div class=\"row grow\">\n              <button id=\"identify-back\" class=\"btn-secondary\" type=\"button\">Back</button>\n            </div>\n            <div class=\"row\">\n              <button id=\"identify-continue\" class=\"btn-primary\" type=\"submit\" disabled>Continue</button>\n            </div>\n          </div>\n          <div id=\"identify-loading\" class=\"loading\" hidden>\n            <span class=\"spinner\" aria-hidden=\"true\"></span><span>Please wait…</span>\n          </div>\n        </form>\n      </section>\n\n      <!-- Delivery Method — §5.3 -->\n      <section id=\"view-delivery\" hidden>\n        <h2>Choose how to receive your code</h2>\n        <p class=\"helper\">Email is available in this demo.</p>\n        <form id=\"form-delivery\">\n          <div class=\"field\">\n            <div class=\"radio\">\n              <input id=\"del-email\" type=\"radio\" name=\"delivery\" value=\"email\" checked>\n              <label for=\"del-email\">Email <span class=\"muted\" id=\"masked-email\">(ja***@example.com)</span></label>\n            </div>\n          </div>\n          <div class=\"actions\">\n            <div class=\"row grow\">\n              <button id=\"delivery-back\" class=\"btn-secondary\" type=\"button\">Back</button>\n            </div>\n            <div class=\"row\">\n              <button id=\"delivery-send\" class=\"btn-primary\" type=\"button\">Send code</button>\n            </div>\n          </div>\n          <div id=\"delivery-loading\" class=\"loading\" hidden>\n            <span class=\"spinner\" aria-hidden=\"true\"></span><span>Sending…</span>\n          </div>\n          <div id=\"delivery-notice\" class=\"notice\" aria-live=\"polite\"></div>\n        </form>\n      </section>\n\n      <!-- Enter Code — §5.4 -->\n      <section id=\"view-code\" hidden>\n        <h2>Enter code</h2>\n        <p class=\"helper\">Enter the 6-digit code we sent to your email (check console in this demo).</p>\n        <form id=\"form-code\" novalidate>\n          <div class=\"field\">\n            <label for=\"code-input\">6-digit code</label>\n            <input id=\"code-input\" type=\"tel\" inputmode=\"numeric\" autocomplete=\"one-time-code\" placeholder=\"••••••\" maxlength=\"6\" aria-describedby=\"code-help\">\n            <div id=\"code-error\" class=\"error\" role=\"alert\" aria-live=\"assertive\"></div>\n            <div id=\"code-notice\" class=\"notice\" aria-live=\"polite\"></div>\n            <div id=\"code-help\" class=\"muted\">Only numbers are accepted.</div>\n          </div>\n          <div class=\"actions\">\n            <div class=\"row grow\">\n              <button id=\"code-back\" class=\"btn-secondary\" type=\"button\">Back</button>\n              <button id=\"code-resend\" class=\"btn-secondary\" type=\"button\">Resend code</button>\n            </div>\n            <div class=\"row\">\n              <button id=\"code-verify\" class=\"btn-primary\" type=\"submit\" disabled>Verify</button>\n            </div>\n          </div>\n        </form>\n      </section>\n\n      <!-- Set New Password — §5.5 -->\n      <section id=\"view-setPassword\" hidden>\n        <h2>Create a new password</h2>\n        <p class=\"helper\">Choose a strong password and confirm it.</p>\n        <form id=\"form-password\" novalidate>\n          <div class=\"field\">\n            <label for=\"pw1\">New password</label>\n            <input id=\"pw1\" type=\"password\" autocomplete=\"new-password\" placeholder=\"At least 10 characters\">\n          </div>\n          <div class=\"field\">\n            <label for=\"pw2\">Confirm password</label>\n            <input id=\"pw2\" type=\"password\" autocomplete=\"new-password\" placeholder=\"Re-enter password\">\n          </div>\n          <div class=\"field\" style=\"margin-top:-2px;\">\n            <label class=\"sr-only\" for=\"pw-show\">Show password</label>\n            <input id=\"pw-show\" type=\"checkbox\"> <label for=\"pw-show\" style=\"display:inline;font-weight:500\">Show password</label>\n          </div>\n\n          <div class=\"strength\">\n            <span class=\"muted\">Strength:</span>\n            <span id=\"pw-strength-pill\" class=\"pill weak\">Weak</span>\n          </div>\n          <ul class=\"checklist\" aria-live=\"polite\">\n            <li id=\"rule-length\">Password must be at least 10 characters.</li>\n            <li id=\"rule-classes\">Include at least 3 of 4: lowercase, uppercase, number, symbol.</li>\n            <li id=\"rule-excludes\">Must not contain “testuser” or “jane.doe”.</li>\n            <li id=\"rule-match\">Confirmation must exactly match.</li>\n          </ul>\n\n          <div class=\"actions\" style=\"margin-top:14px\">\n            <div class=\"row grow\">\n              <button id=\"pw-back\" class=\"btn-secondary\" type=\"button\">Back</button>\n            </div>\n            <div class=\"row\">\n              <button id=\"pw-save\" class=\"btn-primary\" type=\"submit\" disabled>Save password</button>\n            </div>\n          </div>\n        </form>\n      </section>\n\n      <!-- Success — §5.6 -->\n      <section id=\"view-success\" hidden>\n        <h2>Your password has been reset.</h2>\n        <p class=\"helper\">You can now sign in with your new password.</p>\n        <div class=\"actions\" style=\"justify-content:center;margin-top:12px\">\n          <button id=\"success-back\" class=\"btn-primary\" type=\"button\">Back to Sign in</button>\n        </div>\n      </section>\n    </div>\n  </main>\n\n  <!-- Footer — §3 -->\n  <footer>\n    This is a client-only demo. No emails or SMS are sent. Open the browser console to see simulated delivery logs.\n  </footer>\n\n  <!-- Script — Core logic; comments mapped to requirement sections -->\n  <script>\n    // Data Model — §11\n    window.__demoLastSetPassword = null;\n    const RecoveryDemo = {\n      user: {\n        username: \"testuser\",\n        email: \"jane.doe@example.com\"\n      },\n      state: {\n        currentView: \"start\",\n        latestCode: null,\n        latestCodeIssuedAt: 0,\n        failedCodeAttempts: 0,\n        newPasswordTemp: null,\n        lockedFromAttempts: false,\n        expired: false\n      }\n    };\n    // Utility helpers — §§4,9,12\n    const $ = (sel, root=document) => root.querySelector(sel);\n    const $all = (sel, root=document) => Array.from(root.querySelectorAll(sel));\n    const clamp = (n, min, max) => Math.max(min, Math.min(max, n));\n    const maskEmail = () => \"ja***@example.com\"; // per §6 masking\n    const now = () => Date.now();\n    const CODE_TTL_MS = 5 * 60 * 1000; // §9 5 minutes\n\n    // Mock Delivery — §7\n    function issueCode(reason=\"issue\"){\n      // Generate a new 6-digit pseudo-random code; invalidate older codes — §7\n      const code = String(Math.floor(100000 + Math.random() * 900000));\n      RecoveryDemo.state.latestCode = code;\n      RecoveryDemo.state.latestCodeIssuedAt = now();\n      RecoveryDemo.state.failedCodeAttempts = 0;\n      RecoveryDemo.state.lockedFromAttempts = false;\n      RecoveryDemo.state.expired = false;\n      // Console protocol exact format — §7\n      console.log(`[RecoveryDemo] Delivering mock reset code via EMAIL to ${RecoveryDemo.user.email}`);\n      console.log(`[RecoveryDemo] CODE: ${code}`);\n      console.log(`[RecoveryDemo] RESET LINK: https://example.com/reset?token=RESET-TOKEN-ABC123 (demo only)`);\n      return code;\n    }\n\n    // View Controller — §§3,4\n    const Views = {\n      order: [\"start\",\"identify\",\"delivery\",\"code\",\"setPassword\",\"success\"],\n      show(viewName){\n        RecoveryDemo.state.currentView = viewName;\n        for(const name of this.order){\n          const el = document.getElementById(\"view-\" + (name === \"setPassword\" ? \"setPassword\" : name));\n          if(!el) continue;\n          if(name === viewName){\n            el.hidden = false;\n          }else{\n            el.hidden = true;\n          }\n        }\n        // Focus management: first interactive element — §4\n        setTimeout(() => {\n          const container = this.getContainer(viewName);\n          if(!container) return;\n          const focusable = container.querySelector('input:not([type=\"hidden\"]):not([disabled]), button:not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], [tabindex]:not([tabindex=\"-1\"])');\n          if(focusable){ focusable.focus(); }\n        }, 0);\n      },\n      getContainer(viewName){\n        const id = \"view-\" + (viewName === \"setPassword\" ? \"setPassword\" : viewName);\n        return document.getElementById(id);\n      }\n    };\n\n    // Simulated delays — §4\n    function delayRandom(min=600, max=1200){\n      const ms = Math.floor(min + Math.random() * (max - min));\n      return new Promise(res => setTimeout(res, ms));\n    }\n    function delay(ms){ return new Promise(res => setTimeout(res, ms)); }\n\n    // App wiring — §12\n    document.addEventListener(\"DOMContentLoaded\", init);\n    function init(){\n      // Populate masked email in UI — §5.3\n      $(\"#masked-email\").textContent = \"(\" + maskEmail() + \")\";\n\n      // Start view — §5.1\n      $(\"#btn-forgot\").addEventListener(\"click\", onClickForgot);\n\n      // Identify — §5.2\n      const identifyInput = $(\"#identify-input\");\n      const identifyContinue = $(\"#identify-continue\");\n      const identifyBack = $(\"#identify-back\");\n      identifyInput.addEventListener(\"input\", () => {\n        identifyInput.value = identifyInput.value.trimStart(); // prevent leading spaces\n        identifyContinue.disabled = identifyInput.value.trim().length === 0;\n        clearIdentifyError();\n      });\n      identifyBack.addEventListener(\"click\", () => onClickBack(\"start\"));\n      $(\"#form-identify\").addEventListener(\"submit\", onSubmitIdentify);\n\n      // Delivery — §5.3\n      $(\"#delivery-back\").addEventListener(\"click\", () => onClickBack(\"identify\"));\n      $(\"#delivery-send\").addEventListener(\"click\", onClickSendCode);\n\n      // Code — §5.4\n      const codeInput = $(\"#code-input\");\n      codeInput.addEventListener(\"input\", onCodeInput);\n      $(\"#code-back\").addEventListener(\"click\", () => onClickBack(\"delivery\"));\n      $(\"#code-resend\").addEventListener(\"click\", onClickResend);\n      $(\"#form-code\").addEventListener(\"submit\", onSubmitCode);\n\n      // Set Password — §5.5 and §8\n      $(\"#pw-back\").addEventListener(\"click\", () => onClickBack(\"code\"));\n      $(\"#pw-show\").addEventListener(\"change\", onToggleShowPassword);\n      $(\"#pw1\").addEventListener(\"input\", onPasswordInput);\n      $(\"#pw2\").addEventListener(\"input\", onPasswordInput);\n      $(\"#form-password\").addEventListener(\"submit\", onSubmitNewPassword);\n\n      // Success — §5.6\n      $(\"#success-back\").addEventListener(\"click\", onSuccessBack);\n\n      // Initial view — §3\n      Views.show(\"start\");\n    }\n\n    // Events & Handlers — §12\n    function onClickForgot(){\n      // Navigate to Identify — §12 onClickForgot\n      resetIdentifyView();\n      Views.show(\"identify\");\n    }\n\n    function onClickBack(target){\n      // Clear transient UI state when navigating back — §3, §9\n      switch(target){\n        case \"start\":\n          resetAllTransient();\n          Views.show(\"start\");\n          break;\n        case \"identify\":\n          resetDeliveryView();\n          Views.show(\"identify\");\n          break;\n        case \"delivery\":\n          resetCodeView();\n          Views.show(\"delivery\");\n          break;\n        case \"code\":\n          resetPasswordView();\n          Views.show(\"code\");\n          break;\n      }\n    }\n\n    async function onSubmitIdentify(e){\n      e.preventDefault();\n      const input = $(\"#identify-input\");\n      const val = input.value.trim();\n      if(val.length === 0) return;\n      const btn = $(\"#identify-continue\");\n      const loader = $(\"#identify-loading\");\n      const error = $(\"#identify-error\");\n      error.textContent = \"\";\n      btn.disabled = true;\n      loader.hidden = false;\n\n      await delayRandom();\n\n      const match = identifierMatches(val);\n      if(match){\n        // Issue a code immediately on identification — §§5.2,7\n        issueCode(\"identify\");\n        loader.hidden = true;\n        btn.disabled = false;\n        resetDeliveryView();\n        Views.show(\"delivery\");\n      } else {\n        loader.hidden = true;\n        btn.disabled = false;\n        error.textContent = \"We couldn’t find that account.\";\n        input.focus();\n        input.select();\n      }\n    }\n\n    async function onClickSendCode(){\n      const btn = $(\"#delivery-send\");\n      const loader = $(\"#delivery-loading\");\n      const notice = $(\"#delivery-notice\");\n      btn.disabled = true;\n      loader.hidden = false;\n      notice.textContent = \"\";\n      await delayRandom();\n      issueCode(\"send\");\n      loader.hidden = true;\n      notice.textContent = \"We’ve sent a code to your email (check console in this demo).\";\n      // Auto-advance to Code after 1–2s — §5.3\n      await delay(1000 + Math.floor(Math.random()*800));\n      resetCodeView();\n      // Prefill notice on Code screen to guide user\n      $(\"#code-notice\").textContent = \"Code sent. Use the latest one shown in the console.\";\n      Views.show(\"code\");\n    }\n\n    function onCodeInput(){\n      const input = $(\"#code-input\");\n      // Only digits; allow paste — §5.4\n      const digits = (input.value || \"\").replace(/\\D+/g, \"\").slice(0,6);\n      if(digits !== input.value){ input.value = digits; }\n      const verify = $(\"#code-verify\");\n      const locked = RecoveryDemo.state.lockedFromAttempts || RecoveryDemo.state.expired;\n      verify.disabled = digits.length !== 6 || locked;\n      // Clear notices/errors when user types again\n      if(!locked){\n        $(\"#code-error\").textContent = \"\";\n      }\n    }\n\n    async function onSubmitCode(e){\n      e.preventDefault();\n      const input = $(\"#code-input\");\n      const code = (input.value || \"\").trim();\n      const verifyBtn = $(\"#code-verify\");\n      const errorEl = $(\"#code-error\");\n      const noticeEl = $(\"#code-notice\");\n      errorEl.textContent = \"\";\n      noticeEl.textContent = \"\";\n\n      if(RecoveryDemo.state.lockedFromAttempts){\n        errorEl.textContent = \"Too many attempts. Please resend a new code.\";\n        return;\n      }\n      // Expiry check — §9\n      if(now() - RecoveryDemo.state.latestCodeIssuedAt > CODE_TTL_MS){\n        RecoveryDemo.state.expired = true;\n        verifyBtn.disabled = true;\n        errorEl.textContent = \"This code has expired. Please resend a new code.\";\n        return;\n      }\n\n      if(code.length !== 6){\n        return;\n      }\n\n      if(code === RecoveryDemo.state.latestCode){\n        // Success → go Set Password — §5.4\n        resetPasswordView();\n        Views.show(\"setPassword\");\n      } else {\n        RecoveryDemo.state.failedCodeAttempts += 1;\n        if(RecoveryDemo.state.failedCodeAttempts >= 3){\n          RecoveryDemo.state.lockedFromAttempts = true;\n          verifyBtn.disabled = true;\n          errorEl.textContent = \"Too many attempts. Please resend a new code.\";\n        } else {\n          const remaining = 3 - RecoveryDemo.state.failedCodeAttempts;\n          errorEl.textContent = \"That code is incorrect. \" + (remaining>0 ? `You have ${remaining} attempt${remaining===1?\"\":\"s\"} left.` : \"\");\n          input.select();\n        }\n      }\n    }\n\n    function onClickResend(){\n      // Resend: issue new code; reset attempts; notify — §5.4\n      issueCode(\"resend\");\n      RecoveryDemo.state.failedCodeAttempts = 0;\n      RecoveryDemo.state.lockedFromAttempts = false;\n      RecoveryDemo.state.expired = false;\n      $(\"#code-error\").textContent = \"\";\n      $(\"#code-notice\").textContent = \"New code sent. Use the latest one.\";\n      $(\"#code-verify\").disabled = ($(\"#code-input\").value.trim().length !== 6);\n      $(\"#code-input\").focus();\n      $(\"#code-input\").select();\n    }\n\n    function onToggleShowPassword(e){\n      const show = $(\"#pw-show\").checked;\n      const type = show ? \"text\" : \"password\";\n      $(\"#pw1\").type = type;\n      $(\"#pw2\").type = type;\n    }\n\n    function onPasswordInput(){\n      const pw1 = $(\"#pw1\").value;\n      const pw2 = $(\"#pw2\").value;\n      const evaluation = evaluatePassword(pw1, pw2);\n      applyPasswordUI(evaluation);\n    }\n\n    function evaluatePassword(pw1, pw2){\n      // Rules — §8\n      const minLen = pw1.length >= 10;\n      const hasLower = /[a-z]/.test(pw1);\n      const hasUpper = /[A-Z]/.test(pw1);\n      const hasDigit = /\\d/.test(pw1);\n      const hasSymbol = /[^A-Za-z0-9]/.test(pw1);\n      const classesMetCount = [hasLower,hasUpper,hasDigit,hasSymbol].filter(Boolean).length;\n      const classesOK = classesMetCount >= 3;\n      const localPart = RecoveryDemo.user.email.split(\"@\")[0]; // \"jane.doe\"\n      const containsUserOrLocal = pw1.toLowerCase().includes(RecoveryDemo.user.username.toLowerCase()) ||\n                                  pw1.toLowerCase().includes(localPart.toLowerCase());\n      const excludes = !containsUserOrLocal;\n      const match = pw1.length > 0 && pw1 === pw2;\n\n      // Strength: simple meter — §8\n      let strength = \"Weak\";\n      if(minLen && classesMetCount >= 3) strength = \"Okay\";\n      if(pw1.length >= 12 && classesMetCount >= 4) strength = \"Strong\";\n\n      return { minLen, classesOK, excludes, match, strength, pw1, pw2, classesMetCount };\n    }\n\n    function applyPasswordUI(ev){\n      const pill = $(\"#pw-strength-pill\");\n      pill.textContent = ev.strength;\n      pill.className = \"pill \" + (ev.strength === \"Strong\" ? \"strong\" : ev.strength === \"Okay\" ? \"okay\" : \"weak\");\n\n      // Checklist updates — §8\n      toggleRule(\"#rule-length\", ev.minLen);\n      toggleRule(\"#rule-classes\", ev.classesOK);\n      toggleRule(\"#rule-excludes\", ev.excludes);\n      toggleRule(\"#rule-match\", ev.match);\n\n      // Enable Save only when all core rules met\n      $(\"#pw-save\").disabled = !(ev.minLen && ev.classesOK && ev.excludes && ev.match);\n    }\n\n    function toggleRule(sel, ok){\n      const el = $(sel);\n      el.classList.toggle(\"ok\", !!ok);\n    }\n\n    function onSubmitNewPassword(e){\n      e.preventDefault();\n      const ev = evaluatePassword($(\"#pw1\").value, $(\"#pw2\").value);\n      applyPasswordUI(ev);\n      if(ev.minLen && ev.classesOK && ev.excludes && ev.match){\n        // Store in-memory only — §8\n        window.__demoLastSetPassword = ev.pw1;\n        RecoveryDemo.state.newPasswordTemp = ev.pw1;\n        resetSuccessView();\n        Views.show(\"success\");\n      }\n    }\n\n    function onSuccessBack(){\n      // Return to Start and clear transient UI state — §5.6\n      resetAllTransient(true);\n      Views.show(\"start\");\n    }\n\n    // Helpers: identity matching — §6\n    function identifierMatches(val){\n      const v = val.trim().toLowerCase();\n      return v === RecoveryDemo.user.username.toLowerCase() ||\n             v === RecoveryDemo.user.email.toLowerCase();\n    }\n\n    // Reset/clear view state helpers — §9\n    function resetIdentifyView(){\n      $(\"#identify-input\").value = \"\";\n      $(\"#identify-continue\").disabled = true;\n      clearIdentifyError();\n      $(\"#identify-loading\").hidden = true;\n    }\n    function clearIdentifyError(){\n      $(\"#identify-error\").textContent = \"\";\n    }\n    function resetDeliveryView(){\n      $(\"#delivery-notice\").textContent = \"\";\n      $(\"#delivery-loading\").hidden = true;\n      $(\"#delivery-send\").disabled = false;\n      $(\"#del-email\").checked = true;\n    }\n    function resetCodeView(){\n      $(\"#code-input\").value = \"\";\n      $(\"#code-error\").textContent = \"\";\n      $(\"#code-notice\").textContent = \"\";\n      $(\"#code-verify\").disabled = true;\n      RecoveryDemo.state.failedCodeAttempts = 0;\n      RecoveryDemo.state.lockedFromAttempts = false;\n      RecoveryDemo.state.expired = false;\n    }\n    function resetPasswordView(){\n      $(\"#pw1\").value = \"\";\n      $(\"#pw2\").value = \"\";\n      $(\"#pw-show\").checked = false;\n      $(\"#pw1\").type = \"password\";\n      $(\"#pw2\").type = \"password\";\n      applyPasswordUI(evaluatePassword(\"\", \"\"));\n    }\n    function resetSuccessView(){\n      // No specific fields; placeholder if needed\n    }\n    function resetAllTransient(clearCode = false){\n      resetIdentifyView();\n      resetDeliveryView();\n      resetCodeView();\n      resetPasswordView();\n      if(clearCode){\n        RecoveryDemo.state.latestCode = null;\n        RecoveryDemo.state.latestCodeIssuedAt = 0;\n        RecoveryDemo.state.failedCodeAttempts = 0;\n        RecoveryDemo.state.lockedFromAttempts = false;\n        RecoveryDemo.state.expired = false;\n        RecoveryDemo.state.newPasswordTemp = null;\n      }\n    }\n\n    // Keyboard support: Enter submits active form; Esc does nothing special — §4\n    // Forms already handle submit. No Esc handler.\n\n    // Expiry check timer (optional visual); core check is done on verification — §9\n    // Not required to display remaining time; functional expiry enforced in onSubmitCode.\n  </script>\n</body>\n</html>\n", "task_list": ["None."], "evaluator_md": "SUMMARY\nThe provided single-file Password Recovery Demo implements the complete, client-only “Forgot password” flow per the specification. It includes all required screens, polished UI behavior, mocked delivery via console logs, validation, error handling, delays, focus management, and in-memory state. The hardcoded account is recognized, codes are generated/logged correctly, attempts and expiry are enforced, and password rules with checklist and strength indicator are implemented. No external calls are made, and the UI is responsive.\n\nFUNCTIONAL_CHECK\n- Single index.html renders without errors and no external network calls: PASS — One HTML file with inline CSS/JS; no external resources or network calls.\n- Flow includes all states in §5 and transitions work as described: PASS — Start, Identify, Delivery, Enter Code, Set New Password, Success all present with working navigation and back buttons; success returns to Start.\n- Hardcoded account in §6 recognized; any other identifier rejected with inline error: PASS — Case-insensitive match against “testuser” or “jane.doe@example.com”; others show inline “We couldn’t find that account.”.\n- Sending/Resending logs to console exactly in the format of §7; latest code only is valid: PASS — Logs three lines exactly as specified; latestCode updated on issue/resend; only latest code is accepted.\n- Code entry enforces 6 digits; wrong code attempts count and lock after 3 until Resend: PASS — Input constrained to digits, maxlength 6; Verify disabled until 6 digits; after 3 failures, Verify disabled and lock message shown; Resend resets attempts/lock.\n- Code expires after ~5 minutes (client timer): PASS — Verification checks now() - latestCodeIssuedAt > 5 minutes, then disables Verify and requires Resend.\n- Password rules in §8 enforced with inline checklist and strength hint: PASS — Length ≥10, 3/4 classes, excludes username/local-part, and exact match enforced; checklist turns green per rule; Weak/Okay/Strong pill updates.\n- On success, window.__demoLastSetPassword equals the new password; Success screen shown: PASS — Value assigned on submit; Success view displayed.\n- Buttons reflect disabled/enabled state based on validity; focus moves correctly on each screen change: PASS — Buttons toggle disabled appropriately; focus moves to first enabled control when views change.\n- Works on desktop and mobile sizes; layout remains readable: PASS — Centered responsive card (max-width 440px), adequate spacing and touch targets; no layout breakpoints required.\n- No libraries required; if used, must be embedded and not fetch externally: PASS — Vanilla JS/HTML/CSS only.\n\nFAILING_ITEMS\n- None observed.\n\nNEW_TASKS\n- None.\n\nDECISION\nPASS", "done": true, "iter": 1}
