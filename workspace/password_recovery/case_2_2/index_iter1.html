
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Password Recovery Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Styles — Requirements §§4,10 -->
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --fg:#0f172a;
      --muted:#475569;
      --primary:#2563eb;
      --primary-600:#1d4ed8;
      --danger:#b91c1c;
      --success:#068466;
      --border:#e2e8f0;
      --focus:#7c3aed;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      color:var(--fg);
      background:var(--bg);
      line-height:1.4;
    }
    header,footer{
      text-align:center;
      padding:16px;
    }
    header h1{
      margin:16px auto 8px;
      font-size:1.25rem;
      font-weight:700;
    }
    main{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      min-height:calc(100% - 140px);
    }
    .card{
      width:100%;
      max-width:440px; /* §4 centered card layout */
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow:0 4px 24px rgba(15,23,42,0.06);
      padding:20px;
    }
    h2{
      font-size:1.125rem;
      margin:0 0 12px;
    }
    p.helper{
      color:var(--muted);
      margin:0 0 16px;
      font-size:0.95rem;
    }
    form{margin:0}
    .field{
      margin-bottom:14px;
    }
    label{
      display:block;
      font-weight:600;
      margin-bottom:6px;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="tel"]{
      width:100%;
      padding:12px 12px;
      min-height:44px; /* §4 min tap target */
      border:1px solid var(--border);
      border-radius:8px;
      font-size:1rem;
      background:#fff;
      outline:none;
      transition:border-color .15s, box-shadow .15s;
    }
    input:focus{
      border-color:var(--focus);
      box-shadow:0 0 0 3px rgba(124,58,237,.2);
    }
    .radio{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px;
      border:1px solid var(--border);
      border-radius:8px;
    }
    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .row .grow{flex:1}
    button{
      border:0;
      border-radius:10px;
      padding:12px 16px;
      min-height:44px; /* §4 */
      font-weight:600;
      cursor:pointer;
      transition:background .15s, opacity .15s, box-shadow .15s;
    }
    button:focus{
      outline:3px solid rgba(124,58,237,.25);
      outline-offset:2px;
    }
    .btn-primary{
      background:var(--primary);
      color:#fff;
    }
    .btn-primary:hover{background:var(--primary-600)}
    .btn-secondary{
      background:#e9edf5;
      color:#0f172a;
    }
    button[disabled]{
      opacity:.6;
      cursor:not-allowed;
    }
    .actions{
      display:flex;
      gap:10px;
      margin-top:8px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .error{
      color:var(--danger);
      font-size:0.94rem;
      margin:6px 0 0;
    }
    .notice{
      color:var(--success);
      font-size:0.94rem;
      margin:6px 0 0;
    }
    .muted{
      color:var(--muted);
      font-size:0.92rem;
    }
    .link{
      background:none;
      border:none;
      padding:0;
      color:var(--primary);
      text-decoration:underline;
      cursor:pointer;
      font-weight:600;
      min-height:0;
    }
    .spinner{
      display:inline-block;
      width:16px;height:16px;
      border:2px solid #c7d2fe;
      border-top-color:var(--primary);
      border-radius:50%;
      animation:spin .8s linear infinite;
      vertical-align:-3px;
      margin-right:8px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading{
      display:flex;
      align-items:center;
      gap:8px;
      color:var(--muted);
      font-size:0.95rem;
      margin-top:8px;
    }
    .checklist{
      margin:8px 0 0;
      padding-left:18px;
      font-size:0.95rem;
    }
    .checklist li{
      margin:4px 0;
      color:var(--muted);
    }
    .checklist li.ok{color:var(--success)}
    .strength{
      display:flex;
      align-items:center;
      gap:8px;
      margin:8px 0 0;
    }
    .pill{
      padding:4px 8px;
      border-radius:999px;
      font-size:0.78rem;
      font-weight:700;
      color:#fff;
    }
    .weak{background:#ef4444}
    .okay{background:#f59e0b}
    .strong{background:#16a34a}
    .sr-only{
      position:absolute !important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }
    footer{
      color:var(--muted);
      font-size:0.9rem;
    }
    /* Sections container visibility — §3 */
    section[hidden]{display:none !important}
  </style>
</head>
<body>
  <!-- Header — §3 -->
  <header aria-label="Application header">
    <h1>Password Recovery Demo</h1>
    <div class="muted">Mock flow for evaluation — no real email is sent.</div>
  </header>

  <!-- Main card container — §4 -->
  <main role="main" aria-live="polite">
    <div class="card" id="card">
      <!-- Start View — §5.1 -->
      <section id="view-start">
        <h2>Welcome back</h2>
        <p class="helper">This is a demo environment. Sign-in is disabled. Use “Forgot your password?” to explore the recovery flow.</p>
        <form id="form-start" aria-describedby="start-note">
          <div class="field">
            <label for="start-email">Email</label>
            <input id="start-email" name="email" type="email" autocomplete="username" placeholder="you@example.com" disabled>
          </div>
          <div class="field">
            <label for="start-password">Password</label>
            <input id="start-password" name="password" type="password" autocomplete="current-password" placeholder="••••••••••" disabled>
          </div>
          <div class="actions">
            <button class="btn-primary" type="submit" disabled aria-disabled="true">Sign in</button>
            <button id="btn-forgot" class="link" type="button" aria-describedby="start-note">Forgot your password?</button>
          </div>
          <p id="start-note" class="muted" style="margin-top:8px">Real sign-in is disabled in this demo.</p>
        </form>
      </section>

      <!-- Identify Account — §5.2 -->
      <section id="view-identify" hidden>
        <h2>Identify your account</h2>
        <p class="helper">Enter your email or username.</p>
        <form id="form-identify" novalidate>
          <div class="field">
            <label for="identify-input">Email or username</label>
            <input id="identify-input" type="text" autocomplete="username email" placeholder="jane.doe@example.com or testuser" required>
            <div id="identify-error" class="error" role="alert" aria-live="assertive"></div>
          </div>
          <div class="actions">
            <div class="row grow">
              <button id="identify-back" class="btn-secondary" type="button">Back</button>
            </div>
            <div class="row">
              <button id="identify-continue" class="btn-primary" type="submit" disabled>Continue</button>
            </div>
          </div>
          <div id="identify-loading" class="loading" hidden>
            <span class="spinner" aria-hidden="true"></span><span>Please wait…</span>
          </div>
        </form>
      </section>

      <!-- Delivery Method — §5.3 -->
      <section id="view-delivery" hidden>
        <h2>Choose how to receive your code</h2>
        <p class="helper">Email is available in this demo.</p>
        <form id="form-delivery">
          <div class="field">
            <div class="radio">
              <input id="del-email" type="radio" name="delivery" value="email" checked>
              <label for="del-email">Email <span class="muted" id="masked-email">(ja***@example.com)</span></label>
            </div>
          </div>
          <div class="actions">
            <div class="row grow">
              <button id="delivery-back" class="btn-secondary" type="button">Back</button>
            </div>
            <div class="row">
              <button id="delivery-send" class="btn-primary" type="button">Send code</button>
            </div>
          </div>
          <div id="delivery-loading" class="loading" hidden>
            <span class="spinner" aria-hidden="true"></span><span>Sending…</span>
          </div>
          <div id="delivery-notice" class="notice" aria-live="polite"></div>
        </form>
      </section>

      <!-- Enter Code — §5.4 -->
      <section id="view-code" hidden>
        <h2>Enter code</h2>
        <p class="helper">Enter the 6-digit code we sent to your email (check console in this demo).</p>
        <form id="form-code" novalidate>
          <div class="field">
            <label for="code-input">6-digit code</label>
            <input id="code-input" type="tel" inputmode="numeric" autocomplete="one-time-code" placeholder="••••••" maxlength="6" aria-describedby="code-help">
            <div id="code-error" class="error" role="alert" aria-live="assertive"></div>
            <div id="code-notice" class="notice" aria-live="polite"></div>
            <div id="code-help" class="muted">Only numbers are accepted.</div>
          </div>
          <div class="actions">
            <div class="row grow">
              <button id="code-back" class="btn-secondary" type="button">Back</button>
              <button id="code-resend" class="btn-secondary" type="button">Resend code</button>
            </div>
            <div class="row">
              <button id="code-verify" class="btn-primary" type="submit" disabled>Verify</button>
            </div>
          </div>
        </form>
      </section>

      <!-- Set New Password — §5.5 -->
      <section id="view-setPassword" hidden>
        <h2>Create a new password</h2>
        <p class="helper">Choose a strong password and confirm it.</p>
        <form id="form-password" novalidate>
          <div class="field">
            <label for="pw1">New password</label>
            <input id="pw1" type="password" autocomplete="new-password" placeholder="At least 10 characters">
          </div>
          <div class="field">
            <label for="pw2">Confirm password</label>
            <input id="pw2" type="password" autocomplete="new-password" placeholder="Re-enter password">
          </div>
          <div class="field" style="margin-top:-2px;">
            <label class="sr-only" for="pw-show">Show password</label>
            <input id="pw-show" type="checkbox"> <label for="pw-show" style="display:inline;font-weight:500">Show password</label>
          </div>

          <div class="strength">
            <span class="muted">Strength:</span>
            <span id="pw-strength-pill" class="pill weak">Weak</span>
          </div>
          <ul class="checklist" aria-live="polite">
            <li id="rule-length">Password must be at least 10 characters.</li>
            <li id="rule-classes">Include at least 3 of 4: lowercase, uppercase, number, symbol.</li>
            <li id="rule-excludes">Must not contain “testuser” or “jane.doe”.</li>
            <li id="rule-match">Confirmation must exactly match.</li>
          </ul>

          <div class="actions" style="margin-top:14px">
            <div class="row grow">
              <button id="pw-back" class="btn-secondary" type="button">Back</button>
            </div>
            <div class="row">
              <button id="pw-save" class="btn-primary" type="submit" disabled>Save password</button>
            </div>
          </div>
        </form>
      </section>

      <!-- Success — §5.6 -->
      <section id="view-success" hidden>
        <h2>Your password has been reset.</h2>
        <p class="helper">You can now sign in with your new password.</p>
        <div class="actions" style="justify-content:center;margin-top:12px">
          <button id="success-back" class="btn-primary" type="button">Back to Sign in</button>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer — §3 -->
  <footer>
    This is a client-only demo. No emails or SMS are sent. Open the browser console to see simulated delivery logs.
  </footer>

  <!-- Script — Core logic; comments mapped to requirement sections -->
  <script>
    // Data Model — §11
    window.__demoLastSetPassword = null;
    const RecoveryDemo = {
      user: {
        username: "testuser",
        email: "jane.doe@example.com"
      },
      state: {
        currentView: "start",
        latestCode: null,
        latestCodeIssuedAt: 0,
        failedCodeAttempts: 0,
        newPasswordTemp: null,
        lockedFromAttempts: false,
        expired: false
      }
    };
    // Utility helpers — §§4,9,12
    const $ = (sel, root=document) => root.querySelector(sel);
    const $all = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const clamp = (n, min, max) => Math.max(min, Math.min(max, n));
    const maskEmail = () => "ja***@example.com"; // per §6 masking
    const now = () => Date.now();
    const CODE_TTL_MS = 5 * 60 * 1000; // §9 5 minutes

    // Mock Delivery — §7
    function issueCode(reason="issue"){
      // Generate a new 6-digit pseudo-random code; invalidate older codes — §7
      const code = String(Math.floor(100000 + Math.random() * 900000));
      RecoveryDemo.state.latestCode = code;
      RecoveryDemo.state.latestCodeIssuedAt = now();
      RecoveryDemo.state.failedCodeAttempts = 0;
      RecoveryDemo.state.lockedFromAttempts = false;
      RecoveryDemo.state.expired = false;
      // Console protocol exact format — §7
      console.log(`[RecoveryDemo] Delivering mock reset code via EMAIL to ${RecoveryDemo.user.email}`);
      console.log(`[RecoveryDemo] CODE: ${code}`);
      console.log(`[RecoveryDemo] RESET LINK: https://example.com/reset?token=RESET-TOKEN-ABC123 (demo only)`);
      return code;
    }

    // View Controller — §§3,4
    const Views = {
      order: ["start","identify","delivery","code","setPassword","success"],
      show(viewName){
        RecoveryDemo.state.currentView = viewName;
        for(const name of this.order){
          const el = document.getElementById("view-" + (name === "setPassword" ? "setPassword" : name));
          if(!el) continue;
          if(name === viewName){
            el.hidden = false;
          }else{
            el.hidden = true;
          }
        }
        // Focus management: first interactive element — §4
        setTimeout(() => {
          const container = this.getContainer(viewName);
          if(!container) return;
          const focusable = container.querySelector('input:not([type="hidden"]):not([disabled]), button:not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], [tabindex]:not([tabindex="-1"])');
          if(focusable){ focusable.focus(); }
        }, 0);
      },
      getContainer(viewName){
        const id = "view-" + (viewName === "setPassword" ? "setPassword" : viewName);
        return document.getElementById(id);
      }
    };

    // Simulated delays — §4
    function delayRandom(min=600, max=1200){
      const ms = Math.floor(min + Math.random() * (max - min));
      return new Promise(res => setTimeout(res, ms));
    }
    function delay(ms){ return new Promise(res => setTimeout(res, ms)); }

    // App wiring — §12
    document.addEventListener("DOMContentLoaded", init);
    function init(){
      // Populate masked email in UI — §5.3
      $("#masked-email").textContent = "(" + maskEmail() + ")";

      // Start view — §5.1
      $("#btn-forgot").addEventListener("click", onClickForgot);

      // Identify — §5.2
      const identifyInput = $("#identify-input");
      const identifyContinue = $("#identify-continue");
      const identifyBack = $("#identify-back");
      identifyInput.addEventListener("input", () => {
        identifyInput.value = identifyInput.value.trimStart(); // prevent leading spaces
        identifyContinue.disabled = identifyInput.value.trim().length === 0;
        clearIdentifyError();
      });
      identifyBack.addEventListener("click", () => onClickBack("start"));
      $("#form-identify").addEventListener("submit", onSubmitIdentify);

      // Delivery — §5.3
      $("#delivery-back").addEventListener("click", () => onClickBack("identify"));
      $("#delivery-send").addEventListener("click", onClickSendCode);

      // Code — §5.4
      const codeInput = $("#code-input");
      codeInput.addEventListener("input", onCodeInput);
      $("#code-back").addEventListener("click", () => onClickBack("delivery"));
      $("#code-resend").addEventListener("click", onClickResend);
      $("#form-code").addEventListener("submit", onSubmitCode);

      // Set Password — §5.5 and §8
      $("#pw-back").addEventListener("click", () => onClickBack("code"));
      $("#pw-show").addEventListener("change", onToggleShowPassword);
      $("#pw1").addEventListener("input", onPasswordInput);
      $("#pw2").addEventListener("input", onPasswordInput);
      $("#form-password").addEventListener("submit", onSubmitNewPassword);

      // Success — §5.6
      $("#success-back").addEventListener("click", onSuccessBack);

      // Initial view — §3
      Views.show("start");
    }

    // Events & Handlers — §12
    function onClickForgot(){
      // Navigate to Identify — §12 onClickForgot
      resetIdentifyView();
      Views.show("identify");
    }

    function onClickBack(target){
      // Clear transient UI state when navigating back — §3, §9
      switch(target){
        case "start":
          resetAllTransient();
          Views.show("start");
          break;
        case "identify":
          resetDeliveryView();
          Views.show("identify");
          break;
        case "delivery":
          resetCodeView();
          Views.show("delivery");
          break;
        case "code":
          resetPasswordView();
          Views.show("code");
          break;
      }
    }

    async function onSubmitIdentify(e){
      e.preventDefault();
      const input = $("#identify-input");
      const val = input.value.trim();
      if(val.length === 0) return;
      const btn = $("#identify-continue");
      const loader = $("#identify-loading");
      const error = $("#identify-error");
      error.textContent = "";
      btn.disabled = true;
      loader.hidden = false;

      await delayRandom();

      const match = identifierMatches(val);
      if(match){
        // Issue a code immediately on identification — §§5.2,7
        issueCode("identify");
        loader.hidden = true;
        btn.disabled = false;
        resetDeliveryView();
        Views.show("delivery");
      } else {
        loader.hidden = true;
        btn.disabled = false;
        error.textContent = "We couldn’t find that account.";
        input.focus();
        input.select();
      }
    }

    async function onClickSendCode(){
      const btn = $("#delivery-send");
      const loader = $("#delivery-loading");
      const notice = $("#delivery-notice");
      btn.disabled = true;
      loader.hidden = false;
      notice.textContent = "";
      await delayRandom();
      issueCode("send");
      loader.hidden = true;
      notice.textContent = "We’ve sent a code to your email (check console in this demo).";
      // Auto-advance to Code after 1–2s — §5.3
      await delay(1000 + Math.floor(Math.random()*800));
      resetCodeView();
      // Prefill notice on Code screen to guide user
      $("#code-notice").textContent = "Code sent. Use the latest one shown in the console.";
      Views.show("code");
    }

    function onCodeInput(){
      const input = $("#code-input");
      // Only digits; allow paste — §5.4
      const digits = (input.value || "").replace(/\D+/g, "").slice(0,6);
      if(digits !== input.value){ input.value = digits; }
      const verify = $("#code-verify");
      const locked = RecoveryDemo.state.lockedFromAttempts || RecoveryDemo.state.expired;
      verify.disabled = digits.length !== 6 || locked;
      // Clear notices/errors when user types again
      if(!locked){
        $("#code-error").textContent = "";
      }
    }

    async function onSubmitCode(e){
      e.preventDefault();
      const input = $("#code-input");
      const code = (input.value || "").trim();
      const verifyBtn = $("#code-verify");
      const errorEl = $("#code-error");
      const noticeEl = $("#code-notice");
      errorEl.textContent = "";
      noticeEl.textContent = "";

      if(RecoveryDemo.state.lockedFromAttempts){
        errorEl.textContent = "Too many attempts. Please resend a new code.";
        return;
      }
      // Expiry check — §9
      if(now() - RecoveryDemo.state.latestCodeIssuedAt > CODE_TTL_MS){
        RecoveryDemo.state.expired = true;
        verifyBtn.disabled = true;
        errorEl.textContent = "This code has expired. Please resend a new code.";
        return;
      }

      if(code.length !== 6){
        return;
      }

      if(code === RecoveryDemo.state.latestCode){
        // Success → go Set Password — §5.4
        resetPasswordView();
        Views.show("setPassword");
      } else {
        RecoveryDemo.state.failedCodeAttempts += 1;
        if(RecoveryDemo.state.failedCodeAttempts >= 3){
          RecoveryDemo.state.lockedFromAttempts = true;
          verifyBtn.disabled = true;
          errorEl.textContent = "Too many attempts. Please resend a new code.";
        } else {
          const remaining = 3 - RecoveryDemo.state.failedCodeAttempts;
          errorEl.textContent = "That code is incorrect. " + (remaining>0 ? `You have ${remaining} attempt${remaining===1?"":"s"} left.` : "");
          input.select();
        }
      }
    }

    function onClickResend(){
      // Resend: issue new code; reset attempts; notify — §5.4
      issueCode("resend");
      RecoveryDemo.state.failedCodeAttempts = 0;
      RecoveryDemo.state.lockedFromAttempts = false;
      RecoveryDemo.state.expired = false;
      $("#code-error").textContent = "";
      $("#code-notice").textContent = "New code sent. Use the latest one.";
      $("#code-verify").disabled = ($("#code-input").value.trim().length !== 6);
      $("#code-input").focus();
      $("#code-input").select();
    }

    function onToggleShowPassword(e){
      const show = $("#pw-show").checked;
      const type = show ? "text" : "password";
      $("#pw1").type = type;
      $("#pw2").type = type;
    }

    function onPasswordInput(){
      const pw1 = $("#pw1").value;
      const pw2 = $("#pw2").value;
      const evaluation = evaluatePassword(pw1, pw2);
      applyPasswordUI(evaluation);
    }

    function evaluatePassword(pw1, pw2){
      // Rules — §8
      const minLen = pw1.length >= 10;
      const hasLower = /[a-z]/.test(pw1);
      const hasUpper = /[A-Z]/.test(pw1);
      const hasDigit = /\d/.test(pw1);
      const hasSymbol = /[^A-Za-z0-9]/.test(pw1);
      const classesMetCount = [hasLower,hasUpper,hasDigit,hasSymbol].filter(Boolean).length;
      const classesOK = classesMetCount >= 3;
      const localPart = RecoveryDemo.user.email.split("@")[0]; // "jane.doe"
      const containsUserOrLocal = pw1.toLowerCase().includes(RecoveryDemo.user.username.toLowerCase()) ||
                                  pw1.toLowerCase().includes(localPart.toLowerCase());
      const excludes = !containsUserOrLocal;
      const match = pw1.length > 0 && pw1 === pw2;

      // Strength: simple meter — §8
      let strength = "Weak";
      if(minLen && classesMetCount >= 3) strength = "Okay";
      if(pw1.length >= 12 && classesMetCount >= 4) strength = "Strong";

      return { minLen, classesOK, excludes, match, strength, pw1, pw2, classesMetCount };
    }

    function applyPasswordUI(ev){
      const pill = $("#pw-strength-pill");
      pill.textContent = ev.strength;
      pill.className = "pill " + (ev.strength === "Strong" ? "strong" : ev.strength === "Okay" ? "okay" : "weak");

      // Checklist updates — §8
      toggleRule("#rule-length", ev.minLen);
      toggleRule("#rule-classes", ev.classesOK);
      toggleRule("#rule-excludes", ev.excludes);
      toggleRule("#rule-match", ev.match);

      // Enable Save only when all core rules met
      $("#pw-save").disabled = !(ev.minLen && ev.classesOK && ev.excludes && ev.match);
    }

    function toggleRule(sel, ok){
      const el = $(sel);
      el.classList.toggle("ok", !!ok);
    }

    function onSubmitNewPassword(e){
      e.preventDefault();
      const ev = evaluatePassword($("#pw1").value, $("#pw2").value);
      applyPasswordUI(ev);
      if(ev.minLen && ev.classesOK && ev.excludes && ev.match){
        // Store in-memory only — §8
        window.__demoLastSetPassword = ev.pw1;
        RecoveryDemo.state.newPasswordTemp = ev.pw1;
        resetSuccessView();
        Views.show("success");
      }
    }

    function onSuccessBack(){
      // Return to Start and clear transient UI state — §5.6
      resetAllTransient(true);
      Views.show("start");
    }

    // Helpers: identity matching — §6
    function identifierMatches(val){
      const v = val.trim().toLowerCase();
      return v === RecoveryDemo.user.username.toLowerCase() ||
             v === RecoveryDemo.user.email.toLowerCase();
    }

    // Reset/clear view state helpers — §9
    function resetIdentifyView(){
      $("#identify-input").value = "";
      $("#identify-continue").disabled = true;
      clearIdentifyError();
      $("#identify-loading").hidden = true;
    }
    function clearIdentifyError(){
      $("#identify-error").textContent = "";
    }
    function resetDeliveryView(){
      $("#delivery-notice").textContent = "";
      $("#delivery-loading").hidden = true;
      $("#delivery-send").disabled = false;
      $("#del-email").checked = true;
    }
    function resetCodeView(){
      $("#code-input").value = "";
      $("#code-error").textContent = "";
      $("#code-notice").textContent = "";
      $("#code-verify").disabled = true;
      RecoveryDemo.state.failedCodeAttempts = 0;
      RecoveryDemo.state.lockedFromAttempts = false;
      RecoveryDemo.state.expired = false;
    }
    function resetPasswordView(){
      $("#pw1").value = "";
      $("#pw2").value = "";
      $("#pw-show").checked = false;
      $("#pw1").type = "password";
      $("#pw2").type = "password";
      applyPasswordUI(evaluatePassword("", ""));
    }
    function resetSuccessView(){
      // No specific fields; placeholder if needed
    }
    function resetAllTransient(clearCode = false){
      resetIdentifyView();
      resetDeliveryView();
      resetCodeView();
      resetPasswordView();
      if(clearCode){
        RecoveryDemo.state.latestCode = null;
        RecoveryDemo.state.latestCodeIssuedAt = 0;
        RecoveryDemo.state.failedCodeAttempts = 0;
        RecoveryDemo.state.lockedFromAttempts = false;
        RecoveryDemo.state.expired = false;
        RecoveryDemo.state.newPasswordTemp = null;
      }
    }

    // Keyboard support: Enter submits active form; Esc does nothing special — §4
    // Forms already handle submit. No Esc handler.

    // Expiry check timer (optional visual); core check is done on verification — §9
    // Not required to display remaining time; functional expiry enforced in onSubmitCode.
  </script>
</body>
</html>
