{"code_html": "\n<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Password Recovery Demo</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <style>\n    /* ===============================\n       Styles mapped to §4 Visual/Interaction Requirements\n       =============================== */\n    :root{\n      --bg:#f7f7fb;\n      --card:#fff;\n      --text:#1f2937;\n      --muted:#6b7280;\n      --primary:#2563eb;\n      --primary-600:#1d4ed8;\n      --danger:#dc2626;\n      --success:#059669;\n      --warning:#d97706;\n      --border:#e5e7eb;\n      --focus:#9333ea;\n    }\n    *{box-sizing:border-box}\n    html,body{height:100%}\n    body{\n      margin:0;\n      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;\n      background:var(--bg);\n      color:var(--text);\n      line-height:1.4;\n    }\n    header, footer{\n      text-align:center;\n      padding:16px 12px;\n    }\n    header h1{\n      margin:0;\n      font-size:1.25rem;\n      font-weight:700;\n    }\n    .container{\n      display:grid;\n      place-items:center;\n      padding:12px;\n    }\n    .card{\n      width:100%;\n      max-width:440px; /* per §4 */\n      background:var(--card);\n      border:1px solid var(--border);\n      border-radius:12px;\n      box-shadow:0 6px 24px rgba(0,0,0,0.06);\n      padding:20px;\n    }\n    h2{\n      margin:0 0 8px 0;\n      font-size:1.15rem;\n    }\n    p{\n      margin:6px 0 12px 0;\n      color:var(--muted);\n    }\n    form{\n      margin-top:8px;\n    }\n    label{\n      display:block;\n      font-weight:600;\n      margin-bottom:6px;\n    }\n    .field{\n      margin-bottom:14px;\n    }\n    input[type=\"text\"],\n    input[type=\"email\"],\n    input[type=\"password\"]{\n      width:100%;\n      padding:12px 12px;\n      min-height:44px; /* tap target per §4 */\n      border:1px solid var(--border);\n      border-radius:8px;\n      font-size:16px;\n      outline:none;\n      background:#fff;\n      color:var(--text);\n    }\n    input[type=\"text\"]:focus,\n    input[type=\"email\"]:focus,\n    input[type=\"password\"]:focus{\n      border-color:var(--focus);\n      box-shadow:0 0 0 3px rgba(147,51,234,0.15);\n    }\n    .row{\n      display:flex;\n      gap:10px;\n      flex-wrap:wrap;\n    }\n    .btn{\n      display:inline-flex;\n      align-items:center;\n      justify-content:center;\n      padding:0 16px;\n      min-height:44px;\n      border-radius:8px;\n      border:1px solid transparent;\n      cursor:pointer;\n      font-weight:600;\n      text-align:center;\n      user-select:none;\n      transition:background .15s, color .15s, border-color .15s, opacity .15s;\n    }\n    .btn.primary{\n      background:var(--primary);\n      color:#fff;\n    }\n    .btn.primary:hover{ background:var(--primary-600); }\n    .btn.secondary{\n      background:#fff;\n      color:var(--text);\n      border-color:var(--border);\n    }\n    .btn.secondary:hover{ border-color:#cfd3d8; }\n    .btn.link{\n      background:transparent;\n      border:none;\n      color:var(--primary);\n      padding:0;\n      min-height:auto;\n      height:auto;\n    }\n    .btn[disabled], .btn:disabled{\n      opacity:.6;\n      cursor:not-allowed;\n    }\n    .help{\n      font-size:.9rem;\n      color:var(--muted);\n    }\n    .error{\n      color:var(--danger);\n      font-size:.92rem;\n      margin-top:6px;\n    }\n    .status{\n      color:var(--success);\n      font-size:.92rem;\n      margin-top:6px;\n    }\n    .warn{\n      color:var(--warning);\n      font-size:.92rem;\n      margin-top:6px;\n    }\n    .inline-spinner{\n      display:inline-block;\n      min-width:1ch;\n      margin-left:8px;\n      color:var(--muted);\n      font-style:italic;\n    }\n    .radio{\n      display:flex;\n      gap:10px;\n      align-items:center;\n      padding:10px 12px;\n      border:1px solid var(--border);\n      border-radius:8px;\n    }\n    .radio input{\n      width:20px; height:20px;\n    }\n    .muted{\n      color:var(--muted);\n    }\n    ul.rules{\n      list-style:none;\n      padding-left:0;\n      margin:8px 0 8px;\n    }\n    ul.rules li{\n      display:flex;\n      align-items:center;\n      gap:8px;\n      margin:4px 0;\n      color:var(--muted);\n      font-size:.95rem;\n    }\n    ul.rules li .dot{\n      width:10px; height:10px;\n      border-radius:50%;\n      background:#d1d5db;\n      display:inline-block;\n    }\n    ul.rules li.pass{\n      color:var(--success);\n    }\n    ul.rules li.pass .dot{\n      background:var(--success);\n    }\n    .strength{\n      font-weight:700;\n    }\n    .strength.weak{ color:var(--danger); }\n    .strength.okay{ color:#2563eb; }\n    .strength.strong{ color:var(--success); }\n    .top-space{ margin-top:18px; }\n    .center{ text-align:center; }\n    .sr-only{\n      position:absolute !important;\n      height:1px; width:1px;\n      overflow:hidden;\n      clip:rect(1px,1px,1px,1px);\n      white-space:nowrap;\n      border:0; padding:0; margin:-1px;\n    }\n    footer small{\n      color:var(--muted);\n      display:block;\n      max-width:680px;\n      margin:0 auto;\n    }\n  </style>\n</head>\n<body>\n  <!-- ===============================\n       Header per §3 Page Architecture\n       =============================== -->\n  <header>\n    <h1>Password Recovery Demo</h1>\n  </header>\n\n  <div class=\"container\">\n    <div class=\"card\" role=\"region\" aria-label=\"Password recovery card\">\n      <!-- ===============================\n           §5.1 Start\n           =============================== -->\n      <section id=\"view-start\">\n        <h2>Welcome</h2>\n        <p>This is a self-contained demo. Sign-in is disabled; use “Forgot your password?” to try the recovery flow.</p>\n        <form id=\"signInForm\" aria-describedby=\"start-note\">\n          <div class=\"field\">\n            <label for=\"signin-email\">Email</label>\n            <input id=\"signin-email\" type=\"email\" autocomplete=\"username\" placeholder=\"you@example.com\" aria-describedby=\"start-note\">\n          </div>\n          <div class=\"field\">\n            <label for=\"signin-password\">Password</label>\n            <input id=\"signin-password\" type=\"password\" autocomplete=\"current-password\" placeholder=\"••••••••••\">\n          </div>\n          <div id=\"start-note\" class=\"help\">Sign-in is disabled in this demo.</div>\n          <div class=\"row top-space\">\n            <button class=\"btn primary\" type=\"submit\" disabled aria-disabled=\"true\">Sign in</button>\n            <button id=\"forgotBtn\" class=\"btn link\" type=\"button\" aria-describedby=\"start-note\">Forgot your password?</button>\n          </div>\n        </form>\n      </section>\n\n      <!-- ===============================\n           §5.2 Identify Account\n           =============================== -->\n      <section id=\"view-identify\" hidden>\n        <h2>Identify your account</h2>\n        <p>Enter your email or username.</p>\n        <form id=\"identifyForm\" novalidate>\n          <div class=\"field\">\n            <label for=\"identifier\">Email or username</label>\n            <input id=\"identifier\" type=\"text\" autocomplete=\"email username\" placeholder=\"e.g., jane.doe@example.com or testuser\" required>\n            <div id=\"identifyError\" class=\"error\" aria-live=\"polite\"></div>\n          </div>\n          <div class=\"row\">\n            <button id=\"identifyBack\" type=\"button\" class=\"btn secondary\">Back</button>\n            <button id=\"identifyContinue\" type=\"submit\" class=\"btn primary\" disabled>Continue</button>\n            <span id=\"identifyWait\" class=\"inline-spinner\" aria-live=\"polite\"></span>\n          </div>\n        </form>\n      </section>\n\n      <!-- ===============================\n           §5.3 Choose Delivery Method\n           =============================== -->\n      <section id=\"view-delivery\" hidden>\n        <h2>Choose how to receive your code</h2>\n        <p class=\"muted\">Email is available in this demo.</p>\n        <form id=\"deliveryForm\">\n          <div class=\"field\">\n            <label class=\"sr-only\" for=\"delivery-email\">Email</label>\n            <div class=\"radio\">\n              <input id=\"delivery-email\" type=\"radio\" name=\"delivery\" value=\"email\" checked>\n              <div>\n                <div><strong>Email</strong></div>\n                <div class=\"help\">ja***@example.com</div>\n              </div>\n            </div>\n          </div>\n          <div id=\"deliveryStatus\" class=\"status\" aria-live=\"polite\"></div>\n          <div class=\"row top-space\">\n            <button id=\"deliveryBack\" type=\"button\" class=\"btn secondary\">Back</button>\n            <button id=\"sendCodeBtn\" type=\"submit\" class=\"btn primary\">Send code</button>\n            <span id=\"deliveryWait\" class=\"inline-spinner\" aria-live=\"polite\"></span>\n          </div>\n        </form>\n      </section>\n\n      <!-- ===============================\n           §5.4 Enter Code\n           =============================== -->\n      <section id=\"view-code\" hidden>\n        <h2>Enter code</h2>\n        <p>Enter the 6-digit code we sent to your email (check console in this demo). Sent to ja***@example.com.</p>\n        <form id=\"codeForm\" novalidate>\n          <div class=\"field\">\n            <label for=\"codeInput\">6-digit code</label>\n            <input id=\"codeInput\" type=\"text\" inputmode=\"numeric\" autocomplete=\"one-time-code\" placeholder=\"••••••\" aria-describedby=\"codeHelp codeError codeInfo\" maxlength=\"6\">\n            <div id=\"codeHelp\" class=\"help\">Numbers only. You can paste the code.</div>\n            <div id=\"codeError\" class=\"error\" aria-live=\"polite\"></div>\n            <div id=\"codeInfo\" class=\"status\" aria-live=\"polite\"></div>\n          </div>\n          <div class=\"row\">\n            <button id=\"codeBack\" type=\"button\" class=\"btn secondary\">Back</button>\n            <button id=\"verifyBtn\" type=\"submit\" class=\"btn primary\" disabled>Verify</button>\n            <button id=\"resendBtn\" type=\"button\" class=\"btn link\">Resend code</button>\n          </div>\n        </form>\n      </section>\n\n      <!-- ===============================\n           §5.5 Set New Password\n           =============================== -->\n      <section id=\"view-setpassword\" hidden>\n        <h2>Create a new password</h2>\n        <p>Choose a strong password and confirm it below.</p>\n        <form id=\"passwordForm\" novalidate>\n          <div class=\"field\">\n            <label for=\"pw1\">New password</label>\n            <input id=\"pw1\" type=\"password\" autocomplete=\"new-password\" placeholder=\"At least 10 characters\">\n          </div>\n          <div class=\"field\">\n            <label for=\"pw2\">Confirm password</label>\n            <input id=\"pw2\" type=\"password\" autocomplete=\"new-password\" placeholder=\"Re-enter password\">\n          </div>\n          <div class=\"field\">\n            <label class=\"radio\" style=\"gap:8px; padding:0; border:none\">\n              <input id=\"toggleShowPw\" type=\"checkbox\">\n              <span>Show password</span>\n            </label>\n          </div>\n          <div class=\"field\">\n            <div>Strength: <span id=\"strengthText\" class=\"strength weak\">Weak</span></div>\n            <ul class=\"rules\" aria-live=\"polite\">\n              <li id=\"rule-length\"><span class=\"dot\"></span> Password must be at least 10 characters.</li>\n              <li id=\"rule-classes\"><span class=\"dot\"></span> Include at least 3 types: lowercase, uppercase, number, symbol.</li>\n              <li id=\"rule-excludes\"><span class=\"dot\"></span> Must not contain “testuser” or “jane.doe”.</li>\n              <li id=\"rule-match\"><span class=\"dot\"></span> Confirmation matches.</li>\n            </ul>\n            <div id=\"pwErrors\" class=\"error\" aria-live=\"polite\"></div>\n          </div>\n          <div class=\"row top-space\">\n            <button id=\"passwordBack\" type=\"button\" class=\"btn secondary\">Back</button>\n            <button id=\"savePasswordBtn\" type=\"submit\" class=\"btn primary\" disabled>Save password</button>\n          </div>\n        </form>\n      </section>\n\n      <!-- ===============================\n           §5.6 Success\n           =============================== -->\n      <section id=\"view-success\" hidden class=\"center\">\n        <h2>Your password has been reset.</h2>\n        <p class=\"muted\">You can now return to the sign-in screen.</p>\n        <div class=\"top-space\">\n          <button id=\"backToSignIn\" type=\"button\" class=\"btn primary\">Back to Sign in</button>\n        </div>\n      </section>\n    </div>\n  </div>\n\n  <!-- ===============================\n       Footer per §3\n       =============================== -->\n  <footer>\n    <small>\n      Demo only. No real emails are sent; codes are printed to the console for this study. No data is persisted.\n    </small>\n  </footer>\n\n  <script>\n    /* ===============================\n       JS Architecture mapped to §10 & §12\n       =============================== */\n\n    // §11 Data Model (In-Memory Only)\n    const Model = {\n      user: {\n        username: \"testuser\",\n        email: \"jane.doe@example.com\"\n      },\n      state: {\n        currentView: \"start\", // \"start\" | \"identify\" | \"delivery\" | \"code\" | \"setPassword\" | \"success\"\n        latestCode: null,\n        latestCodeIssuedAt: null,\n        failedCodeAttempts: 0,\n        newPasswordTemp: null,\n        verifyLocked: false,\n        expiredLock: false\n      }\n    };\n    window.__demoLastSetPassword = null; // per §6 and §14\n\n    // Constants for masking and expiry\n    const MASKED_EMAIL = \"ja***@example.com\"; // §6 masking\n    const CODE_EXPIRY_MS = 5 * 60 * 1000; // §9: 5 minutes\n\n    // Cache DOM elements for performance\n    const Views = {\n      start: document.getElementById(\"view-start\"),\n      identify: document.getElementById(\"view-identify\"),\n      delivery: document.getElementById(\"view-delivery\"),\n      code: document.getElementById(\"view-code\"),\n      setPassword: document.getElementById(\"view-setpassword\"),\n      success: document.getElementById(\"view-success\")\n    };\n\n    // Identify form elements\n    const identifyForm = document.getElementById(\"identifyForm\");\n    const identifyInput = document.getElementById(\"identifier\");\n    const identifyError = document.getElementById(\"identifyError\");\n    const identifyContinue = document.getElementById(\"identifyContinue\");\n    const identifyBack = document.getElementById(\"identifyBack\");\n    const identifyWait = document.getElementById(\"identifyWait\");\n\n    // Delivery form elements\n    const deliveryForm = document.getElementById(\"deliveryForm\");\n    const sendCodeBtn = document.getElementById(\"sendCodeBtn\");\n    const deliveryBack = document.getElementById(\"deliveryBack\");\n    const deliveryStatus = document.getElementById(\"deliveryStatus\");\n    const deliveryWait = document.getElementById(\"deliveryWait\");\n\n    // Code form elements\n    const codeForm = document.getElementById(\"codeForm\");\n    const codeInput = document.getElementById(\"codeInput\");\n    const verifyBtn = document.getElementById(\"verifyBtn\");\n    const codeBack = document.getElementById(\"codeBack\");\n    const codeError = document.getElementById(\"codeError\");\n    const codeInfo = document.getElementById(\"codeInfo\");\n    const resendBtn = document.getElementById(\"resendBtn\");\n\n    // Password form elements\n    const passwordForm = document.getElementById(\"passwordForm\");\n    const pw1 = document.getElementById(\"pw1\");\n    const pw2 = document.getElementById(\"pw2\");\n    const toggleShowPw = document.getElementById(\"toggleShowPw\");\n    const strengthText = document.getElementById(\"strengthText\");\n    const ruleLength = document.getElementById(\"rule-length\");\n    const ruleClasses = document.getElementById(\"rule-classes\");\n    const ruleExcludes = document.getElementById(\"rule-excludes\");\n    const ruleMatch = document.getElementById(\"rule-match\");\n    const pwErrors = document.getElementById(\"pwErrors\");\n    const passwordBack = document.getElementById(\"passwordBack\");\n    const savePasswordBtn = document.getElementById(\"savePasswordBtn\");\n\n    // Start view elements\n    const forgotBtn = document.getElementById(\"forgotBtn\");\n    const backToSignIn = document.getElementById(\"backToSignIn\");\n\n    // Utility: show one view, hide others, manage focus (§4 focus management)\n    function showView(name) {\n      Model.state.currentView = name;\n      Object.entries(Views).forEach(([key, el]) => {\n        if (key === nameMap(name)) {\n          el.hidden = false;\n        } else {\n          el.hidden = true;\n        }\n      });\n      // Move focus to the first interactive element in the shown view\n      const current = Views[nameMap(name)];\n      setTimeout(() => {\n        const focusable = current.querySelector('input:not([disabled]), button:not([disabled]), select:not([disabled]), textarea:not([disabled])');\n        if (focusable) focusable.focus();\n      }, 0);\n    }\n    function nameMap(name){\n      // Normalize mapping to object keys\n      switch(name){\n        case \"start\": return \"start\";\n        case \"identify\": return \"identify\";\n        case \"delivery\": return \"delivery\";\n        case \"code\": return \"code\";\n        case \"setPassword\": return \"setPassword\";\n        case \"success\": return \"success\";\n        default: return \"start\";\n      }\n    }\n\n    // Utility: random delay promise (for \"Please wait...\" UI) §4 Loading\n    function delay(min=600, max=1200){\n      const ms = Math.floor(Math.random() * (max - min + 1)) + min;\n      return new Promise(res => setTimeout(res, ms));\n    }\n\n    // §7 Mock Delivery: issueCode()\n    function generateSixDigit() {\n      return String(Math.floor(100000 + Math.random() * 900000));\n    }\n    function issueCode() {\n      // Generate a new 6-digit code; ensure change on resend\n      let code = generateSixDigit();\n      if (Model.state.latestCode && code === Model.state.latestCode) {\n        // Ensure it's different\n        code = generateSixDigit();\n      }\n      Model.state.latestCode = code;\n      Model.state.latestCodeIssuedAt = Date.now();\n      Model.state.failedCodeAttempts = 0;\n      Model.state.verifyLocked = false;\n      Model.state.expiredLock = false;\n\n      // Exact console protocol per §7\n      console.log(\"[RecoveryDemo] Delivering mock reset code via EMAIL to jane.doe@example.com\");\n      console.log(\"[RecoveryDemo] CODE: \" + code);\n      console.log(\"[RecoveryDemo] RESET LINK: https://example.com/reset?token=RESET-TOKEN-ABC123 (demo only)\");\n    }\n\n    // §12: Handlers\n\n    // onClickForgot() → show Identify.\n    function onClickForgot(){\n      clearIdentifyErrors();\n      identifyInput.value = \"\";\n      identifyContinue.disabled = true;\n      showView(\"identify\");\n    }\n\n    // onSubmitIdentify(identifier)\n    async function onSubmitIdentify(e){\n      e.preventDefault();\n      clearIdentifyErrors();\n      const raw = (identifyInput.value || \"\").trim();\n      if (!raw) {\n        identifyError.textContent = \"Please enter an email or username.\";\n        return;\n      }\n      const id = raw.toLowerCase();\n      const matches = (id === Model.user.username.toLowerCase()) || (id === Model.user.email.toLowerCase());\n      if (!matches) {\n        identifyError.textContent = \"We couldn’t find that account.\";\n        return;\n      }\n      // Simulate lookup delay\n      setIdentifyBusy(true);\n      await delay();\n      issueCode(); // §5.2 & §7: console log on successful identification\n      setIdentifyBusy(false);\n      showView(\"delivery\");\n      resetDeliveryStatus();\n    }\n\n    function setIdentifyBusy(busy){\n      identifyWait.textContent = busy ? \"Please wait…\" : \"\";\n      identifyContinue.disabled = busy;\n      identifyBack.disabled = busy;\n    }\n    function clearIdentifyErrors(){\n      identifyError.textContent = \"\";\n    }\n\n    // onClickSendCode() – simulate \"sending\" UI then auto-advance (no new code per §7)\n    async function onClickSendCode(e){\n      e.preventDefault();\n      deliveryStatus.textContent = \"\";\n      setDeliveryBusy(true);\n      await delay();\n      // Do NOT issue a new code here; per §7, logging occurs on identify or when user taps Resend.\n      setDeliveryBusy(false);\n      deliveryStatus.textContent = \"We’ve sent a code to your email (check console in this demo).\";\n      // Auto-advance after 1–2s\n      await delay(1000, 2000);\n      codeInput.value = \"\";\n      codeError.textContent = \"\";\n      codeInfo.textContent = \"\";\n      updateVerifyButton();\n      showView(\"code\");\n    }\n    function setDeliveryBusy(busy){\n      deliveryWait.textContent = busy ? \"Please wait…\" : \"\";\n      sendCodeBtn.disabled = busy;\n      deliveryBack.disabled = busy;\n    }\n    function resetDeliveryStatus(){\n      deliveryStatus.textContent = \"\";\n      deliveryWait.textContent = \"\";\n    }\n\n    // Numeric-only handling for code input\n    function onCodeInputChanged(){\n      const sanitized = (codeInput.value || \"\").replace(/\\D+/g, \"\").slice(0,6);\n      if (sanitized !== codeInput.value) codeInput.value = sanitized;\n      codeError.textContent = \"\";\n      // If locked due to expiry or attempts, keep Verify disabled\n      updateVerifyButton();\n    }\n\n    function updateVerifyButton(){\n      const lenOk = codeInput.value.trim().length === 6;\n      verifyBtn.disabled = !(lenOk && !Model.state.verifyLocked && !Model.state.expiredLock);\n      if (Model.state.verifyLocked) {\n        codeError.textContent = \"Too many attempts. Please resend a new code.\";\n      } else if (Model.state.expiredLock) {\n        codeError.textContent = \"This code has expired. Please resend a new code.\";\n      }\n    }\n\n    // onSubmitCode(code)\n    function onSubmitCode(e){\n      e.preventDefault();\n      if (Model.state.verifyLocked || Model.state.expiredLock) {\n        updateVerifyButton();\n        return;\n      }\n      const code = (codeInput.value || \"\").trim();\n      if (code.length !== 6) {\n        codeError.textContent = \"Please enter the 6-digit code.\";\n        updateVerifyButton();\n        return;\n      }\n      // Expiry check\n      const issuedAt = Model.state.latestCodeIssuedAt || 0;\n      const age = Date.now() - issuedAt;\n      if (!issuedAt || age > CODE_EXPIRY_MS) {\n        Model.state.expiredLock = true;\n        codeError.textContent = \"This code has expired. Please resend a new code.\";\n        updateVerifyButton();\n        return;\n      }\n      if (code === Model.state.latestCode) {\n        // success\n        codeError.textContent = \"\";\n        codeInfo.textContent = \"\";\n        showView(\"setPassword\");\n        updatePasswordUI(); // reset strength/checks\n        return;\n      }\n      // wrong code\n      Model.state.failedCodeAttempts++;\n      const attemptsLeft = 3 - Model.state.failedCodeAttempts;\n      if (Model.state.failedCodeAttempts >= 3) {\n        Model.state.verifyLocked = true;\n        codeError.textContent = \"Too many attempts. Please resend a new code.\";\n      } else {\n        codeError.textContent = \"That code is incorrect.\" + (attemptsLeft > 0 ? \" \" + attemptsLeft + \" attempt(s) left.\" : \"\");\n      }\n      updateVerifyButton();\n    }\n\n    // onClickResend()\n    function onClickResend(){\n      issueCode();\n      codeInput.value = \"\";\n      codeError.textContent = \"\";\n      codeInfo.textContent = \"New code sent. Use the latest one.\";\n      updateVerifyButton();\n      codeInput.focus();\n    }\n\n    // Password validation per §8\n    function classifyPassword(pw){\n      const hasLower = /[a-z]/.test(pw);\n      const hasUpper = /[A-Z]/.test(pw);\n      const hasDigit = /\\d/.test(pw);\n      const hasSymbol = /[^A-Za-z0-9]/.test(pw);\n      const classesCount = [hasLower, hasUpper, hasDigit, hasSymbol].filter(Boolean).length;\n      return { hasLower, hasUpper, hasDigit, hasSymbol, classesCount };\n    }\n    function containsUserInfo(pw){\n      const user = Model.user.username.toLowerCase();\n      const local = Model.user.email.split(\"@\")[0].toLowerCase(); // \"jane.doe\"\n      const p = (pw || \"\").toLowerCase();\n      return p.includes(user) || p.includes(local);\n    }\n    function strengthLabel(pw, classesCount){\n      const len = (pw || \"\").length;\n      if (len >= 12 && classesCount >= 3) return \"Strong\";\n      if (len >= 10 && classesCount >= 3) return \"Okay\";\n      return \"Weak\";\n    }\n    function updatePasswordUI(){\n      const a = pw1.value || \"\";\n      const b = pw2.value || \"\";\n\n      // Evaluate rules\n      const lengthOk = a.length >= 10;\n      const classes = classifyPassword(a);\n      const classesOk = classes.classesCount >= 3;\n      const excludesOk = !containsUserInfo(a);\n      const matchOk = a.length > 0 && a === b;\n\n      // Checklist UI\n      toggleRule(ruleLength, lengthOk);\n      toggleRule(ruleClasses, classesOk);\n      toggleRule(ruleExcludes, excludesOk);\n      toggleRule(ruleMatch, matchOk);\n\n      // Strength label\n      const label = strengthLabel(a, classes.classesCount);\n      strengthText.textContent = label;\n      strengthText.classList.remove(\"weak\",\"okay\",\"strong\");\n      strengthText.classList.add(label.toLowerCase() === \"strong\" ? \"strong\" : (label.toLowerCase() === \"okay\" ? \"okay\" : \"weak\"));\n\n      // Error hints (non-blocking, but show a single most relevant)\n      pwErrors.textContent = \"\";\n      if (a && !lengthOk) pwErrors.textContent = \"Password must be at least 10 characters.\";\n      else if (a && !classesOk) pwErrors.textContent = \"Add a number or symbol to make it stronger.\";\n      else if (a && !excludesOk) pwErrors.textContent = \"Password must not include your username or email.\";\n      else if (b && !matchOk) pwErrors.textContent = \"Confirmation does not match.\";\n\n      // Enable/disable save button\n      const allOk = lengthOk && classesOk && excludesOk && matchOk;\n      savePasswordBtn.disabled = !allOk;\n    }\n    function toggleRule(el, pass){\n      el.classList.toggle(\"pass\", !!pass);\n    }\n\n    function onToggleShowPw(){\n      const type = toggleShowPw.checked ? \"text\" : \"password\";\n      pw1.type = type;\n      pw2.type = type;\n    }\n\n    // onSubmitNewPassword(pw1, pw2)\n    function onSubmitNewPassword(e){\n      e.preventDefault();\n      updatePasswordUI();\n      if (savePasswordBtn.disabled) return;\n      const newPw = pw1.value;\n      Model.state.newPasswordTemp = newPw;\n      window.__demoLastSetPassword = newPw; // store in-memory per §6/§8/§14\n      // Clear sensitive fields\n      pw1.value = \"\";\n      pw2.value = \"\";\n      updatePasswordUI();\n      showView(\"success\");\n    }\n\n    // Back navigation helpers with transient clean-up\n    function goBackFromDelivery(){\n      resetDeliveryStatus();\n      showView(\"identify\");\n    }\n    function goBackFromCode(){\n      codeError.textContent = \"\";\n      codeInfo.textContent = \"\";\n      showView(\"delivery\");\n    }\n    function goBackFromPassword(){\n      pwErrors.textContent = \"\";\n      showView(\"code\");\n    }\n\n    // Reset flow to Start (§5.6)\n    function resetFlowToStart(){\n      // Clear transient state\n      Model.state.currentView = \"start\";\n      Model.state.latestCode = null;\n      Model.state.latestCodeIssuedAt = null;\n      Model.state.failedCodeAttempts = 0;\n      Model.state.newPasswordTemp = null;\n      Model.state.verifyLocked = false;\n      Model.state.expiredLock = false;\n\n      // Clear UI fields/messages\n      identifyInput.value = \"\";\n      identifyError.textContent = \"\";\n      identifyWait.textContent = \"\";\n      identifyContinue.disabled = true;\n\n      deliveryStatus.textContent = \"\";\n      deliveryWait.textContent = \"\";\n\n      codeInput.value = \"\";\n      codeError.textContent = \"\";\n      codeInfo.textContent = \"\";\n      verifyBtn.disabled = true;\n\n      pw1.value = \"\";\n      pw2.value = \"\";\n      toggleShowPw.checked = false;\n      onToggleShowPw();\n      updatePasswordUI();\n\n      showView(\"start\");\n    }\n\n    // Event wiring\n    document.getElementById(\"forgotBtn\").addEventListener(\"click\", onClickForgot);\n\n    identifyInput.addEventListener(\"input\", () => {\n      identifyError.textContent = \"\";\n      identifyContinue.disabled = (identifyInput.value.trim().length === 0);\n    });\n    identifyBack.addEventListener(\"click\", () => showView(\"start\"));\n    identifyForm.addEventListener(\"submit\", onSubmitIdentify);\n\n    deliveryBack.addEventListener(\"click\", goBackFromDelivery);\n    deliveryForm.addEventListener(\"submit\", onClickSendCode);\n\n    codeInput.addEventListener(\"input\", onCodeInputChanged);\n    codeBack.addEventListener(\"click\", goBackFromCode);\n    resendBtn.addEventListener(\"click\", onClickResend);\n    codeForm.addEventListener(\"submit\", onSubmitCode);\n\n    pw1.addEventListener(\"input\", updatePasswordUI);\n    pw2.addEventListener(\"input\", updatePasswordUI);\n    toggleShowPw.addEventListener(\"change\", onToggleShowPw);\n    passwordBack.addEventListener(\"click\", goBackFromPassword);\n    passwordForm.addEventListener(\"submit\", onSubmitNewPassword);\n\n    backToSignIn.addEventListener(\"click\", resetFlowToStart);\n\n    // Initialize UI\n    showView(\"start\");\n    updatePasswordUI(); // initialize rules UI\n  </script>\n</body>\n</html>\n", "task_list": ["Ensure resend always changes the code: modify issueCode() to loop until a newly generated code differs from the previous Model.state.latestCode (e.g., do/while) so the new code is guaranteed to be different."], "evaluator_md": "SUMMARY:\nThe single-file demo implements the entire “Forgot password” flow with polished UI, inline validation, mocked delivery via console logs, and correct state transitions. It adheres closely to the requirements and meets all Acceptance Criteria. Focus management, accessibility basics, attempt limits, and code expiry are handled. One minor requirement-level observation: the resend code is intended to always change; the current implementation reduces the chance of repetition but does not guarantee uniqueness.\n\nFUNCTIONAL_CHECK:\n- Single index.html renders without errors and no external network calls: PASS — One HTML file with inline CSS/JS. No fetches or external assets.\n- Flow includes all states in §5 and transitions work as described: PASS — Start, Identify, Delivery, Code, Set New Password, Success present; transitions and Back buttons implemented per spec, with auto-advance from Delivery to Code after 1–2s.\n- Hardcoded account in §6 recognized; any other identifier rejected with inline error: PASS — case-insensitive match against \"testuser\" or \"jane.doe@example.com\"; otherwise shows “We couldn’t find that account.”\n- Sending/Resending logs to console exactly in the format of §7; latest code only is valid: PASS — On Identify success and on Resend, logs three lines with the exact format; latest code replaces previous and is the only valid one.\n- Code entry enforces 6 digits; wrong code attempts count and lock after 3 until Resend: PASS — Input sanitized to digits, max length 6; Verify disabled until 6 digits; after 3 wrong attempts, Verify locks and message instructs to resend; Resend resets attempts/lock.\n- Code expires after ~5 minutes (client timer): PASS — latestCodeIssuedAt tracked; age checked against 5 minutes; sets expired lock and disables Verify until Resend.\n- Password rules in §8 enforced with inline checklist and strength hint: PASS — Length ≥10, 3 of 4 character classes, excludes username/local part, and match enforced; checklist turns green; strength shows Weak/Okay/Strong; inline hints provided.\n- On success, window.__demoLastSetPassword equals the new password; Success screen shown: PASS — Saved to window.__demoLastSetPassword; transitions to Success, with Back to Sign in resetting the flow.\n- Buttons reflect disabled/enabled state based on validity; focus moves correctly on each screen change: PASS — Controls are disabled appropriately during invalid or busy states; showView focuses first interactive element each time.\n- Works on desktop and mobile sizes; layout remains readable: PASS — Responsive centered card (max-width ~440px), 44px min tap targets, clear layout/styles.\n- No libraries required; if used, must be embedded and not fetch externally: PASS — Vanilla JS/CSS only.\n\nFAILING_ITEMS:\n- Resend must always produce a different 6-digit code per §7; current implementation only retries once if the same code is generated, which does not strictly guarantee a change (extremely low, but non-zero chance of repetition).\n\nNEW_TASKS:\n1. Ensure resend always changes the code: modify issueCode() to loop until a newly generated code differs from the previous Model.state.latestCode (e.g., do/while) so the new code is guaranteed to be different.\n\nDECISION:\nPASS", "done": true, "iter": 1}
