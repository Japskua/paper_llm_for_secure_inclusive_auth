{"code_html": "\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <!--\n    Password Recovery System — Requirements (Single-Page, Client-Only, Mocked)\n    - One file: index.html\n    - Semantic HTML, inline CSS & JS\n    - Commented sections mapping to this spec\n    - All logic runs entirely in the browser (no backend)\n    - \"Delivery\" and verification simulated via console.log and deterministic mock values\n    - UX considers Helena (67, heart disease, ADHD): calm, accessible, step-by-step, high contrast option, larger text controls, clear guidance\n    - Not for production use\n  -->\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <meta name=\"color-scheme\" content=\"light dark\">\n  <title>City Hospital — Password Recovery (Mock)</title>\n  <style>\n    /* Requirement: Inline CSS; accessible, semantic, self-contained */\n    :root{\n      --base-font-size: 18px; /* Adjustable for readability */\n      --bg: #f7f9fb;\n      --fg: #0f172a;\n      --muted: #475569;\n      --primary: #0ea5e9; /* sky-500 */\n      --primary-contrast: #ffffff;\n      --accent: #16a34a; /* green-600 */\n      --warn: #b91c1c; /* red-700 */\n      --border: #cbd5e1;\n      --card: #ffffff;\n      --focus: #f59e0b; /* amber */\n      --shadow: 0 10px 30px rgba(2,8,23,0.06);\n    }\n    .high-contrast{\n      --bg:#ffffff;\n      --fg:#000000;\n      --muted:#1a1a1a;\n      --primary:#000000;\n      --primary-contrast:#ffffff;\n      --accent:#0a0;\n      --warn:#b00;\n      --border:#000000;\n      --card:#ffffff;\n      --focus:#ff8800;\n      --shadow:none;\n    }\n    @media (prefers-color-scheme: dark){\n      :root{\n        --bg:#0b1220;\n        --fg:#e5e7eb;\n        --muted:#cbd5e1;\n        --border:#334155;\n        --card:#0f172a;\n        --shadow: 0 10px 30px rgba(0,0,0,0.4);\n      }\n    }\n    html,body{\n      height:100%;\n    }\n    body{\n      margin:0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      font-size: var(--base-font-size);\n      color: var(--fg);\n      background: radial-gradient(1200px 700px at 10% -10%, rgba(14,165,233,0.08), transparent 60%),\n                  radial-gradient(1000px 600px at 110% 10%, rgba(22,163,74,0.05), transparent 50%),\n                  var(--bg);\n      line-height: 1.45;\n    }\n    a{ color: var(--primary); }\n    .container{\n      max-width: 880px;\n      margin: 0 auto;\n      padding: 16px;\n    }\n    header[role=\"banner\"]{\n      display:flex;\n      justify-content: space-between;\n      align-items:center;\n      gap: 12px;\n      padding: 12px 0 8px;\n    }\n    .brand{\n      display:flex;\n      align-items:center;\n      gap:12px;\n    }\n    .logo{\n      width:40px; height:40px; border-radius:8px; background: var(--primary);\n      display:grid; place-items:center; color:var(--primary-contrast); font-weight:700;\n      box-shadow: var(--shadow);\n    }\n    .brand h1{\n      font-size: 1.1rem;\n      margin:0;\n    }\n    .assist{\n      display:flex; align-items:center; gap:8px; flex-wrap: wrap;\n    }\n    .assist button{\n      border:1px solid var(--border);\n      background: var(--card);\n      color: var(--fg);\n      border-radius: 10px;\n      padding: 8px 10px;\n      min-height:44px; min-width:44px;\n      cursor: pointer;\n    }\n    .assist .toggle{\n      display:flex; align-items:center; gap:8px;\n    }\n    .assist input[type=\"checkbox\"]{\n      width:22px; height:22px;\n    }\n\n    main{\n      display:grid; grid-template-columns: 1fr; gap: 16px;\n    }\n    .card{\n      background: var(--card);\n      border:1px solid var(--border);\n      border-radius: 16px;\n      box-shadow: var(--shadow);\n      padding: clamp(16px, 2.5vw, 28px);\n    }\n    .two-col{\n      display:grid; gap:20px;\n      grid-template-columns: 1fr;\n    }\n    @media (min-width: 900px){\n      .two-col{ grid-template-columns: 2fr 1fr; }\n    }\n    .progress{\n      display:flex; gap:8px; align-items:center; flex-wrap: wrap;\n    }\n    .step{\n      display:flex; align-items:center; gap:8px;\n      padding:8px 12px; border-radius:999px;\n      border:1px solid var(--border);\n      background: var(--card);\n      color: var(--muted);\n    }\n    .step[aria-current=\"step\"]{\n      border-color: var(--primary);\n      color: var(--fg);\n      box-shadow: inset 0 0 0 2px rgba(14,165,233,0.15);\n    }\n    .sr-only{\n      position:absolute !important; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0;\n    }\n    form{\n      display:grid; gap:16px;\n    }\n    fieldset{\n      border: none; padding: 0; margin: 0; display:grid; gap: 12px;\n    }\n    label{ font-weight: 600; }\n    .hint{ color: var(--muted); font-size: 0.95rem; }\n    .help-box{\n      background: linear-gradient(0deg, rgba(14,165,233,0.08), rgba(14,165,233,0.08));\n      border: 1px solid var(--border);\n      border-radius: 12px;\n      padding: 12px;\n    }\n    input[type=\"text\"], input[type=\"tel\"], input[type=\"email\"], input[type=\"password\"]{\n      width:100%;\n      padding: 12px 14px;\n      border-radius: 12px;\n      border:1px solid var(--border);\n      background: var(--card);\n      color: var(--fg);\n      font-size: 1rem;\n      min-height: 48px;\n    }\n    input:focus, select:focus, button:focus{\n      outline: 3px solid transparent;\n      box-shadow: 0 0 0 3px var(--focus);\n    }\n    .btn-row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }\n    .btn{\n      border:none;\n      background: var(--primary);\n      color: var(--primary-contrast);\n      padding: 12px 18px;\n      border-radius: 12px;\n      min-height: 48px;\n      cursor: pointer;\n      font-weight: 600;\n    }\n    .btn.secondary{\n      background: transparent;\n      color: var(--primary);\n      border:1px solid var(--primary);\n    }\n    .btn.ghost{\n      background: transparent;\n      color: var(--fg);\n      border:1px dashed var(--border);\n    }\n    .btn:disabled{\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n    .error{\n      color: var(--warn);\n      font-weight: 600;\n    }\n    .status{\n      color: var(--accent);\n      font-weight: 600;\n    }\n    .code-inputs{\n      display:flex; gap: 8px; justify-content: start; align-items:center; flex-wrap:wrap;\n    }\n    .code-inputs input{\n      width: 46px; height: 58px;\n      text-align: center;\n      font-size: 1.2rem;\n      letter-spacing: 2px;\n    }\n    .radio-card{\n      display:flex; gap:12px; align-items:center;\n      border:1px solid var(--border);\n      border-radius: 12px;\n      padding: 12px;\n      background: var(--card);\n    }\n    .radio-card input{ width:22px; height:22px; }\n    .requirements{\n      display:grid; gap: 6px; margin-top: 4px;\n    }\n    .req{\n      display:flex; align-items:center; gap:10px; color: var(--muted);\n    }\n    .req.ok{ color: var(--accent); }\n    .meter{\n      height:10px; border-radius:999px; background: #e5e7eb; overflow:hidden; border:1px solid var(--border);\n    }\n    .meter > span{\n      display:block; height:100%; width:0%;\n      background: linear-gradient(90deg, #f87171, #fbbf24, #34d399, #10b981);\n      transition: width .25s ease;\n    }\n    .muted{\n      color: var(--muted);\n    }\n    footer{\n      margin-top: 24px; color: var(--muted);\n      font-size: 0.95rem;\n    }\n    /* Larger hit areas for accessibility */\n    .tap-area{ min-height: 44px; min-width: 44px; display:inline-flex; align-items:center; justify-content:center; }\n  </style>\n</head>\n<body>\n  <!-- Requirement: Semantic header and assistive controls for readability and contrast -->\n  <div class=\"container\">\n    <header role=\"banner\" aria-label=\"City Hospital account recovery\">\n      <div class=\"brand\">\n        <div class=\"logo\" aria-hidden=\"true\">CH</div>\n        <div>\n          <h1>City Hospital — Account Recovery</h1>\n          <p class=\"muted\" id=\"subtitle\">Reset your password to sign in and accept the updated privacy statement.</p>\n        </div>\n      </div>\n      <div class=\"assist\" aria-label=\"Accessibility options\">\n        <div class=\"toggle\">\n          <button class=\"tap-area\" id=\"fontDown\" title=\"Decrease text size\" aria-label=\"Decrease text size\">A−</button>\n          <button class=\"tap-area\" id=\"fontUp\" title=\"Increase text size\" aria-label=\"Increase text size\">A+</button>\n        </div>\n        <label class=\"toggle\"><input type=\"checkbox\" id=\"contrastToggle\" aria-label=\"High contrast mode\"> High contrast</label>\n        <label class=\"toggle\"><input type=\"checkbox\" id=\"calmToggle\" aria-label=\"Calm mode (reduce motion)\"> Calm mode</label>\n      </div>\n    </header>\n\n    <!-- Requirement: Progress indicator for step-by-step clarity -->\n    <nav class=\"progress\" aria-label=\"Progress\">\n      <div class=\"step\" id=\"stepBadge1\" aria-current=\"step\"><span aria-hidden=\"true\">1</span> Identify</div>\n      <div class=\"step\" id=\"stepBadge2\"><span aria-hidden=\"true\">2</span> Delivery</div>\n      <div class=\"step\" id=\"stepBadge3\"><span aria-hidden=\"true\">3</span> Verify</div>\n      <div class=\"step\" id=\"stepBadge4\"><span aria-hidden=\"true\">4</span> New password</div>\n      <div class=\"step\" id=\"stepBadge5\"><span aria-hidden=\"true\">5</span> Done</div>\n    </nav>\n\n    <main id=\"app\" class=\"two-col\" role=\"main\">\n      <section class=\"card\" aria-labelledby=\"heading\">\n        <div aria-live=\"polite\" aria-atomic=\"true\" class=\"sr-only\" id=\"live-region\"></div>\n\n        <!-- Requirement: Step 1 — Identify account -->\n        <section id=\"step-1\" role=\"region\" aria-labelledby=\"h-step-1\">\n          <h2 id=\"h-step-1\" tabindex=\"-1\">Find your account</h2>\n          <p class=\"hint\">Enter your email or mobile number. We will send you a 6‑digit code to reset your password.</p>\n          <form id=\"form-identify\" novalidate>\n            <fieldset>\n              <label for=\"identifier\">Email or mobile number</label>\n              <input id=\"identifier\" name=\"identifier\" type=\"text\" inputmode=\"email\"\n                     autocomplete=\"username\" placeholder=\"e.g., helena@example.com or +1 555 0134\"\n                     required aria-describedby=\"id-hint id-error\" />\n              <div id=\"id-hint\" class=\"hint\">Tip: For Helena (demo), use helena@example.com</div>\n              <div id=\"id-error\" class=\"error\" role=\"alert\" hidden></div>\n            </fieldset>\n            <div class=\"btn-row\">\n              <button type=\"submit\" class=\"btn\" id=\"btn-identify\">Continue</button>\n              <button type=\"button\" class=\"btn ghost\" id=\"btn-help\">Need help?</button>\n            </div>\n          </form>\n        </section>\n\n        <!-- Requirement: Step 2 — Choose delivery method (mocked) -->\n        <section id=\"step-2\" role=\"region\" aria-labelledby=\"h-step-2\" hidden>\n          <h2 id=\"h-step-2\" tabindex=\"-1\">Choose how to get your code</h2>\n          <p class=\"hint\" id=\"delivery-mask\"></p>\n          <form id=\"form-delivery\">\n            <fieldset role=\"radiogroup\" aria-labelledby=\"h-step-2\">\n              <label class=\"radio-card\">\n                <input type=\"radio\" name=\"method\" value=\"email\" checked />\n                <span>\n                  <strong>Email a 6‑digit code</strong><br />\n                  <span class=\"muted\" id=\"maskedEmail\">h••••@example.com</span>\n                </span>\n              </label>\n              <label class=\"radio-card\">\n                <input type=\"radio\" name=\"method\" value=\"sms\" />\n                <span>\n                  <strong>Text a 6‑digit code</strong><br />\n                  <span class=\"muted\" id=\"maskedPhone\">••• ••• 0134</span>\n                </span>\n              </label>\n            </fieldset>\n            <div class=\"btn-row\">\n              <button type=\"button\" class=\"btn\" id=\"btn-send\">Send code</button>\n              <button type=\"button\" class=\"btn secondary\" id=\"back-2\">Back</button>\n            </div>\n          </form>\n          <div class=\"help-box\" role=\"note\">\n            For your security, we only show partial contact details.\n          </div>\n        </section>\n\n        <!-- Requirement: Step 3 — Enter and verify code (deterministic, console.log) -->\n        <section id=\"step-3\" role=\"region\" aria-labelledby=\"h-step-3\" hidden>\n          <h2 id=\"h-step-3\" tabindex=\"-1\">Enter the 6‑digit code</h2>\n          <p class=\"hint\" id=\"code-sent-hint\">We sent a code to your chosen method.</p>\n          <form id=\"form-verify\" novalidate>\n            <fieldset>\n              <legend class=\"sr-only\">Verification code</legend>\n              <div class=\"code-inputs\" aria-describedby=\"code-hint code-error\">\n                <input inputmode=\"numeric\" autocomplete=\"one-time-code\" pattern=\"[0-9]*\" aria-label=\"Digit 1\" maxlength=\"1\" />\n                <input inputmode=\"numeric\" autocomplete=\"one-time-code\" pattern=\"[0-9]*\" aria-label=\"Digit 2\" maxlength=\"1\" />\n                <input inputmode=\"numeric\" autocomplete=\"one-time-code\" pattern=\"[0-9]*\" aria-label=\"Digit 3\" maxlength=\"1\" />\n                <input inputmode=\"numeric\" autocomplete=\"one-time-code\" pattern=\"[0-9]*\" aria-label=\"Digit 4\" maxlength=\"1\" />\n                <input inputmode=\"numeric\" autocomplete=\"one-time-code\" pattern=\"[0-9]*\" aria-label=\"Digit 5\" maxlength=\"1\" />\n                <input inputmode=\"numeric\" autocomplete=\"one-time-code\" pattern=\"[0-9]*\" aria-label=\"Digit 6\" maxlength=\"1\" />\n              </div>\n              <div id=\"code-hint\" class=\"hint\">You can paste the entire code.</div>\n              <div id=\"code-error\" class=\"error\" role=\"alert\" hidden></div>\n            </fieldset>\n            <div class=\"btn-row\">\n              <button type=\"submit\" class=\"btn\" id=\"btn-verify\" disabled>Verify code</button>\n              <button type=\"button\" class=\"btn secondary\" id=\"btn-resend\" disabled>Resend code (20s)</button>\n              <button type=\"button\" class=\"btn ghost\" id=\"back-3\">Back</button>\n            </div>\n          </form>\n          <div class=\"help-box\" role=\"note\">\n            If you didn’t receive the code, wait and tap “Resend”. Check your spam folder or messages.\n          </div>\n        </section>\n\n        <!-- Requirement: Step 4 — Set new password with guidance and strength meter -->\n        <section id=\"step-4\" role=\"region\" aria-labelledby=\"h-step-4\" hidden>\n          <h2 id=\"h-step-4\" tabindex=\"-1\">Create a new password</h2>\n          <p class=\"hint\">Choose a strong password you have not used before.</p>\n          <form id=\"form-reset\" novalidate>\n            <fieldset>\n              <label for=\"new-pass\">New password</label>\n              <div>\n                <input id=\"new-pass\" type=\"password\" autocomplete=\"new-password\" required aria-describedby=\"pass-reqs pass-error\" />\n              </div>\n              <div class=\"meter\" aria-hidden=\"true\"><span id=\"strengthBar\"></span></div>\n              <div id=\"pass-reqs\" class=\"requirements\" aria-live=\"polite\">\n                <div class=\"req\" id=\"req-length\">• At least 8 characters</div>\n                <div class=\"req\" id=\"req-upper\">• Contains an uppercase letter</div>\n                <div class=\"req\" id=\"req-lower\">• Contains a lowercase letter</div>\n                <div class=\"req\" id=\"req-digit\">• Contains a number</div>\n                <div class=\"req\" id=\"req-unique\">• Does not contain your email or name</div>\n              </div>\n              <div id=\"pass-error\" class=\"error\" role=\"alert\" hidden></div>\n            </fieldset>\n            <fieldset>\n              <label for=\"confirm-pass\">Confirm new password</label>\n              <input id=\"confirm-pass\" type=\"password\" autocomplete=\"new-password\" required aria-describedby=\"confirm-error\" />\n              <div id=\"confirm-error\" class=\"error\" role=\"alert\" hidden></div>\n            </fieldset>\n            <div class=\"btn-row\">\n              <button type=\"submit\" class=\"btn\" id=\"btn-reset\" disabled>Save new password</button>\n              <button type=\"button\" class=\"btn secondary\" id=\"back-4\">Back</button>\n            </div>\n          </form>\n          <div class=\"help-box\" role=\"note\">\n            Tip for Helena: A passphrase with 3–4 words and numbers can be easier to remember.\n          </div>\n        </section>\n\n        <!-- Requirement: Step 5 — Success (mock update via console.log) -->\n        <section id=\"step-5\" role=\"region\" aria-labelledby=\"h-step-5\" hidden>\n          <h2 id=\"h-step-5\" tabindex=\"-1\">Password reset complete</h2>\n          <p class=\"status\">Your password was updated successfully.</p>\n          <p>You can now sign in to your account and accept the updated privacy statement.</p>\n          <div class=\"btn-row\">\n            <button type=\"button\" class=\"btn\" id=\"btn-finish\">Back to sign in</button>\n            <button type=\"button\" class=\"btn secondary\" id=\"btn-start-over\">Start over</button>\n          </div>\n          <div class=\"help-box\" role=\"note\">\n            For this demo, no real account changes are made. All actions are simulated in your browser.\n          </div>\n        </section>\n      </section>\n\n      <!-- Requirement: Supportive sidebar content for clarity (no backend) -->\n      <aside class=\"card\" aria-labelledby=\"h-support\">\n        <h2 id=\"h-support\">Need assistance?</h2>\n        <p class=\"muted\">This is a safe demonstration environment. No data leaves your browser.</p>\n        <ul>\n          <li><strong>Mock user</strong>: helena@example.com</li>\n          <li><strong>Deterministic code</strong>: 246810</li>\n          <li><strong>Support</strong>: Call 1‑800‑HOSPITAL (Mon–Fri 8am–6pm)</li>\n        </ul>\n        <details>\n          <summary>What is mocked?</summary>\n          <ul>\n            <li>Code delivery is printed to the JavaScript console.</li>\n            <li>Verification checks against a fixed code.</li>\n            <li>No server or network calls are made.</li>\n          </ul>\n        </details>\n        <details>\n          <summary>Privacy note</summary>\n          <p>In a real system, contact details would be verified and codes would expire quickly. This demo is for evaluation only.</p>\n        </details>\n      </aside>\n    </main>\n\n    <footer role=\"contentinfo\">\n      <p>© City Hospital (Demo). Client-only password recovery flow for academic AI evaluation.</p>\n    </footer>\n  </div>\n\n  <script>\n    /* Requirement: Inline JS; all logic in-browser; mocked delivery and deterministic verification */\n\n    // Accessibility & preferences\n    (function setupAssist(){\n      const html = document.documentElement;\n      const down = document.getElementById('fontDown');\n      const up = document.getElementById('fontUp');\n      const contrast = document.getElementById('contrastToggle');\n      const calm = document.getElementById('calmToggle');\n\n      let size = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--base-font-size')) || 18;\n      const applySize = () => document.documentElement.style.setProperty('--base-font-size', size + 'px');\n      applySize();\n\n      down.addEventListener('click', () => { size = Math.max(16, size - 1); applySize(); live('Text size decreased'); });\n      up.addEventListener('click', () => { size = Math.min(22, size + 1); applySize(); live('Text size increased'); });\n\n      contrast.addEventListener('change', (e) => {\n        if(e.target.checked){ document.body.classList.add('high-contrast'); live('High contrast on'); }\n        else { document.body.classList.remove('high-contrast'); live('High contrast off'); }\n      });\n\n      // Calm mode reduces transitions; we keep CSS minimal but can disable progress animation\n      calm.addEventListener('change', (e) => {\n        if(e.target.checked){\n          document.body.style.setProperty('transition', 'none');\n          document.querySelectorAll('*').forEach(el => el.style.transition = 'none');\n          live('Calm mode on');\n        }else{\n          document.body.style.removeProperty('transition');\n          document.querySelectorAll('*').forEach(el => el.style.transition = '');\n          live('Calm mode off');\n        }\n      });\n    })();\n\n    // Mock data and state\n    const MOCK_PROFILE = {\n      name: 'Helena',\n      email: 'helena@example.com',\n      phone: '+1 555 0134'\n    };\n    const DETERMINISTIC_CODE = '246810'; // Requirement: deterministic mock verification code\n    let state = {\n      step: 1,\n      identifier: '',\n      chosenMethod: 'email', // 'email' | 'sms'\n      maskedEmail: '',\n      maskedPhone: '',\n      codeSentAt: 0,\n      resendCooldown: 20,\n      verifyAttempts: 0,\n      codeTimerId: null\n    };\n\n    // Utility: live region for screen readers\n    function live(msg){ const r = document.getElementById('live-region'); r.textContent = msg; }\n\n    // Utility: mask email/phone safely\n    function maskEmail(email){\n      if(!email || !email.includes('@')) return '••••@••••';\n      const [user, domain] = email.split('@');\n      const u = user.length ? user[0] + '•'.repeat(Math.max(0, Math.min(4, user.length-1))) : '•••';\n      const d = domain.replace(/[^.]/g, '•');\n      return `${u}@${d}`;\n    }\n    function digitsOnly(s){ return (s||'').replace(/\\D/g,''); }\n    function maskPhone(phone){\n      const d = digitsOnly(phone);\n      if(d.length < 2) return '••• ••• ••••';\n      const last = d.slice(-4);\n      return '••• ••• ' + last;\n    }\n    function isEmail(input){ return /@/.test(input); }\n\n    // Step navigation helpers\n    function showStep(n){\n      state.step = n;\n      ['step-1','step-2','step-3','step-4','step-5'].forEach((id, i) => {\n        const el = document.getElementById(id);\n        if(!el) return;\n        el.hidden = (i+1) !== n;\n      });\n      // progress badges\n      for(let i=1;i<=5;i++){\n        const b = document.getElementById('stepBadge'+i);\n        if(!b) continue;\n        b.setAttribute('aria-current', i===n ? 'step' : 'false');\n      }\n      // focus heading\n      const h = document.querySelector('#step-'+n+' h2');\n      if(h){ h.focus(); }\n    }\n\n    // Step 1: Identify\n    (function setupIdentify(){\n      const form = document.getElementById('form-identify');\n      const input = document.getElementById('identifier');\n      const err = document.getElementById('id-error');\n      const help = document.getElementById('btn-help');\n      input.value = '';\n\n      help.addEventListener('click', () => {\n        alert('Tip: Enter your email or mobile number.\\nDemo account: helena@example.com\\nAll actions are simulated locally.');\n      });\n\n      form.addEventListener('submit', (e) => {\n        e.preventDefault();\n        err.hidden = true;\n        const id = input.value.trim();\n        if(!id){\n          err.textContent = 'Please enter your email or mobile number.';\n          err.hidden = false;\n          input.focus();\n          return;\n        }\n        state.identifier = id;\n        // Prepare masked details\n        const known = id.toLowerCase() === MOCK_PROFILE.email || digitsOnly(id) === digitsOnly(MOCK_PROFILE.phone);\n        state.maskedEmail = known ? maskEmail(MOCK_PROFILE.email) : maskEmail(isEmail(id) ? id : 'account@example.com');\n        state.maskedPhone = known ? maskPhone(MOCK_PROFILE.phone) : maskPhone(digitsOnly(id) || '0000');\n        // Default method preference based on input type\n        state.chosenMethod = isEmail(id) ? 'email' : 'sms';\n        // Update UI for step 2\n        document.getElementById('delivery-mask').textContent =\n          'For ' + (known ? 'your account' : 'the provided contact') + ', choose a delivery method:';\n        document.getElementById('maskedEmail').textContent = state.maskedEmail;\n        document.getElementById('maskedPhone').textContent = state.maskedPhone;\n        // Set radio default\n        document.querySelector('#form-delivery input[value=\"email\"]').checked = state.chosenMethod === 'email';\n        document.querySelector('#form-delivery input[value=\"sms\"]').checked = state.chosenMethod === 'sms';\n        showStep(2);\n        live('Account found. Choose delivery method.');\n      });\n    })();\n\n    // Step 2: Choose delivery & \"send\" code\n    (function setupDelivery(){\n      const back = document.getElementById('back-2');\n      const btn = document.getElementById('btn-send');\n\n      back.addEventListener('click', () => {\n        showStep(1);\n        live('Back to identify');\n      });\n\n      btn.addEventListener('click', () => {\n        // Get selected method\n        const method = document.querySelector('#form-delivery input[name=\"method\"]:checked')?.value || 'email';\n        state.chosenMethod = method;\n\n        // Mock delivery via console.log (Requirement)\n        const destination = method === 'email'\n          ? (state.identifier.toLowerCase() === MOCK_PROFILE.email ? MOCK_PROFILE.email : (isEmail(state.identifier) ? state.identifier : MOCK_PROFILE.email))\n          : (state.identifier ? state.identifier : MOCK_PROFILE.phone);\n\n        state.codeSentAt = Date.now();\n        console.log('[MockDelivery] method=', method.toUpperCase(), 'destination=', destination, 'code=', DETERMINISTIC_CODE, 'timestamp=', new Date().toISOString());\n\n        // Prepare Step 3 UI\n        const hint = document.getElementById('code-sent-hint');\n        hint.textContent = 'We sent a code via ' + (method === 'email' ? 'email' : 'text message') + ' to ' + (method==='email' ? state.maskedEmail : state.maskedPhone) + '.';\n        resetCodeInputs();\n        startResendCooldown();\n\n        showStep(3);\n        live('Code sent. Please enter the 6-digit code.');\n      });\n    })();\n\n    // Step 3: Verify code\n    (function setupVerify(){\n      const form = document.getElementById('form-verify');\n      const inputs = Array.from(form.querySelectorAll('.code-inputs input'));\n      const err = document.getElementById('code-error');\n      const verifyBtn = document.getElementById('btn-verify');\n      const resendBtn = document.getElementById('btn-resend');\n      const back = document.getElementById('back-3');\n\n      // Auto-advance and paste handling\n      inputs.forEach((inp, idx) => {\n        inp.addEventListener('input', (e) => {\n          const val = e.target.value.replace(/\\D/g,'').slice(0,1);\n          e.target.value = val;\n          if(val && idx < inputs.length-1){ inputs[idx+1].focus(); }\n          updateVerifyButton();\n        });\n        inp.addEventListener('keydown', (e) => {\n          if(e.key === 'Backspace' && !e.target.value && idx > 0){ inputs[idx-1].focus(); }\n          if(e.key === 'ArrowLeft' && idx > 0){ inputs[idx-1].focus(); }\n          if(e.key === 'ArrowRight' && idx < inputs.length-1){ inputs[idx+1].focus(); }\n        });\n        inp.addEventListener('paste', (e) => {\n          const text = (e.clipboardData || window.clipboardData).getData('text').replace(/\\D/g,'');\n          if(text && text.length >= 6){\n            e.preventDefault();\n            for(let i=0;i<6;i++){ inputs[i].value = text[i] || ''; }\n            inputs[5].focus();\n            updateVerifyButton();\n          }\n        });\n      });\n\n      function currentCode(){ return inputs.map(i => i.value).join(''); }\n      function updateVerifyButton(){\n        const ready = currentCode().length === 6;\n        verifyBtn.disabled = !ready;\n      }\n\n      resendBtn.addEventListener('click', () => {\n        // Re-send same deterministic code (Requirement)\n        const method = state.chosenMethod;\n        const destination = method === 'email'\n          ? (state.identifier.toLowerCase() === MOCK_PROFILE.email ? MOCK_PROFILE.email : (isEmail(state.identifier) ? state.identifier : MOCK_PROFILE.email))\n          : (state.identifier ? state.identifier : MOCK_PROFILE.phone);\n        state.codeSentAt = Date.now();\n        console.log('[MockDelivery:RESEND] method=', method.toUpperCase(), 'destination=', destination, 'code=', DETERMINISTIC_CODE, 'timestamp=', new Date().toISOString());\n        err.hidden = true;\n        resetCodeInputs();\n        startResendCooldown();\n        live('A new code was sent.');\n      });\n\n      back.addEventListener('click', () => {\n        clearInterval(state.codeTimerId);\n        showStep(2);\n        live('Back to delivery selection');\n      });\n\n      form.addEventListener('submit', (e) => {\n        e.preventDefault();\n        err.hidden = true;\n        const code = currentCode();\n        if(code === DETERMINISTIC_CODE){\n          clearInterval(state.codeTimerId);\n          state.verifyAttempts = 0;\n          showStep(4);\n          document.getElementById('new-pass').focus();\n          live('Code verified. Create a new password.');\n        }else{\n          state.verifyAttempts++;\n          err.textContent = 'That code is not correct. Please try again.';\n          err.hidden = false;\n          live('Incorrect code.');\n          if(state.verifyAttempts >= 5){\n            err.textContent = 'Too many attempts. You can request a new code or go back and choose a different method.';\n            resendBtn.disabled = false;\n          }\n        }\n      });\n    })();\n\n    function resetCodeInputs(){\n      const inputs = Array.from(document.querySelectorAll('#form-verify .code-inputs input'));\n      inputs.forEach(i => i.value = '');\n      const first = inputs[0];\n      if(first){ first.focus(); }\n      document.getElementById('btn-verify').disabled = true;\n      document.getElementById('code-error').hidden = true;\n    }\n\n    function startResendCooldown(){\n      const btn = document.getElementById('btn-resend');\n      const start = Date.now();\n      const wait = state.resendCooldown * 1000;\n      btn.disabled = true;\n      const tick = () => {\n        const left = Math.max(0, Math.ceil((wait - (Date.now() - start))/1000));\n        btn.textContent = left > 0 ? `Resend code (${left}s)` : 'Resend code';\n        if(left <= 0){\n          clearInterval(state.codeTimerId);\n          btn.disabled = false;\n          return;\n        }\n      };\n      tick();\n      clearInterval(state.codeTimerId);\n      state.codeTimerId = setInterval(tick, 300);\n    }\n\n    // Step 4: Reset password\n    (function setupReset(){\n      const form = document.getElementById('form-reset');\n      const newPass = document.getElementById('new-pass');\n      const confirm = document.getElementById('confirm-pass');\n      const passErr = document.getElementById('pass-error');\n      const confirmErr = document.getElementById('confirm-error');\n      const saveBtn = document.getElementById('btn-reset');\n      const back = document.getElementById('back-4');\n      const strengthBar = document.getElementById('strengthBar');\n\n      function userKeyParts(){\n        const id = state.identifier || '';\n        const email = (id.includes('@') ? id : MOCK_PROFILE.email).toLowerCase();\n        const user = email.split('@')[0];\n        const name = MOCK_PROFILE.name.toLowerCase();\n        return { user, name, digits: digitsOnly(id) };\n      }\n\n      function evaluate(pw){\n        const { user, name } = userKeyParts();\n        const rules = {\n          length: pw.length >= 8,\n          upper: /[A-Z]/.test(pw),\n          lower: /[a-z]/.test(pw),\n          digit: /[0-9]/.test(pw),\n          unique: !(pw.toLowerCase().includes(user) || pw.toLowerCase().includes(name))\n        };\n        const score = Object.values(rules).reduce((a,b)=>a+(b?1:0),0);\n        return { rules, score };\n      }\n\n      function updateUI(){\n        const pw = newPass.value;\n        const result = evaluate(pw);\n        // Toggle requirement indicators\n        setReq('req-length', result.rules.length);\n        setReq('req-upper', result.rules.upper);\n        setReq('req-lower', result.rules.lower);\n        setReq('req-digit', result.rules.digit);\n        setReq('req-unique', result.rules.unique);\n        // Strength bar\n        const pct = (result.score/5)*100;\n        strengthBar.style.width = pct + '%';\n        // Error messages\n        passErr.hidden = true;\n\n        // Confirm validation\n        if(confirm.value){\n          if(confirm.value !== pw){\n            confirmErr.textContent = 'Passwords do not match.';\n            confirmErr.hidden = false;\n          }else{\n            confirmErr.hidden = true;\n          }\n        }else{\n          confirmErr.hidden = true;\n        }\n\n        // Enable save button if all good\n        const allGood = Object.values(result.rules).every(Boolean) && confirm.value === pw && pw.length>0;\n        saveBtn.disabled = !allGood;\n      }\n\n      function setReq(id, ok){\n        const el = document.getElementById(id);\n        el.classList.toggle('ok', !!ok);\n        el.innerHTML = (ok ? '✓ ' : '• ') + el.textContent.replace(/^✓ |• /,'');\n      }\n\n      newPass.addEventListener('input', updateUI);\n      confirm.addEventListener('input', updateUI);\n\n      back.addEventListener('click', () => {\n        showStep(3);\n        live('Back to code verification');\n      });\n\n      form.addEventListener('submit', (e) => {\n        e.preventDefault();\n        const pw = newPass.value;\n        const { rules } = evaluate(pw);\n        if(!Object.values(rules).every(Boolean)){\n          passErr.textContent = 'Please meet all password requirements.';\n          passErr.hidden = false;\n          return;\n        }\n        if(confirm.value !== pw){\n          confirmErr.textContent = 'Passwords do not match.';\n          confirmErr.hidden = false;\n          return;\n        }\n        // Mock password update via console.log (Requirement)\n        const accountRef = (state.identifier || MOCK_PROFILE.email);\n        console.log('[MockUpdate] Password updated for account=', accountRef, 'time=', new Date().toISOString());\n        newPass.value = ''; confirm.value = '';\n        updateUI();\n        showStep(5);\n        live('Password updated successfully.');\n      });\n    })();\n\n    // Step 5: Success\n    (function setupSuccess(){\n      document.getElementById('btn-finish').addEventListener('click', () => {\n        // Return to start (mock \"sign in\" redirection)\n        showStep(1);\n        document.getElementById('identifier').focus();\n      });\n      document.getElementById('btn-start-over').addEventListener('click', () => {\n        location.reload();\n      });\n    })();\n\n    // Initialize app at step 1\n    showStep(1);\n\n    // Keyboard support for radio-card labels (improves accessibility)\n    document.querySelectorAll('.radio-card').forEach(card=>{\n      card.addEventListener('keydown', (e)=>{\n        const input = card.querySelector('input[type=\"radio\"]');\n        if((e.key === 'Enter' || e.key === ' ') && input){\n          e.preventDefault(); input.checked = true;\n        }\n      });\n      card.tabIndex = 0;\n    });\n\n    // Defensive: avoid accidental page navigation with backspace in empty inputs\n    window.addEventListener('keydown', (e)=>{\n      if(e.key === 'Backspace'){\n        const t = e.target;\n        const ok = ['INPUT','TEXTAREA'].includes(t.tagName);\n        if(!ok) e.preventDefault();\n      }\n    });\n  </script>\n</body>\n</html>\n", "task_list": [], "evaluator_md": "", "done": false, "iter": 1, "mode": "single"}
