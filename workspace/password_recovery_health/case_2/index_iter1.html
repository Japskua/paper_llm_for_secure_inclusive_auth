
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Password Recovery (Mock, Client-Only)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--
    Password Recovery System — Single-Page, Client-Only, Mocked

    Spec Mapping (Purpose, Use-case, Deliverables, Mocking):
    - Purpose: Provide a self-contained, browser-only password recovery flow for evaluation. Not for production.
    - Use-case: Helena (67, heart disease, ADHD) needs to reset her strong password to log in and accept updated privacy conditions to allow hospital staff to book an appointment.
    - Deliverables: One index.html (this file) using semantic HTML, inline CSS & JS. No build step. Sections are commented to map to the spec.
    - Mocking: Delivery and verification are simulated through deterministic code generation and console.log outputs. No servers or external calls.

    Developer testing note:
    - Open this file in any modern browser (no server needed).
    - Step 1: Enter an email or username, press Continue. The deterministic 6‑digit code is generated from your input and logged in the console.
    - Step 2: Enter or paste the 6-digit code from the console to verify. Use "Resend Code" to log the same code again.
    - Step 3: Enter a new password meeting the rules and confirm it. On success, a confirmation screen appears, and the console logs a success message with the user identifier.
    - Observe mocked outputs in DevTools console.
  -->
  <style>
    /* === Accessibility & Layout CSS (High contrast, readable typography, single-column, visible focus) === */
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #555555;
      --primary: #0b5fff;
      --danger: #b00020;
      --success: #137333;
      --surface: #f5f7fb;
      --border: #d0d7e2;
      --focus: #ff9900;
      --font-size-base: 18px; /* readable typography */
      --radius: 10px;
      --space: 16px;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      font-size: var(--font-size-base);
      line-height: 1.5;
    }
    header, main, footer {
      max-width: 720px;
      margin: 0 auto;
      padding: 16px;
    }
    header {
      padding-top: 24px;
      padding-bottom: 8px;
    }
    h1, h2, h3 {
      line-height: 1.2;
      margin: 0 0 12px;
    }
    p {
      margin: 0 0 12px;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
    }
    .progress {
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 8px;
    }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="tel"] {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: 2px solid var(--border);
      background: #fff;
      color: var(--fg);
      box-sizing: border-box;
    }
    input:focus-visible, button:focus-visible, a:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
    }
    .helper {
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 4px;
    }
    .error {
      color: var(--danger);
      margin-top: 8px;
      font-weight: 600;
    }
    .success {
      color: var(--success);
      margin-top: 8px;
      font-weight: 600;
    }
    .actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 1rem;
      cursor: pointer;
    }
    button.secondary {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    button.linklike {
      background: transparent;
      color: var(--primary);
      border: none;
      padding: 8px 0;
      text-decoration: underline;
    }
    .sr-only {
      position: absolute;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0);
      border: 0;
    }
    .checklist {
      list-style: none;
      padding-left: 0;
      margin: 8px 0 0;
    }
    .checklist li {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
    }
    .check {
      width: 1.1em;
      height: 1.1em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      border: 2px solid var(--border);
      font-weight: 800;
      font-size: 0.85em;
      background: #fff;
      color: transparent;
    }
    .check.pass {
      border-color: var(--success);
      background: #e9f6ee;
      color: var(--success);
    }
    .field-row {
      margin: 12px 0;
    }
    .inline {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .toggle-visibility {
      background: transparent;
      color: var(--primary);
      border: none;
      padding: 6px 8px;
      cursor: pointer;
      text-decoration: underline;
    }
    .masked-contact {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      background: #fff;
      border: 1px dashed var(--border);
      padding: 6px 8px;
      border-radius: 6px;
      display: inline-block;
    }
    .footer-note {
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 8px;
    }
    /* Responsive single-column is default. Ensure adequate spacing. */
    .spacer { height: 8px; }
  </style>
</head>
<body>
  <!-- === Header (Semantic) === -->
  <header role="banner">
    <h1 id="app-title">Reset your password</h1>
    <p class="footer-note">
      This is a fully client-side, mocked recovery demo for evaluation purposes only.
    </p>
  </header>

  <!-- === Main (Flow Steps) === -->
  <main id="app" role="main" aria-labelledby="app-title">
    <div id="progress" class="progress" aria-live="polite">Step 1 of 3</div>

    <!-- Global aria-live for announcements (errors and confirmations) -->
    <div id="live-region" class="sr-only" aria-live="polite"></div>

    <!-- Step 1: Identify account -->
    <section id="step1" class="card" role="region" aria-labelledby="step1-title">
      <!-- Spec mapping: Step 1 form with labels, helper text, accessible submit; validate required and email format; errors via aria-live -->
      <h2 id="step1-title">Find your account</h2>
      <p>Enter your email address or username to receive a verification code.</p>
      <form id="form-step1" novalidate>
        <div class="field-row">
          <label for="identifier">Email or Username</label>
          <input id="identifier" name="identifier" type="text" placeholder="e.g., helena@example.com or helena67"
                 autocomplete="username" required aria-describedby="id-helper id-error">
          <div id="id-helper" class="helper">We will send a 6-digit code to your contact on file. No emails are sent in this demo.</div>
          <div id="id-error" class="error" aria-live="polite"></div>
        </div>
        <div class="actions">
          <button id="btn-step1" type="submit">Continue</button>
        </div>
      </form>
    </section>

    <!-- Step 2: Code verification -->
    <section id="step2" class="card" role="region" aria-labelledby="step2-title" hidden>
      <!-- Spec mapping: Step 2 with progress indicator, masked contact, code input accepting typing or paste, errors via aria-live -->
      <h2 id="step2-title">Enter verification code</h2>
      <p>We sent a 6-digit code to:</p>
      <p class="masked-contact" id="contact-mask">••••</p>
      <div class="spacer"></div>
      <form id="form-step2" novalidate>
        <div class="field-row">
          <label for="code">6-digit code</label>
          <input id="code" name="code" inputmode="numeric" autocomplete="one-time-code"
                 placeholder="123456" pattern="\\d{6}" maxlength="6" aria-describedby="code-helper code-error">
          <div id="code-helper" class="helper">Type or paste the 6 digits. Only numbers are accepted.</div>
          <div id="code-error" class="error" aria-live="polite"></div>
        </div>
        <div class="actions">
          <button id="btn-verify" type="submit">Verify Code</button>
          <button id="btn-resend" type="button" class="secondary">Resend Code</button>
        </div>
        <div id="resend-msg" class="success" aria-live="polite" aria-atomic="true"></div>
      </form>
    </section>

    <!-- Step 3: Set new password -->
    <section id="step3" class="card" role="region" aria-labelledby="step3-title" hidden>
      <!-- Spec mapping: Step 3 with password + confirm, show/hide toggle, strength guidance, live checklist, require confirm match -->
      <h2 id="step3-title">Create a new password</h2>
      <p>Choose a strong password that you haven't used with this account before.</p>
      <form id="form-step3" novalidate>
        <div class="field-row">
          <label for="new-password">New password</label>
          <div class="inline" style="width:100%">
            <input id="new-password" name="new-password" type="password" autocomplete="new-password"
                   aria-describedby="pw-helper pw-req pw-error" required>
            <button type="button" id="toggle-pw" class="toggle-visibility" aria-controls="new-password">Show</button>
          </div>
          <div id="pw-helper" class="helper">Your password must meet all of the following:</div>
          <ul id="pw-req" class="checklist" aria-live="polite" aria-atomic="false">
            <li><span id="rule-length" class="check" aria-hidden="true">✓</span><span>At least 12 characters</span></li>
            <li><span id="rule-upper" class="check" aria-hidden="true">✓</span><span>Contains an uppercase letter (A–Z)</span></li>
            <li><span id="rule-lower" class="check" aria-hidden="true">✓</span><span>Contains a lowercase letter (a–z)</span></li>
            <li><span id="rule-number" class="check" aria-hidden="true">✓</span><span>Contains a number (0–9)</span></li>
            <li><span id="rule-symbol" class="check" aria-hidden="true">✓</span><span>Contains a symbol (!@#$…)</span></li>
          </ul>
          <div id="pw-error" class="error" aria-live="polite"></div>
        </div>

        <div class="field-row">
          <label for="confirm-password">Confirm new password</label>
          <div class="inline" style="width:100%">
            <input id="confirm-password" name="confirm-password" type="password" autocomplete="new-password"
                   aria-describedby="confirm-error" required>
            <button type="button" id="toggle-confirm" class="toggle-visibility" aria-controls="confirm-password">Show</button>
          </div>
          <div id="confirm-error" class="error" aria-live="polite"></div>
        </div>

        <div class="actions">
          <button id="btn-reset" type="submit" disabled>Reset password</button>
        </div>
      </form>
    </section>

    <!-- Done: Confirmation -->
    <section id="done" class="card" role="region" aria-labelledby="done-title" hidden>
      <!-- Spec mapping: Confirmation with next steps; console success logged -->
      <h2 id="done-title">Password updated</h2>
      <p>Your password has been reset successfully.</p>
      <ul>
        <li>You can now sign in with your new password.</li>
        <li>After signing in, please review and accept the updated privacy conditions so hospital staff can assist with booking your appointment.</li>
      </ul>
      <p class="footer-note">Tip: For memory support, consider using a password manager. Avoid writing passwords where others might see them.</p>
      <div class="actions">
        <button type="button" id="btn-restart" class="secondary">Start over</button>
      </div>
    </section>
  </main>

  <!-- === Footer (Semantic) === -->
  <footer role="contentinfo">
    <p class="footer-note">
      Mocked client-side demo. No data is transmitted. Console shows simulated delivery and verification.
    </p>
  </footer>

  <script>
    // === JS: Single-file client-only app state and handlers ===
    // Spec mapping (Mocking): Deterministic code generation and console.log simulate delivery/verification.
    // Spec mapping (In-page state): URL hash reflects step; state restored from sessionStorage on reload.
    (function () {
      'use strict';

      // App state model kept in-memory and mirrored to sessionStorage
      const defaultState = { step: 1, identifier: '', contactMask: '', code: '' };
      let appState = loadState() || { ...defaultState };

      // Element refs
      const sections = {
        step1: document.getElementById('step1'),
        step2: document.getElementById('step2'),
        step3: document.getElementById('step3'),
        done: document.getElementById('done')
      };
      const progressEl = document.getElementById('progress');
      const liveRegion = document.getElementById('live-region');
      // Step 1
      const form1 = document.getElementById('form-step1');
      const idInput = document.getElementById('identifier');
      const idError = document.getElementById('id-error');
      const btn1 = document.getElementById('btn-step1');
      // Step 2
      const form2 = document.getElementById('form-step2');
      const codeInput = document.getElementById('code');
      const codeError = document.getElementById('code-error');
      const contactMaskEl = document.getElementById('contact-mask');
      const btnVerify = document.getElementById('btn-verify');
      const btnResend = document.getElementById('btn-resend');
      const resendMsg = document.getElementById('resend-msg');
      // Step 3
      const form3 = document.getElementById('form-step3');
      const newPw = document.getElementById('new-password');
      const confirmPw = document.getElementById('confirm-password');
      const togglePw = document.getElementById('toggle-pw');
      const toggleConfirm = document.getElementById('toggle-confirm');
      const pwError = document.getElementById('pw-error');
      const confirmError = document.getElementById('confirm-error');
      const btnReset = document.getElementById('btn-reset');
      const ruleEls = {
        length: document.getElementById('rule-length'),
        upper: document.getElementById('rule-upper'),
        lower: document.getElementById('rule-lower'),
        number: document.getElementById('rule-number'),
        symbol: document.getElementById('rule-symbol')
      };
      // Done
      const btnRestart = document.getElementById('btn-restart');

      // Initialize: restore from hash + session state
      initFromHashOrDefault();

      // === Event wiring ===
      form1.addEventListener('submit', onSubmitStep1);
      form2.addEventListener('submit', onSubmitStep2);
      btnResend.addEventListener('click', onResend);
      codeInput.addEventListener('input', onCodeInput);
      codeInput.addEventListener('paste', onCodePaste);
      form3.addEventListener('submit', onSubmitStep3);
      newPw.addEventListener('input', onPasswordInput);
      confirmPw.addEventListener('input', onConfirmInput);
      togglePw.addEventListener('click', () => toggleVisibility(newPw, togglePw));
      toggleConfirm.addEventListener('click', () => toggleVisibility(confirmPw, toggleConfirm));
      btnRestart.addEventListener('click', () => {
        appState = { ...defaultState };
        saveState();
        setStep(1);
      });
      window.addEventListener('hashchange', onHashChange);

      // === Functions (Spec mapping: Mocking, Validation, Navigation, Accessibility) ===

      // Hash and state bootstrap
      function initFromHashOrDefault() {
        const targetStep = parseStepFromHash();
        const stored = loadState();
        if (stored) appState = stored;
        if (Number.isInteger(targetStep) && targetStep >= 1 && targetStep <= 4) {
          // Ensure prerequisites exist for deeper steps
          if (targetStep === 1) setStep(1);
          else if (targetStep === 2 && appState.identifier) setStep(2);
          else if (targetStep === 3 && appState.identifier) setStep(3);
          else if (targetStep === 4 && appState.identifier) setStep(4);
          else setStep(1);
        } else {
          setStep(appState.step || 1);
        }
      }

      function onHashChange() {
        const targetStep = parseStepFromHash();
        if (!Number.isInteger(targetStep)) return;
        // Only allow forward navigation if we have required state
        if (targetStep === 1) setStep(1);
        if (targetStep === 2 && appState.identifier) setStep(2);
        if (targetStep === 3 && appState.identifier) setStep(3);
        if (targetStep === 4 && appState.identifier) setStep(4);
      }

      function parseStepFromHash() {
        const h = location.hash.replace('#', '');
        switch (h) {
          case 'step1': return 1;
          case 'step2': return 2;
          case 'step3': return 3;
          case 'done': return 4;
          default: return null;
        }
      }

      function updateHash() {
        const map = { 1: 'step1', 2: 'step2', 3: 'step3', 4: 'done' };
        const hash = '#' + map[appState.step];
        if (location.hash !== hash) {
          history.replaceState(null, '', hash);
        }
      }

      function setStep(stepNumber) {
        appState.step = stepNumber;
        saveState();
        updateHash();
        // Toggle sections
        sections.step1.hidden = stepNumber !== 1;
        sections.step2.hidden = stepNumber !== 2;
        sections.step3.hidden = stepNumber !== 3;
        sections.done.hidden = stepNumber !== 4;
        // Update progress text
        if (stepNumber >= 1 && stepNumber <= 3) {
          progressEl.textContent = `Step ${stepNumber} of 3`;
          progressEl.hidden = false;
        } else {
          progressEl.hidden = true;
        }
        // On step entry, manage content and focus
        switch (stepNumber) {
          case 1:
            announce('');
            idError.textContent = '';
            focusHeadingOrField('step1-title', idInput);
            break;
          case 2:
            // Populate masked contact
            appState.contactMask = appState.contactMask || maskContact(appState.identifier);
            contactMaskEl.textContent = appState.contactMask;
            codeInput.value = '';
            codeError.textContent = '';
            resendMsg.textContent = '';
            // On step change, "send" mock code deterministically
            appState.code = generateCode(appState.identifier);
            saveState();
            mockDeliverCode(appState.identifier, appState.code, appState.contactMask);
            // Focus
            focusHeadingOrField('step2-title', codeInput);
            break;
          case 3:
            newPw.value = '';
            confirmPw.value = '';
            pwError.textContent = '';
            confirmError.textContent = '';
            btnReset.disabled = true;
            updateChecklist('');
            focusHeadingOrField('step3-title', newPw);
            break;
          case 4:
            focusHeadingOrField('done-title', null);
            break;
        }
      }

      // Step 1: Submit
      function onSubmitStep1(e) {
        e.preventDefault();
        idError.textContent = '';
        const raw = (idInput.value || '').trim();
        const err = validateIdentifier(raw);
        if (err) {
          idError.textContent = err;
          announce(err);
          idInput.focus();
          return;
        }
        appState.identifier = raw;
        appState.contactMask = maskContact(raw);
        appState.code = generateCode(raw);
        saveState();
        // Mock: "send" recovery code
        mockDeliverCode(appState.identifier, appState.code, appState.contactMask);
        setStep(2);
      }

      // Step 2: Input and submit
      function onCodeInput(e) {
        // Filter to digits only
        const digits = (e.target.value || '').replace(/\D+/g, '').slice(0, 6);
        if (digits !== e.target.value) e.target.value = digits;
        codeError.textContent = '';
      }
      function onCodePaste(e) {
        const text = (e.clipboardData || window.clipboardData).getData('text') || '';
        const digits = text.replace(/\D+/g, '').slice(0, 6);
        if (digits) {
          e.preventDefault();
          codeInput.value = digits;
        }
      }
      function onSubmitStep2(e) {
        e.preventDefault();
        codeError.textContent = '';
        const val = (codeInput.value || '').trim();
        if (!/^\d{6}$/.test(val)) {
          const msg = 'Enter the 6-digit code.';
          codeError.textContent = msg;
          announce(msg);
          codeInput.focus();
          return;
        }
        const expected = appState.code || generateCode(appState.identifier);
        if (val !== expected) {
          const msg = 'That code is not correct. Try again, or resend the code.';
          codeError.textContent = msg;
          announce(msg);
          codeInput.focus();
          return;
        }
        setStep(3);
      }
      function onResend() {
        resendMsg.textContent = 'Code resent. Please check the console output.';
        announce('A new code has been resent.');
        const code = appState.code || generateCode(appState.identifier);
        mockDeliverCode(appState.identifier, code, appState.contactMask, /*resend*/true);
      }

      // Step 3: Password rules
      function onPasswordInput() {
        const pwd = newPw.value || '';
        updateChecklist(pwd);
        pwError.textContent = '';
        // Enable submit only when all rules pass and confirm matches
        btnReset.disabled = !(allRulesPass(pwd) && passwordsMatch());
      }
      function onConfirmInput() {
        confirmError.textContent = '';
        btnReset.disabled = !(allRulesPass(newPw.value || '') && passwordsMatch());
      }
      function passwordsMatch() {
        return (newPw.value || '') === (confirmPw.value || '');
      }
      function allRulesPass(pwd) {
        return pwd.length >= 12 &&
               /[A-Z]/.test(pwd) &&
               /[a-z]/.test(pwd) &&
               /\d/.test(pwd) &&
               /[^A-Za-z0-9]/.test(pwd);
      }
      function updateChecklist(pwd) {
        const rules = {
          length: (pwd.length >= 12),
          upper: (/[A-Z]/.test(pwd)),
          lower: (/[a-z]/.test(pwd)),
          number: (/\d/.test(pwd)),
          symbol: (/[^A-Za-z0-9]/.test(pwd))
        };
        Object.keys(rules).forEach(key => {
          ruleEls[key].classList.toggle('pass', !!rules[key]);
          ruleEls[key].setAttribute('aria-label', rules[key] ? 'Pass' : 'Fail');
        });
        // Show live feedback if user typed but rules not met
        if (pwd && !allRulesPass(pwd)) {
          pwError.textContent = 'Password does not meet all requirements.';
        } else {
          pwError.textContent = '';
        }
        // Confirm mismatch feedback
        if (confirmPw.value && !passwordsMatch()) {
          confirmError.textContent = 'Passwords do not match.';
        } else {
          confirmError.textContent = '';
        }
      }

      // Step 3: Submit
      function onSubmitStep3(e) {
        e.preventDefault();
        const pwd = newPw.value || '';
        const confirm = confirmPw.value || '';
        let localError = '';
        if (!allRulesPass(pwd)) {
          localError = 'Password does not meet all requirements.';
          pwError.textContent = localError;
          announce(localError);
          newPw.focus();
          return;
        }
        if (pwd !== confirm) {
          localError = 'Passwords do not match.';
          confirmError.textContent = localError;
          announce(localError);
          confirmPw.focus();
          return;
        }
        // Mock success
        console.log(`Mock: Password reset SUCCESS for identifier '${appState.identifier}'.`);
        setStep(4);
      }

      // Utilities
      function validateIdentifier(input) {
        if (!input) return 'Please enter your email or username.';
        if (input.includes('@')) {
          // Simple email format check
          const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input);
          if (!emailOk) return 'Please enter a valid email address.';
        } else {
          // Username: at least 3 characters
          if (input.length < 3) return 'Please enter a valid username (3 or more characters).';
        }
        return '';
      }

      function maskContact(identifier) {
        if (identifier.includes('@')) {
          const [local, domain] = identifier.split('@');
          const maskedLocal = maskMiddle(local);
          const domainParts = domain.split('.');
          const domainName = domainParts[0] || '';
          const domainTld = domainParts.slice(1).join('.') || '';
          const maskedDomain = maskMiddle(domainName);
          return `${maskedLocal}@${maskedDomain}${domainTld ? '.' + domainTld : ''}`;
        } else {
          return maskMiddle(identifier);
        }
      }

      function maskMiddle(str) {
        if (str.length <= 2) return str[0] + '•'.repeat(Math.max(0, str.length - 1));
        const first = str[0];
        const last = str[str.length - 1];
        return `${first}${'•'.repeat(Math.max(1, str.length - 2))}${last}`;
      }

      // Deterministic 6-digit code generator (Spec mapping: Mocking)
      function generateCode(identifier) {
        let hash = 0;
        const prime = 1315423911;
        for (let i = 0; i < identifier.length; i++) {
          hash ^= ((hash << 5) + identifier.charCodeAt(i) + (hash >> 2));
        }
        hash ^= prime;
        const code = Math.abs(hash) % 1000000;
        return String(code).padStart(6, '0');
      }

      // Mock delivery via console.log
      function mockDeliverCode(identifier, code, mask, isResend = false) {
        const action = isResend ? 'RESEND' : 'SEND';
        console.log(`Mock ${action}: Recovery code for '${identifier}' is ${code} (to ${mask})`);
        announce(isResend ? 'A new code has been resent.' : 'A verification code has been sent.');
      }

      // Accessibility: Live region announcer
      function announce(message) {
        if (!message) {
          liveRegion.textContent = '';
          return;
        }
        liveRegion.textContent = message;
      }

      // Toggle show/hide password
      function toggleVisibility(inputEl, toggleBtn) {
        const isPassword = inputEl.type === 'password';
        inputEl.type = isPassword ? 'text' : 'password';
        toggleBtn.textContent = isPassword ? 'Hide' : 'Show';
      }

      // Focus management on step change
      function focusHeadingOrField(headingId, fieldEl) {
        const heading = document.getElementById(headingId);
        if (heading) {
          heading.setAttribute('tabindex', '-1');
          heading.focus();
          // Cleanup tabindex after focus
          setTimeout(() => heading.removeAttribute('tabindex'), 0);
        }
        if (fieldEl) {
          setTimeout(() => fieldEl.focus(), 50);
        }
      }

      // State persistence
      function saveState() {
        try {
          sessionStorage.setItem('recoveryState', JSON.stringify(appState));
        } catch (_) {}
      }
      function loadState() {
        try {
          const raw = sessionStorage.getItem('recoveryState');
          return raw ? JSON.parse(raw) : null;
        } catch (_) {
          return null;
        }
      }

      // Keyboard: Enter to submit is default via forms; tab order follows DOM.
    })();
  </script>
</body>
</html>
