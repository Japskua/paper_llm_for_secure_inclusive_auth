{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Requirements (Single-Page, Client-Only, Mocked)\n\n  Purpose:\n    - Provide a fully client-side password recovery flow in one HTML file for academic AI evaluation.\n    - All \"delivery\" and verification are simulated in-browser via console.log and deterministic mock values.\n\n  Use-case (Helena):\n    - Helena (67) needs to reset a forgotten strong password to access her healthcare account and accept updated privacy conditions.\n    - This single-page app walks her through requesting a recovery code, verifying it, and setting a new password.\n\n  Deliverables:\n    - One file: index.html\n    - Semantic HTML, inline CSS & JS\n    - Comments mapping code to this spec\n    - No build step, no network requests, no external servers\n\n  Flow steps implemented below:\n    1) Recovery Request: identifier input (email/username), validation, deterministic mock code generation, simulate delivery via console.log.\n    2) Code Verification: enter code, compare to deterministic value, show success/error, manage keyboard focus, aria-live updates.\n    3) Set New Password: validate strength (length + character variety) and confirm match.\n    4) Success: show clear success message, simulate confirmation via console.log.\n    - A Restart action resets in-memory state and returns to step 1.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery — Client-only Demo</title>\n  <style>\n    /* Inline CSS — Clear, readable layout (per Deliverables) */\n    :root {\n      --bg: #f7f7fb;\n      --panel: #ffffff;\n      --text: #1a1a1a;\n      --muted: #555;\n      --primary: #2457f5;\n      --primary-contrast: #fff;\n      --border: #e1e1ea;\n      --error: #b00020;\n      --success: #0b7a0b;\n      --focus: #5a9;\n    }\n    * { box-sizing: border-box; }\n    html, body { height: 100%; }\n    body {\n      margin: 0;\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n      background: var(--bg);\n      color: var(--text);\n      line-height: 1.5;\n    }\n    header {\n      background: #0f172a;\n      color: #e2e8f0;\n      padding: 1rem;\n      border-bottom: 4px solid #1e293b;\n    }\n    header h1 {\n      margin: 0;\n      font-size: 1.25rem;\n    }\n    main {\n      max-width: 720px;\n      margin: 2rem auto;\n      padding: 0 1rem;\n    }\n    .panel {\n      background: var(--panel);\n      border: 1px solid var(--border);\n      border-radius: 12px;\n      padding: 1.25rem;\n      box-shadow: 0 1px 2px rgba(0,0,0,0.04);\n    }\n    h2 {\n      margin-top: 0;\n      font-size: 1.25rem;\n    }\n    p.help {\n      color: var(--muted);\n      margin-top: 0.25rem;\n    }\n    form {\n      margin-top: 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.25rem;\n    }\n    input[type=\"text\"],\n    input[type=\"email\"],\n    input[type=\"password\"],\n    input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.65rem 0.75rem;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n      color: var(--text);\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n      outline-color: var(--error);\n    }\n    .row {\n      margin-bottom: 1rem;\n    }\n    .actions {\n      display: flex;\n      gap: 0.5rem;\n      flex-wrap: wrap;\n      align-items: center;\n      margin-top: 0.5rem;\n    }\n    button {\n      padding: 0.6rem 1rem;\n      border: none;\n      border-radius: 999px;\n      background: var(--primary);\n      color: var(--primary-contrast);\n      font-weight: 600;\n      cursor: pointer;\n    }\n    button.secondary {\n      background: transparent;\n      color: var(--primary);\n      border: 1px solid var(--primary);\n    }\n    button.link {\n      background: transparent;\n      color: var(--primary);\n      border: none;\n      padding: 0.25rem 0.25rem;\n    }\n    button:focus-visible, a:focus-visible, input:focus-visible {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    .status {\n      margin-top: 0.5rem;\n      min-height: 1.25rem;\n      font-size: 0.95rem;\n    }\n    .status.error { color: var(--error); }\n    .status.success { color: var(--success); }\n    .requirements {\n      margin: 0.25rem 0 0.75rem 0;\n      font-size: 0.95rem;\n      color: var(--muted);\n    }\n    .footer-note {\n      margin-top: 1rem;\n      font-size: 0.9rem;\n      color: var(--muted);\n    }\n    .center {\n      text-align: center;\n    }\n    .big-check {\n      font-size: 3rem;\n      line-height: 1;\n      margin: 0.25rem 0 0.5rem;\n      color: var(--success);\n    }\n    [hidden] { display: none !important; }\n  </style>\n</head>\n<body>\n  <!-- Header with clear title -->\n  <header>\n    <h1>Password Recovery — Client-only Mock</h1>\n  </header>\n\n  <main id=\"app\" role=\"main\">\n    <!-- Section: Step 1 — Recovery Request (per Flow step 1) -->\n    <section id=\"step-request\" class=\"panel\" aria-labelledby=\"request-title\">\n      <h2 id=\"request-title\" tabindex=\"-1\">Recover your account</h2>\n      <p class=\"help\" id=\"request-help\">\n        Enter your email or username to receive a 6‑digit recovery code. This demo runs entirely in your browser; no real emails/SMS are sent.\n      </p>\n\n      <form id=\"form-request\" novalidate>\n        <div class=\"row\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" inputmode=\"email\"\n                 autocomplete=\"username\" required\n                 aria-describedby=\"request-help request-status\"\n                 aria-invalid=\"false\" />\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-request\">Send recovery code</button>\n          <button type=\"button\" class=\"secondary\" id=\"btn-reset-app\" aria-describedby=\"restart-hint\">Restart</button>\n          <span id=\"restart-hint\" class=\"help\">Clears state and returns to this step.</span>\n        </div>\n        <div id=\"request-status\" class=\"status\" aria-live=\"polite\" role=\"status\"></div>\n      </form>\n    </section>\n\n    <!-- Section: Step 2 — Code Verification (per Flow step 2) -->\n    <section id=\"step-verify\" class=\"panel\" aria-labelledby=\"verify-title\" hidden>\n      <h2 id=\"verify-title\" tabindex=\"-1\">Enter your recovery code</h2>\n      <p class=\"help\" id=\"verify-help\">\n        A 6‑digit code was \"sent\" to your registered contact method (simulation). Check your console to see the mocked code delivery.\n      </p>\n\n      <form id=\"form-verify\" novalidate>\n        <div class=\"row\">\n          <label for=\"code\">6‑digit code</label>\n          <input id=\"code\" name=\"code\" type=\"tel\" inputmode=\"numeric\" pattern=\"[0-9]{6}\" maxlength=\"6\"\n                 autocomplete=\"one-time-code\"\n                 aria-describedby=\"verify-help verify-status\"\n                 aria-invalid=\"false\" required />\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-verify\">Verify code</button>\n          <button type=\"button\" class=\"secondary\" id=\"btn-resend\">Resend code (mock)</button>\n          <button type=\"button\" class=\"link\" id=\"btn-change-id\">Use different identifier</button>\n        </div>\n        <div id=\"verify-status\" class=\"status\" aria-live=\"polite\" role=\"status\"></div>\n      </form>\n    </section>\n\n    <!-- Section: Step 3 — New Password (per Flow step 3) -->\n    <section id=\"step-reset\" class=\"panel\" aria-labelledby=\"reset-title\" hidden>\n      <h2 id=\"reset-title\" tabindex=\"-1\">Set a new password</h2>\n      <p class=\"help\">Choose a strong password. You'll use this to access your healthcare account.</p>\n\n      <form id=\"form-reset\" novalidate>\n        <div class=\"row\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\"\n                 autocomplete=\"new-password\" required\n                 aria-describedby=\"pw-req reset-status\"\n                 aria-invalid=\"false\" />\n          <div id=\"pw-req\" class=\"requirements\">\n            Must be at least 10 characters and include at least one uppercase, one lowercase, one number, and one symbol.\n          </div>\n        </div>\n        <div class=\"row\">\n          <label for=\"confirm\">Confirm new password</label>\n          <input id=\"confirm\" name=\"confirm\" type=\"password\"\n                 autocomplete=\"new-password\" required\n                 aria-describedby=\"reset-status\"\n                 aria-invalid=\"false\" />\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-set\">Save new password</button>\n          <button type=\"button\" class=\"link\" id=\"btn-back-verify\">Back to code</button>\n        </div>\n        <div id=\"reset-status\" class=\"status\" aria-live=\"polite\" role=\"status\"></div>\n      </form>\n    </section>\n\n    <!-- Section: Step 4 — Success (per Flow step 4) -->\n    <section id=\"step-done\" class=\"panel center\" aria-labelledby=\"done-title\" hidden>\n      <div class=\"big-check\" aria-hidden=\"true\">✓</div>\n      <h2 id=\"done-title\" tabindex=\"-1\">Password reset complete</h2>\n      <p class=\"help\">Your password has been updated. You can now log in and accept the updated privacy statement.</p>\n      <div class=\"actions\" style=\"justify-content:center\">\n        <button type=\"button\" id=\"btn-restart\" class=\"secondary\">Start over</button>\n      </div>\n      <p class=\"footer-note\">\n        This is a client-only mock. No information left your browser.\n      </p>\n    </section>\n\n    <p class=\"footer-note center\">\n      Note: All actions are simulated locally. Open your browser console to see mock delivery and confirmation logs.\n    </p>\n  </main>\n\n  <script>\n    /*\n      Inline JS — All logic runs entirely in-browser (per Deliverables)\n\n      Deterministic mock values (per Requirements):\n        - We generate a 6-digit recovery code from the user-provided identifier using the FNV-1a 32-bit hash.\n        - Steps:\n            1) Normalize identifier (trim, lowercase).\n            2) Compute FNV-1a hash → unsigned 32-bit integer.\n            3) code = (hash % 1_000_000), zero-padded to 6 digits.\n        - This guarantees the same identifier always yields the same code within a session (deterministic and mockable).\n\n      Simulated delivery/verification:\n        - \"Sending\" the code is implemented as console.log with a structured message.\n        - Verification compares the entered code against the deterministic mock value in memory.\n        - On success, we log a mock confirmation via console.log.\n\n      Accessibility and SPA behavior:\n        - Sections are shown/hidden without reloading; focus is moved to the next step's heading or primary input.\n        - Status messages use aria-live regions for screen readers.\n    */\n\n    // -------------- Utilities (mapping to Flow and Accessibility) --------------\n    const qs = sel => document.querySelector(sel);\n    const stepEls = {\n      request: qs('#step-request'),\n      verify: qs('#step-verify'),\n      reset: qs('#step-reset'),\n      done: qs('#step-done')\n    };\n\n    function showStep(name) {\n      for (const key in stepEls) {\n        stepEls[key].hidden = key !== name;\n      }\n      // Manage focus for keyboard and assistive tech:\n      const step = stepEls[name];\n      // Prefer focusing the section's heading; fallback to the first focusable input/button\n      const heading = step.querySelector('h2');\n      if (heading) {\n        heading.focus();\n      } else {\n        const focusable = step.querySelector('input, button, [tabindex]:not([tabindex=\"-1\"])');\n        if (focusable) focusable.focus();\n      }\n    }\n\n    // Basic string helpers\n    const norm = (s) => (s || '').trim().toLowerCase();\n\n    // Basic validation helpers\n    function isValidEmail(v) {\n      // Simple email pattern (not exhaustive, acceptable for client-side hinting)\n      const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$/;\n      return re.test(v);\n    }\n    function isValidUsername(v) {\n      // Letters, numbers, underscore/hyphen, 3-32 chars\n      const re = /^[a-zA-Z0-9_-]{3,32}$/;\n      return re.test(v);\n    }\n\n    // FNV-1a hash (32-bit, unsigned)\n    function fnv1a(str) {\n      let hash = 0x811c9dc5; // 2166136261\n      for (let i = 0; i < str.length; i++) {\n        hash ^= str.charCodeAt(i);\n        hash = (hash >>> 0) * 0x01000193; // 16777619\n        hash >>>= 0;\n      }\n      return hash >>> 0;\n    }\n\n    // Deterministic 6-digit code from identifier (documented above)\n    function codeFromIdentifier(identifier) {\n      const id = norm(identifier);\n      const hash = fnv1a(id);\n      const six = (hash % 1000000) >>> 0;\n      return six.toString().padStart(6, '0');\n    }\n\n    // Password strength check — length and character variety\n    function validatePassword(pw) {\n      const issues = [];\n      if (!pw || pw.length < 10) issues.push('At least 10 characters.');\n      if (!/[a-z]/.test(pw)) issues.push('At least one lowercase letter.');\n      if (!/[A-Z]/.test(pw)) issues.push('At least one uppercase letter.');\n      if (!/[0-9]/.test(pw)) issues.push('At least one number.');\n      if (!/[^A-Za-z0-9]/.test(pw)) issues.push('At least one symbol.');\n      return { ok: issues.length === 0, issues };\n    }\n\n    // -------------- In-memory State (per Requirements) --------------\n    const state = {\n      identifier: null,\n      code: null,\n      verified: false\n    };\n\n    // -------------- DOM bindings --------------\n    const els = {\n      // Step 1\n      formRequest: qs('#form-request'),\n      inputIdentifier: qs('#identifier'),\n      statusRequest: qs('#request-status'),\n      btnResetApp: qs('#btn-reset-app'),\n      // Step 2\n      formVerify: qs('#form-verify'),\n      inputCode: qs('#code'),\n      statusVerify: qs('#verify-status'),\n      btnResend: qs('#btn-resend'),\n      btnChangeId: qs('#btn-change-id'),\n      // Step 3\n      formReset: qs('#form-reset'),\n      inputPw: qs('#password'),\n      inputConfirm: qs('#confirm'),\n      statusReset: qs('#reset-status'),\n      btnBackVerify: qs('#btn-back-verify'),\n      // Step 4\n      btnRestart: qs('#btn-restart')\n    };\n\n    // -------------- Step Handlers --------------\n\n    // Step 1: Request\n    els.formRequest.addEventListener('submit', (e) => {\n      e.preventDefault();\n      clearStatus(els.statusRequest);\n      const raw = els.inputIdentifier.value || '';\n      const trimmed = raw.trim();\n      const emailLike = isValidEmail(trimmed);\n      const userLike = isValidUsername(trimmed);\n\n      if (!trimmed) {\n        invalidate(els.inputIdentifier, els.statusRequest, 'Please enter an email or username.');\n        return;\n      }\n      if (!emailLike && !userLike) {\n        invalidate(els.inputIdentifier, els.statusRequest, 'Enter a valid email (user@example.com) or username (3–32 letters/numbers).');\n        return;\n      }\n\n      // Valid identifier — store state and generate deterministic code\n      const idNorm = trimmed;\n      const code = codeFromIdentifier(idNorm);\n      state.identifier = idNorm;\n      state.code = code;\n      state.verified = false;\n\n      // Simulate delivery — console.log (per Requirements)\n      console.log('[Mock Delivery] Recovery code for identifier \"%s\" is: %s', state.identifier, state.code);\n\n      // UX feedback\n      setStatus(els.statusRequest, 'success', 'Recovery code generated and sent (mock). Check the console for details.');\n      // Progress to verification after a short tick for SR to announce status\n      setTimeout(() => {\n        // Clear code input and status\n        els.inputCode.value = '';\n        clearInvalid(els.inputCode);\n        clearStatus(els.statusVerify);\n        showStep('verify');\n        els.inputCode.focus();\n      }, 150);\n    });\n\n    els.btnResetApp.addEventListener('click', () => restart());\n\n    // Step 2: Verify\n    els.formVerify.addEventListener('submit', (e) => {\n      e.preventDefault();\n      clearStatus(els.statusVerify);\n\n      if (!state.identifier || !state.code) {\n        setStatus(els.statusVerify, 'error', 'Session expired or not initialized. Please start over.');\n        return;\n      }\n\n      const entered = (els.inputCode.value || '').trim();\n      if (!/^\\d{6}$/.test(entered)) {\n        invalidate(els.inputCode, els.statusVerify, 'Enter the 6‑digit code.');\n        return;\n      }\n      if (entered !== state.code) {\n        invalidate(els.inputCode, els.statusVerify, 'That code is not correct. Please try again.');\n        return;\n      }\n\n      // Verified!\n      state.verified = true;\n      console.log('[Mock Verification] Code verified for \"%s\". Proceed to password reset.', state.identifier);\n\n      setStatus(els.statusVerify, 'success', 'Code verified. You may now set a new password.');\n      setTimeout(() => {\n        els.inputPw.value = '';\n        els.inputConfirm.value = '';\n        clearInvalid(els.inputPw);\n        clearInvalid(els.inputConfirm);\n        clearStatus(els.statusReset);\n        showStep('reset');\n        els.inputPw.focus();\n      }, 150);\n    });\n\n    els.btnResend.addEventListener('click', () => {\n      if (!state.identifier) {\n        setStatus(els.statusVerify, 'error', 'No identifier set. Please start over.');\n        return;\n      }\n      // Reuse deterministic code; simulate re-delivery\n      console.log('[Mock Delivery] Resent recovery code for \"%s\": %s', state.identifier, state.code);\n      setStatus(els.statusVerify, 'success', 'Code resent (mock). Check the console.');\n      els.inputCode.focus();\n    });\n\n    els.btnChangeId.addEventListener('click', () => {\n      showStep('request');\n      els.inputIdentifier.focus();\n    });\n\n    // Step 3: Reset password\n    els.formReset.addEventListener('submit', (e) => {\n      e.preventDefault();\n      clearStatus(els.statusReset);\n\n      if (!state.verified) {\n        setStatus(els.statusReset, 'error', 'You must verify a code before setting a new password.');\n        return;\n      }\n\n      const pw = els.inputPw.value || '';\n      const cf = els.inputConfirm.value || '';\n      const check = validatePassword(pw);\n\n      if (!check.ok) {\n        invalidate(els.inputPw, els.statusReset, 'Please strengthen your password: ' + check.issues.join(' '));\n        return;\n      }\n      if (pw !== cf) {\n        invalidate(els.inputConfirm, els.statusReset, 'Passwords do not match.');\n        return;\n      }\n\n      // Success — simulate saving via console.log\n      console.log('[Mock Confirmation] Password reset completed for \"%s\".', state.identifier);\n\n      // Clear sensitive fields and proceed\n      els.inputPw.value = '';\n      els.inputConfirm.value = '';\n      setStatus(els.statusReset, 'success', 'Your password has been updated.');\n      setTimeout(() => {\n        showStep('done');\n      }, 150);\n    });\n\n    els.btnBackVerify.addEventListener('click', () => {\n      showStep('verify');\n      els.inputCode.focus();\n    });\n\n    // Step 4: Restart\n    if (els.btnRestart) {\n      els.btnRestart.addEventListener('click', () => restart());\n    }\n\n    // -------------- Status & Validation helpers --------------\n    function setStatus(el, type, msg) {\n      el.textContent = msg;\n      el.classList.remove('error', 'success');\n      if (type === 'error') el.classList.add('error');\n      if (type === 'success') el.classList.add('success');\n    }\n    function clearStatus(el) {\n      el.textContent = '';\n      el.classList.remove('error', 'success');\n    }\n    function invalidate(input, statusEl, message) {\n      input.setAttribute('aria-invalid', 'true');\n      setStatus(statusEl, 'error', message);\n      input.focus();\n    }\n    function clearInvalid(input) {\n      input.setAttribute('aria-invalid', 'false');\n    }\n\n    // -------------- Restart / Reset state --------------\n    function restart() {\n      // Clear state\n      state.identifier = null;\n      state.code = null;\n      state.verified = false;\n      // Clear forms\n      els.inputIdentifier.value = '';\n      els.inputCode.value = '';\n      els.inputPw.value = '';\n      els.inputConfirm.value = '';\n      // Clear validation and statuses\n      clearInvalid(els.inputIdentifier);\n      clearInvalid(els.inputCode);\n      clearInvalid(els.inputPw);\n      clearInvalid(els.inputConfirm);\n      clearStatus(els.statusRequest);\n      clearStatus(els.statusVerify);\n      clearStatus(els.statusReset);\n      // Go to first step\n      showStep('request');\n      els.inputIdentifier.focus();\n      console.log('[Mock] App restarted; state cleared.');\n    }\n\n    // -------------- Initialize --------------\n    // Show initial step and focus identifier for keyboard users\n    document.addEventListener('DOMContentLoaded', () => {\n      showStep('request');\n      els.inputIdentifier.focus();\n    });\n  </script>\n</body>\n</html>\n", "task_list": ["None."], "evaluator_md": "SUMMARY:\nThe single-file password recovery demo meets the stated Requirements for a client-only, mocked flow. It implements a clear 4-step process (request, verify, reset, success), uses deterministic mock codes, simulates delivery via console.log, and applies accessible UX patterns (focus management, aria-live, clear errors). No external calls or build steps are used, and the file employs semantic HTML with inline CSS/JS and explanatory comments.\n\nFUNCTIONAL_CHECK:\n- AC-1 Single-file deliverable (index.html only): PASS — All HTML, CSS, and JS are inline in a single file.\n- AC-2 No backend/network; client-only logic: PASS — No network requests; all logic is in-browser with console logs.\n- AC-3 Deterministic mock code generation: PASS — 6-digit code derived via FNV-1a hash of normalized identifier, zero-padded.\n- AC-4 Simulated “delivery” of recovery code: PASS — console.log messages show the identifier and code on request and resend.\n- AC-5 Recovery request validation (email or username) with clear errors: PASS — Email and username patterns validated; specific error feedback via aria-live.\n- AC-6 Verification step enforces 6-digit format and correctness: PASS — Pattern and regex ensure 6 digits; mismatches produce clear errors; success advances.\n- AC-7 Resend reuses deterministic code and provides feedback: PASS — Resend logs the same code and updates status.\n- AC-8 Ability to change identifier/restart: PASS — “Use different identifier” returns to step 1; “Restart/Start over” clears state and resets UI.\n- AC-9 Password strength enforcement and confirmation: PASS — Requires ≥10 chars and at least one lower, upper, digit, and symbol; mismatch reported clearly.\n- AC-10 Success confirmation and simulated save: PASS — Console log on completion; dedicated success screen with clear messaging.\n- AC-11 Accessibility: focus management and live regions: PASS — Focus moves to step headings; role=status and aria-live used; aria-invalid toggled; labels present.\n- AC-12 Semantic HTML and clear structure: PASS — Uses header, main, section, h2, p; forms and labels are appropriate.\n- AC-13 Clear disclosures that it’s a mock: PASS — Header, help text, and footer note explicitly state client-only mock and console usage.\n- AC-14 Code comments mapping to spec and flow: PASS — Top-level and sectional comments explain alignment with requirements and flow steps.\n\nFAILING_ITEMS:\n- None observed against the stated Requirements and the enumerated acceptance criteria.\n\nNEW_TASKS:\n- None.\n\nDECISION:\nPASS", "done": true, "iter": 1}
