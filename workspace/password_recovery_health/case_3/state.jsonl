{"code_html": "\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <!--\n    Password Recovery System — Single-Page, Client-Only, Mocked\n    - All logic is client-side; no servers or external calls.\n    - Delivery and verification are simulated via console.log with deterministic mock values.\n    - Inclusive design for users with ADHD and older adults: calm, step-by-step, forgiving.\n    - Comments map to requirement sections where relevant.\n  -->\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>City Hospital Account — Password Recovery (Demo)</title>\n  <style>\n    /* =========================\n       Global, Accessible Styles\n       Maps to: Inclusivity (clarity, low-stress), Semantic HTML, Good UX\n       ========================= */\n    :root{\n      --bg: #f6f8fb;\n      --panel: #ffffff;\n      --text: #1d2433;\n      --muted: #4f5b6c;\n      --primary: #1455d9;\n      --primary-contrast: #ffffff;\n      --accent: #0a9d6c;\n      --danger: #b00020;\n      --warning: #b67200;\n      --ok: #1a7f37;\n      --border: #d9e1ef;\n      --focus: #0b7ad1;\n      --shadow: 0 2px 12px rgba(0,0,0,0.06);\n      --radius: 12px;\n      --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n    }\n\n    * { box-sizing: border-box; }\n    html, body {\n      height: 100%;\n      background: var(--bg);\n      color: var(--text);\n      font-family: var(--font);\n      line-height: 1.55;\n      font-size: 18px; /* Larger base font for readability */\n    }\n    a { color: var(--primary); }\n    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible, summary:focus-visible {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n      border-radius: 6px;\n    }\n\n    .container {\n      max-width: 780px;\n      margin: 0 auto;\n      padding: 24px;\n    }\n\n    header.app-header {\n      margin-bottom: 16px;\n    }\n    .brand {\n      display: flex; align-items: center; gap: 12px;\n    }\n    .logo {\n      width: 44px; height: 44px;\n      border-radius: 8px;\n      background: linear-gradient(135deg, #2a74ff 0%, #29c4a9 100%);\n      display: inline-flex; align-items: center; justify-content: center;\n      color: #fff; font-weight: 800;\n      box-shadow: var(--shadow);\n    }\n    .brand h1 {\n      font-size: 1.35rem; margin: 0;\n    }\n    .subtitle {\n      color: var(--muted); margin-top: 4px; font-size: 0.95rem;\n    }\n\n    main {\n      background: var(--panel);\n      border: 1px solid var(--border);\n      border-radius: var(--radius);\n      box-shadow: var(--shadow);\n      padding: 20px;\n    }\n\n    /* Stepper / Progress */\n    .progress {\n      display: grid;\n      grid-template-columns: repeat(3,1fr);\n      gap: 8px;\n      margin-bottom: 16px;\n    }\n    .step-dot {\n      position: relative;\n      height: 6px; border-radius: 999px;\n      background: #e2e8f6;\n      overflow: hidden;\n    }\n    .step-dot::after {\n      content: \"\";\n      position: absolute; left: 0; top: 0; bottom: 0;\n      width: var(--pct, 0%);\n      background: var(--primary);\n      transition: width .35s ease;\n    }\n    .step-labels {\n      display: flex; justify-content: space-between; gap: 8px;\n      color: var(--muted);\n      font-size: 0.9rem; margin-bottom: 4px;\n    }\n\n    /* Panels for steps */\n    section.step {\n      display: none;\n    }\n    section.step.active {\n      display: block;\n    }\n\n    h2.step-title {\n      margin-top: 0;\n      font-size: 1.35rem;\n    }\n\n    .field {\n      margin: 12px 0;\n    }\n    .field label {\n      display: block; font-weight: 600; margin-bottom: 6px;\n    }\n    .field input, .field select, .field textarea {\n      width: 100%;\n      padding: 12px;\n      border-radius: 10px;\n      border: 1px solid var(--border);\n      background: #fff;\n      font-size: 1rem;\n    }\n    .field .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: 6px;\n    }\n    .inline {\n      display: flex; align-items: center; gap: 10px; flex-wrap: wrap;\n    }\n\n    .actions {\n      display: flex; gap: 12px; flex-wrap: wrap;\n      margin-top: 12px;\n    }\n    .actions .spacer { flex: 1; }\n    button, .btn {\n      border: 0; padding: 12px 16px; border-radius: 10px;\n      font-weight: 700; cursor: pointer;\n      background: var(--primary); color: var(--primary-contrast);\n    }\n    button.secondary, .btn.secondary { background: #eaf1ff; color: #14386e; }\n    button.ghost { background: transparent; color: var(--primary); }\n    button.link { background: transparent; color: var(--primary); padding: 8px 10px; text-decoration: underline; }\n    button[disabled] { opacity: .6; cursor: not-allowed; }\n    .danger { color: var(--danger); }\n    .ok { color: var(--ok); }\n\n    .status {\n      margin: 10px 0; padding: 10px; border-radius: 10px; border: 1px solid var(--border);\n      background: #f9fbff;\n    }\n    .status[role=\"alert\"] { border-color: #ffd0d6; background: #fff5f6; }\n    .status.success { border-color: #ccebd9; background: #f3fcf7; }\n\n    .password-checklist {\n      display: grid; gap: 6px; margin-top: 8px;\n    }\n    .password-checklist .item {\n      display: flex; align-items: center; gap: 8px;\n      color: var(--muted);\n    }\n    .password-checklist .item.pass { color: var(--ok); }\n    .password-checklist .item.fail { color: var(--muted); }\n\n    .pw-row {\n      display: grid;\n      grid-template-columns: 1fr auto;\n      gap: 8px; align-items: center;\n    }\n    .tiny {\n      font-size: 0.9rem; color: var(--muted);\n    }\n    .kbd {\n      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, \"Liberation Mono\", monospace;\n      font-size: 0.95rem;\n      padding: 1px 6px; border-radius: 6px; border: 1px solid var(--border); background: #f4f7ff;\n    }\n\n    details.help {\n      margin-top: 10px; border: 1px dashed var(--border); border-radius: 10px; padding: 8px 12px; background: #fcfdff;\n    }\n    details.help summary { cursor: pointer; font-weight: 700; }\n\n    aside.support {\n      margin-top: 16px; padding: 12px; border: 1px solid var(--border); border-radius: 10px;\n      background: #f7fbff;\n    }\n    .support h3 {\n      margin-top: 0; font-size: 1.05rem;\n    }\n\n    footer {\n      margin: 18px 0 8px; color: var(--muted); font-size: 0.9rem;\n      display: flex; gap: 14px; flex-wrap: wrap;\n    }\n\n    .visually-hidden {\n      position: absolute !important; height: 1px; width: 1px; overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; border: 0; padding: 0; margin: -1px;\n    }\n\n    @media (prefers-reduced-motion: reduce) {\n      * { transition: none !important; animation: none !important; }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <!-- =========================\n         Header\n         Maps to: Inclusivity (orientation and clarity)\n         ========================= -->\n    <header class=\"app-header\" role=\"banner\" aria-label=\"Application header\">\n      <div class=\"brand\">\n        <div class=\"logo\" aria-hidden=\"true\">H</div>\n        <div>\n          <h1>City Hospital Account</h1>\n          <p class=\"subtitle\">Password Recovery — calm, step-by-step (demo)</p>\n        </div>\n      </div>\n    </header>\n\n    <!-- =========================\n         Progress indicator\n         Maps to: Inclusivity (visible progress)\n         ========================= -->\n    <nav aria-label=\"Progress\" class=\"stepper\">\n      <div class=\"step-labels\" id=\"stepLabels\">\n        <span>1. Identify</span>\n        <span>2. Verify</span>\n        <span>3. New password</span>\n      </div>\n      <div class=\"progress\" aria-hidden=\"true\">\n        <div class=\"step-dot\" id=\"prog1\"></div>\n        <div class=\"step-dot\" id=\"prog2\"></div>\n        <div class=\"step-dot\" id=\"prog3\"></div>\n      </div>\n    </nav>\n\n    <!-- =========================\n         Main content: Steps\n         Maps to: Use-case flow + Inclusivity (simple, structured, no time pressure)\n         ========================= -->\n    <main id=\"main\" role=\"main\">\n      <!-- Step 1: Identify account -->\n      <section class=\"step\" id=\"step1\" aria-labelledby=\"step1-title\">\n        <h2 class=\"step-title\" id=\"step1-title\" tabindex=\"-1\">Step 1 — Find your account</h2>\n        <p>Enter your email address or mobile number. We will send a 6‑digit code to verify it’s you.</p>\n\n        <form id=\"form-identify\">\n          <div class=\"field\">\n            <label for=\"identifier\">Email or mobile number</label>\n            <input id=\"identifier\" name=\"identifier\" type=\"text\" inputmode=\"email\"\n                   autocomplete=\"username\"\n                   placeholder=\"e.g., helena@example.com or +1 555 123 9876\" required />\n            <div class=\"hint\">Tip: Use the contact you normally use to log in.</div>\n          </div>\n\n          <div class=\"field\">\n            <label for=\"delivery\">How should we send the code?</label>\n            <select id=\"delivery\" name=\"delivery\" aria-describedby=\"delivery-hint\">\n              <option value=\"auto\" selected>Auto-detect (recommended)</option>\n              <option value=\"email\">Email</option>\n              <option value=\"sms\">Text message (SMS)</option>\n            </select>\n            <div id=\"delivery-hint\" class=\"hint\">We’ll choose based on what you enter, unless you pick one.</div>\n          </div>\n\n          <div class=\"status\" id=\"id-status\" role=\"status\" aria-live=\"polite\"></div>\n\n          <div class=\"actions\">\n            <button type=\"submit\" id=\"btn-send\">Send code</button>\n            <button type=\"button\" class=\"secondary\" id=\"btn-save-exit-1\">Pause and return later</button>\n            <span class=\"spacer\"></span>\n            <button type=\"button\" class=\"ghost\" id=\"btn-reset-all-1\">Start over</button>\n          </div>\n        </form>\n\n        <details class=\"help\">\n          <summary>Need help choosing what to enter?</summary>\n          <ul>\n            - Try the email your hospital uses to contact you. \n            - For phone, include your country code (e.g., +1 for USA).\n            - If you can’t access your email or phone, call support (below).\n          </ul>\n        </details>\n      </section>\n\n      <!-- Step 2: Enter verification code -->\n      <section class=\"step\" id=\"step2\" aria-labelledby=\"step2-title\">\n        <h2 class=\"step-title\" id=\"step2-title\" tabindex=\"-1\">Step 2 — Enter the 6‑digit code</h2>\n        <p id=\"dest-text\">We sent a code to your contact.</p>\n\n        <form id=\"form-code\">\n          <div class=\"field\">\n            <label for=\"code\">Verification code</label>\n            <input id=\"code\" name=\"code\" type=\"text\"\n                   inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\"\n                   placeholder=\"Enter 6 digits\" required />\n            <div class=\"hint\">No rush. You can come back later; your progress is saved.</div>\n          </div>\n\n          <div class=\"inline\">\n            <button type=\"button\" class=\"secondary\" id=\"btn-resend\">Resend code</button>\n            <button type=\"button\" class=\"ghost\" id=\"btn-change-contact\">Change contact</button>\n          </div>\n\n          <div class=\"status\" id=\"code-status\" role=\"status\" aria-live=\"polite\"></div>\n\n          <div class=\"actions\">\n            <button type=\"submit\" id=\"btn-verify\">Verify</button>\n            <button type=\"button\" class=\"secondary\" id=\"btn-save-exit-2\">Pause and return later</button>\n            <span class=\"spacer\"></span>\n            <button type=\"button\" class=\"ghost\" id=\"btn-reset-all-2\">Start over</button>\n          </div>\n        </form>\n\n        <!-- Demo assist: Reveal mock code (kept optional to preserve console-based delivery) -->\n        <details class=\"help\" id=\"reveal-demo\">\n          <summary>Having trouble receiving the code?</summary>\n          <p>This demo simulates delivery. For testing only, you can reveal the code below.</p>\n          <div class=\"inline\">\n            <button type=\"button\" class=\"secondary\" id=\"btn-show-code\">Reveal code (demo)</button>\n            <span class=\"tiny\">We also log it to the console.</span>\n          </div>\n          <div class=\"status\" id=\"demo-code\" role=\"status\" aria-live=\"polite\"></div>\n        </details>\n      </section>\n\n      <!-- Step 3: Set a new password -->\n      <section class=\"step\" id=\"step3\" aria-labelledby=\"step3-title\">\n        <h2 class=\"step-title\" id=\"step3-title\" tabindex=\"-1\">Step 3 — Create your new password</h2>\n        <p>Choose a strong password you can remember. You’ll use it to log in and accept the updated privacy conditions.</p>\n\n        <form id=\"form-password\">\n          <div class=\"field\">\n            <label for=\"new-password\">New password</label>\n            <div class=\"pw-row\">\n              <input id=\"new-password\" name=\"new-password\" type=\"password\" autocomplete=\"new-password\" required />\n              <button type=\"button\" class=\"secondary\" id=\"toggle-pw-1\" aria-controls=\"new-password\" aria-pressed=\"false\">Show</button>\n            </div>\n            <div class=\"password-checklist\" aria-live=\"polite\" id=\"pw-checklist\">\n              <div class=\"item fail\" data-rule=\"len\">• At least 12 characters</div>\n              <div class=\"item fail\" data-rule=\"upper\">• At least one uppercase letter (A–Z)</div>\n              <div class=\"item fail\" data-rule=\"lower\">• At least one lowercase letter (a–z)</div>\n              <div class=\"item fail\" data-rule=\"digit\">• At least one number (0–9)</div>\n              <div class=\"item fail\" data-rule=\"symbol\">• At least one symbol (e.g., ! ? # %)</div>\n            </div>\n            <div class=\"inline\" style=\"margin-top:8px\">\n              <button type=\"button\" class=\"secondary\" id=\"btn-suggest\">Generate suggestion</button>\n              <span class=\"tiny\">Suggestions are created on this device and never sent anywhere.</span>\n            </div>\n          </div>\n\n          <div class=\"field\">\n            <label for=\"confirm-password\">Confirm new password</label>\n            <div class=\"pw-row\">\n              <input id=\"confirm-password\" name=\"confirm-password\" type=\"password\" autocomplete=\"new-password\" required />\n              <button type=\"button\" class=\"secondary\" id=\"toggle-pw-2\" aria-controls=\"confirm-password\" aria-pressed=\"false\">Show</button>\n            </div>\n            <div class=\"hint tiny\">We don’t store your password in the browser. If you pause here and return later, you’ll need to retype it.</div>\n          </div>\n\n          <div class=\"status\" id=\"pw-status\" role=\"status\" aria-live=\"polite\"></div>\n\n          <div class=\"actions\">\n            <button type=\"submit\" id=\"btn-finish\" disabled>Save new password</button>\n            <button type=\"button\" class=\"secondary\" id=\"btn-save-exit-3\">Pause and return later</button>\n            <span class=\"spacer\"></span>\n            <button type=\"button\" class=\"ghost\" id=\"btn-reset-all-3\">Start over</button>\n          </div>\n        </form>\n\n        <details class=\"help\">\n          <summary>Tips for a memorable strong password</summary>\n          <ul>\n            - Combine 3–4 uncommon words with a symbol and number (e.g., \"Cedar!Radio7Book\"). \n            - Avoid personal info (names, birthdays). \n            - Use a password manager if possible.\n          </ul>\n        </details>\n      </section>\n\n      <!-- Step 4: Done -->\n      <section class=\"step\" id=\"done\" aria-labelledby=\"done-title\">\n        <h2 class=\"step-title\" id=\"done-title\" tabindex=\"-1\">All set — your password was updated</h2>\n        <p class=\"ok\">Success. You can now log in to your hospital account and accept the updated privacy conditions for your appointment.</p>\n\n        <div class=\"status success\" role=\"status\" aria-live=\"polite\">\n          Next step: go to the login page and sign in using your new password.\n        </div>\n\n        <div class=\"actions\">\n          <button type=\"button\" id=\"btn-go-login\">Go to login (demo)</button>\n          <button type=\"button\" class=\"secondary\" id=\"btn-start-again\">Reset another password</button>\n        </div>\n\n        <details class=\"help\">\n          <summary>What happens next?</summary>\n          <ul>\n            - This demo doesn’t connect to a real system. \n            - In a real app, you would now be redirected to sign in. \n            - Your progress data will remain saved on this device until you choose “Start over”.\n          </ul>\n        </details>\n      </section>\n\n      <!-- Persistent support and help -->\n      <aside class=\"support\" aria-label=\"Help and support\">\n        <h3>Need help?</h3>\n        <ul>\n          <li>Call Hospital Support: <strong>1‑800‑555‑0051</strong> (Mon–Fri, 8am–6pm)</li>\n          <li>Email: <a href=\"#\" aria-disabled=\"true\">support@cityhospital.example</a> (demo)</li>\n          <li>There are no time limits. You can pause anytime and return later.</li>\n        </ul>\n      </aside>\n    </main>\n\n    <footer>\n      <span>Demo only — no personal data leaves your device.</span>\n      <button type=\"button\" class=\"link\" id=\"btn-clear-state\">Clear saved progress</button>\n      <span class=\"tiny\">Version: 1.0 (client‑only)</span>\n    </footer>\n  </div>\n\n  <script>\n    /* =========================\n       Utilities and State\n       Maps to: Client-only logic, Mocked delivery, Deterministic values, Pause/Resume\n       ========================= */\n    const STORAGE_KEY = \"pwrecovery_state_v1\";\n\n    const defaultState = {\n      step: 1,                // 1: identify, 2: code, 3: password, 4: done\n      identifier: \"\",         // email or phone\n      delivery: \"auto\",       // chosen delivery method\n      resolvedMethod: null,   // 'email' or 'sms'\n      maskedDest: \"\",         // masked email or phone for display\n      verified: false,        // code verified\n      lastSentAt: null        // timestamp of last \"send\"\n    };\n\n    let state = loadState();\n\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (raw) {\n          const parsed = JSON.parse(raw);\n          return { ...defaultState, ...parsed };\n        }\n      } catch (e) { /* ignore */ }\n      return { ...defaultState };\n    }\n\n    function saveState() {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n\n    function clearState() {\n      localStorage.removeItem(STORAGE_KEY);\n      state = { ...defaultState };\n    }\n\n    // Deterministic 6-digit code from identifier\n    // Maps to: Mocked delivery — deterministic value\n    function computeCode(identifier) {\n      let sum = 0;\n      const salt = 123456; // fixed salt to ensure non-trivial yet deterministic\n      for (const ch of String(identifier || \"\")) {\n        sum = (sum + ch.charCodeAt(0) * 7) % 1000000;\n      }\n      sum = (sum + salt) % 1000000;\n      return String(sum).padStart(6, \"0\");\n    }\n\n    function maskEmail(email) {\n      const [user, domain] = String(email).split(\"@\");\n      if (!domain) return email;\n      const u = user.length <= 2 ? user[0] + \"*\" : user[0] + \"*\".repeat(Math.max(1, user.length - 2)) + user[user.length - 1];\n      const parts = domain.split(\".\");\n      const d0 = parts[0] || \"\";\n      const d0m = d0.length <= 2 ? d0[0] + \"*\" : d0[0] + \"*\".repeat(Math.max(1, d0.length - 2)) + d0[d0.length - 1];\n      return `${u}@${d0m}.${parts.slice(1).join(\".\")}`;\n    }\n\n    function maskPhone(phone) {\n      const digits = (\"\" + phone).replace(/\\D/g, \"\");\n      if (digits.length < 4) return phone;\n      return phone.replace(/\\d(?=\\d{4})/g, \"•\");\n    }\n\n    function isEmail(value) { return /\\S+@\\S+\\.\\S+/.test(String(value)); }\n    function isLikelyPhone(value) { return !isEmail(value) && /[\\d+\\s().-]{6,}/.test(String(value)); }\n\n    // Focus helper: move focus to a step title for orientation\n    function focusStepTitle(id) {\n      const el = document.getElementById(id);\n      if (el) { el.focus({ preventScroll: false }); }\n    }\n\n    /* =========================\n       View Management\n       Maps to: Visible progress, No unexpected changes (announce via aria-live), Clarity\n       ========================= */\n    function updateProgressUI() {\n      const totalSteps = 3;\n      const current = Math.min(state.step, 3);\n      const pct = ((current) / totalSteps) * 100;\n      document.getElementById(\"prog1\").style.setProperty(\"--pct\", current >= 1 ? \"100%\" : \"0%\");\n      document.getElementById(\"prog2\").style.setProperty(\"--pct\", current >= 2 ? (current === 2 ? \"100%\" : \"100%\") : \"0%\");\n      document.getElementById(\"prog3\").style.setProperty(\"--pct\", current >= 3 ? (current === 3 ? \"100%\" : \"100%\") : \"0%\");\n    }\n\n    function showStep(step) {\n      // Hide all\n      document.querySelectorAll(\"section.step\").forEach(s => s.classList.remove(\"active\"));\n      // Show target\n      switch (step) {\n        case 1:\n          document.getElementById(\"step1\").classList.add(\"active\");\n          focusStepTitle(\"step1-title\");\n          break;\n        case 2:\n          document.getElementById(\"step2\").classList.add(\"active\");\n          // Update destination text\n          const destEl = document.getElementById(\"dest-text\");\n          const method = state.resolvedMethod || \"contact\";\n          const dest = state.maskedDest || \"your contact\";\n          destEl.textContent = `We sent a 6‑digit code to your ${method}: ${dest}.`;\n          focusStepTitle(\"step2-title\");\n          break;\n        case 3:\n          document.getElementById(\"step3\").classList.add(\"active\");\n          focusStepTitle(\"step3-title\");\n          break;\n        case 4:\n        default:\n          document.getElementById(\"done\").classList.add(\"active\");\n          focusStepTitle(\"done-title\");\n      }\n      updateProgressUI();\n      state.step = step;\n      saveState();\n    }\n\n    /* =========================\n       Step 1: Identify\n       Maps to: Step-by-step guidance, Clear feedback, Mock send via console.log\n       ========================= */\n    const formIdentify = document.getElementById(\"form-identify\");\n    const idStatus = document.getElementById(\"id-status\");\n    const idInput = document.getElementById(\"identifier\");\n    const deliverySelect = document.getElementById(\"delivery\");\n\n    formIdentify.addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      idStatus.textContent = \"\";\n      const identifier = idInput.value.trim();\n      const deliveryChoice = deliverySelect.value;\n      if (!identifier) {\n        idStatus.innerHTML = \"Please enter your email or mobile number.\";\n        idStatus.setAttribute(\"role\", \"alert\");\n        return;\n      }\n      let method = \"email\";\n      if (deliveryChoice === \"email\") method = \"email\";\n      else if (deliveryChoice === \"sms\") method = \"sms\";\n      else { // auto\n        method = isEmail(identifier) ? \"email\" : (isLikelyPhone(identifier) ? \"sms\" : \"email\");\n      }\n\n      // Mask destination for display\n      const masked = method === \"email\" ? maskEmail(identifier) : maskPhone(identifier);\n\n      // Compute deterministic code and \"send\" via console.log\n      const code = computeCode(identifier);\n      const now = new Date().toISOString();\n      console.log(`[Mock Delivery] ${now} -> method=${method}, to=${identifier}, code=${code}`);\n\n      // Update state\n      state.identifier = identifier;\n      state.delivery = deliveryChoice;\n      state.resolvedMethod = method;\n      state.maskedDest = masked;\n      state.verified = false;\n      state.lastSentAt = now;\n      saveState();\n\n      idStatus.classList.remove(\"danger\");\n      idStatus.setAttribute(\"role\", \"status\");\n      idStatus.textContent = `Code sent to your ${method}: ${masked}. Check your ${method} and enter the code on the next step.`;\n      // Go to next step\n      showStep(2);\n      // Auto-focus code field after view updates\n      setTimeout(() => document.getElementById(\"code\")?.focus(), 60);\n    });\n\n    document.getElementById(\"btn-reset-all-1\").addEventListener(\"click\", () => {\n      clearState();\n      showStep(1);\n      idInput.value = \"\";\n      idStatus.textContent = \"\";\n    });\n    document.getElementById(\"btn-save-exit-1\").addEventListener(\"click\", () => {\n      saveState();\n      idStatus.textContent = \"Progress saved on this device. You can close the page and return later.\";\n    });\n\n    /* =========================\n       Step 2: Code verification\n       Maps to: Clear feedback, Resend (console.log), No timeouts\n       ========================= */\n    const formCode = document.getElementById(\"form-code\");\n    const codeInput = document.getElementById(\"code\");\n    const codeStatus = document.getElementById(\"code-status\");\n\n    document.getElementById(\"btn-resend\").addEventListener(\"click\", () => {\n      if (!state.identifier) {\n        codeStatus.textContent = \"Please go back and enter your contact first.\";\n        codeStatus.setAttribute(\"role\", \"alert\");\n        return;\n      }\n      const code = computeCode(state.identifier);\n      const now = new Date().toISOString();\n      console.log(`[Mock Delivery] ${now} -> RESEND method=${state.resolvedMethod}, to=${state.identifier}, code=${code}`);\n      state.lastSentAt = now;\n      saveState();\n      codeStatus.textContent = \"We’ve sent the code again. It’s the same for this demo.\";\n      codeStatus.setAttribute(\"role\", \"status\");\n    });\n\n    document.getElementById(\"btn-change-contact\").addEventListener(\"click\", () => {\n      // Let users adjust with progress kept\n      showStep(1);\n      idStatus.textContent = \"You can change your contact and we’ll send a new code.\";\n      setTimeout(() => idInput.focus(), 50);\n    });\n\n    formCode.addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      codeStatus.textContent = \"\";\n      const val = codeInput.value.trim();\n      if (!/^\\d{6}$/.test(val)) {\n        codeStatus.textContent = \"Please enter 6 digits.\";\n        codeStatus.setAttribute(\"role\", \"alert\");\n        return;\n      }\n      const expected = computeCode(state.identifier);\n      if (val !== expected) {\n        codeStatus.textContent = \"That code doesn’t match. Please check and try again, or resend.\";\n        codeStatus.setAttribute(\"role\", \"alert\");\n        return;\n      }\n      state.verified = true;\n      saveState();\n      codeStatus.textContent = \"Code verified.\";\n      codeStatus.setAttribute(\"role\", \"status\");\n      showStep(3);\n      setTimeout(() => document.getElementById(\"new-password\")?.focus(), 80);\n    });\n\n    document.getElementById(\"btn-reset-all-2\").addEventListener(\"click\", () => {\n      clearState();\n      showStep(1);\n      idInput.value = \"\";\n      codeInput.value = \"\";\n      codeStatus.textContent = \"\";\n    });\n    document.getElementById(\"btn-save-exit-2\").addEventListener(\"click\", () => {\n      saveState();\n      codeStatus.textContent = \"Progress saved. You can close and return later.\";\n    });\n\n    // Demo reveal code\n    document.getElementById(\"btn-show-code\").addEventListener(\"click\", () => {\n      if (!state.identifier) {\n        document.getElementById(\"demo-code\").textContent = \"Enter your contact on Step 1 first.\";\n        return;\n      }\n      const code = computeCode(state.identifier);\n      document.getElementById(\"demo-code\").innerHTML = `Your demo code is: <span class=\"kbd\">${code}</span>`;\n    });\n\n    /* =========================\n       Step 3: Password creation\n       Maps to: Strong password guidance, Show/hide, Suggestions, Clear feedback\n       ========================= */\n    const pw1 = document.getElementById(\"new-password\");\n    const pw2 = document.getElementById(\"confirm-password\");\n    const pwStatus = document.getElementById(\"pw-status\");\n    const btnFinish = document.getElementById(\"btn-finish\");\n\n    function validatePassword(pw) {\n      return {\n        len: pw.length >= 12,\n        upper: /[A-Z]/.test(pw),\n        lower: /[a-z]/.test(pw),\n        digit: /\\d/.test(pw),\n        symbol: /[^A-Za-z0-9]/.test(pw)\n      };\n    }\n\n    function updateChecklist() {\n      const v = validatePassword(pw1.value);\n      const checklist = document.getElementById(\"pw-checklist\");\n      checklist.querySelectorAll(\".item\").forEach(item => {\n        const rule = item.getAttribute(\"data-rule\");\n        const pass = v[rule];\n        item.classList.toggle(\"pass\", !!pass);\n        item.classList.toggle(\"fail\", !pass);\n      });\n      // Match status\n      const match = pw1.value && pw1.value === pw2.value;\n      if (pw2.value) {\n        pwStatus.textContent = match ? \"Passwords match.\" : \"Passwords don’t match yet.\";\n        pwStatus.classList.toggle(\"ok\", match);\n        pwStatus.classList.toggle(\"danger\", !match);\n        pwStatus.setAttribute(\"role\", \"status\");\n      } else {\n        pwStatus.textContent = \"\";\n        pwStatus.classList.remove(\"ok\",\"danger\");\n      }\n      const allGood = Object.values(v).every(Boolean) && match;\n      btnFinish.disabled = !allGood;\n    }\n\n    pw1.addEventListener(\"input\", updateChecklist);\n    pw2.addEventListener(\"input\", updateChecklist);\n\n    function toggleVisibility(btn, input) {\n      const isShown = input.type === \"text\";\n      input.type = isShown ? \"password\" : \"text\";\n      btn.setAttribute(\"aria-pressed\", String(!isShown));\n      btn.textContent = isShown ? \"Show\" : \"Hide\";\n      input.focus();\n    }\n    document.getElementById(\"toggle-pw-1\").addEventListener(\"click\", () => toggleVisibility(document.getElementById(\"toggle-pw-1\"), pw1));\n    document.getElementById(\"toggle-pw-2\").addEventListener(\"click\", () => toggleVisibility(document.getElementById(\"toggle-pw-2\"), pw2));\n\n    // Password suggestion generator: passphrase + symbol + number\n    // Local-only; does not send anywhere.\n    document.getElementById(\"btn-suggest\").addEventListener(\"click\", () => {\n      const words = [\n        \"cedar\",\"radio\",\"ocean\",\"marble\",\"whisper\",\"falcon\",\"velvet\",\"citron\",\"harbor\",\"violet\",\n        \"ember\",\"castle\",\"meadow\",\"puzzle\",\"saffron\",\"maple\",\"willow\",\"tundra\",\"lantern\",\"pepper\",\n        \"galaxy\",\"orchid\",\"cobalt\",\"sunset\",\"parka\",\"walnut\",\"spruce\",\"ripple\",\"saffron\",\"thistle\"\n      ];\n      function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }\n      const w1 = pick(words), w2 = pick(words), w3 = pick(words), w4 = pick(words);\n      const symbol = \"!@#$%^&*?\".charAt(Math.floor(Math.random()*9));\n      const num = Math.floor(Math.random()*90 + 10); // two digits\n      // Capitalize some words for upper requirement\n      const cap = s => s.charAt(0).toUpperCase() + s.slice(1);\n      const suggestion = `${cap(w1)}${w2}${symbol}${cap(w3)}${w4}${num}`;\n      pw1.value = suggestion;\n      pw2.value = \"\";\n      updateChecklist();\n      pw2.focus();\n      pwStatus.textContent = \"Suggestion inserted. You can edit it.\";\n      pwStatus.setAttribute(\"role\", \"status\");\n    });\n\n    document.getElementById(\"form-password\").addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      const v = validatePassword(pw1.value);\n      const allGood = Object.values(v).every(Boolean) && pw1.value === pw2.value;\n      if (!allGood) {\n        pwStatus.textContent = \"Please meet all requirements and ensure both passwords match.\";\n        pwStatus.setAttribute(\"role\", \"alert\");\n        return;\n      }\n      // In a real app, this would be submitted to the server.\n      // For demo, we simply proceed and DO NOT store the password.\n      console.log(`[Mock Update] Password updated for identifier=${state.identifier}`);\n      showStep(4);\n    });\n\n    document.getElementById(\"btn-reset-all-3\").addEventListener(\"click\", () => {\n      clearState();\n      pw1.value = \"\";\n      pw2.value = \"\";\n      pwStatus.textContent = \"\";\n      showStep(1);\n    });\n    document.getElementById(\"btn-save-exit-3\").addEventListener(\"click\", () => {\n      saveState();\n      pwStatus.textContent = \"Progress saved. When you return, re-enter your new password.\";\n    });\n\n    /* =========================\n       Done step\n       ========================= */\n    document.getElementById(\"btn-go-login\").addEventListener(\"click\", () => {\n      alert(\"Demo only: In a real application, you would now go to the login page.\");\n    });\n    document.getElementById(\"btn-start-again\").addEventListener(\"click\", () => {\n      clearState();\n      showStep(1);\n    });\n\n    /* =========================\n       Footer controls\n       ========================= */\n    document.getElementById(\"btn-clear-state\").addEventListener(\"click\", () => {\n      clearState();\n      alert(\"Saved progress cleared from this device.\");\n      showStep(1);\n    });\n\n    /* =========================\n       Initial load: Restore state and view\n       Maps to: Allow pause and return later; No time pressure\n       ========================= */\n    function initFromState() {\n      // Restore identifier and delivery\n      if (state.identifier) {\n        idInput.value = state.identifier;\n      }\n      deliverySelect.value = state.delivery || \"auto\";\n\n      // Decide which step to show\n      const step = Number(state.step) || 1;\n      showStep(step);\n\n      // If the user navigates back, keep contextual hints\n      if (step === 2 && state.maskedDest) {\n        const destEl = document.getElementById(\"dest-text\");\n        const m = state.resolvedMethod || \"contact\";\n        destEl.textContent = `We sent a 6‑digit code to your ${m}: ${state.maskedDest}.`;\n      }\n    }\n\n    initFromState();\n\n    // Accessibility: allow Enter on code input to submit only when length 6\n    codeInput.addEventListener(\"input\", () => {\n      codeInput.value = codeInput.value.replace(/\\D/g, \"\").slice(0, 6);\n    });\n\n    // Keyboard hint for users\n    document.addEventListener(\"keydown\", (e) => {\n      if ((e.key === \"Enter\" || e.key === \"Return\") && document.activeElement === idInput) {\n        // Let form submit naturally\n      }\n    });\n  </script>\n</body>\n</html>\n", "task_list": [], "evaluator_md": "", "done": false, "iter": 1, "mode": "single"}
