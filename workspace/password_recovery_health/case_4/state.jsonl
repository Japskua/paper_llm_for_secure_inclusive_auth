{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 36px;\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Global status live region for concise guidance -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    function setGlobalStatus(msg, type = 'info') {\n      if (!msg) {\n        dom.globalStatus.textContent = '';\n        return;\n      }\n      dom.globalStatus.textContent = msg;\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6‑digit code was sent if the account exists.');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // If resuming at Step 2 with an identifier, remind about code\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6‑digit code. You can resend if needed.');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["Insert a visible .status area (e.g., <div id=\"global-status-visible\" class=\"status\" role=\"status\" aria-live=\"polite\" hidden></div>) near the top of <main>.", "Modify setGlobalStatus(msg) to update #global-status (screen-reader) and #global-status-visible (visible), toggling hidden based on msg presence and applying success/info/error styles as needed.", "In sendOrResendCode(), after console.log, call setGlobalStatus('A 6‑digit code was sent if the account exists.') and ensure it is visible.", "On “Resend code” click, show a visible confirmation: setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)').", "On init when resuming Step 2, show visible guidance: setGlobalStatus('Resuming: Enter the 6‑digit code. You can resend if needed.').", "Before navigating from Step 2 to Step 3 on success, optionally update the visible status to “Code accepted. Next: create a new password.” This can remain as-is if navigation is immediate, but ensure other key messages are visible per tasks 1–3."], "evaluator_md": "SUMMARY\nThe single-file, client-only password recovery flow largely satisfies the stated requirements: it’s semantic, accessible-minded, mocked deterministically, and designed with ADHD-friendly considerations (clear steps, visible progress, no timeouts, persistent state, and help available). One notable UX gap is that several feedback messages are only exposed to screen readers via a visually hidden live region, leaving sighted users without visible confirmation for key actions (e.g., “code sent” and “code resent”). Otherwise, the flow, validation, and persistence behave as specified.\n\nFUNCTIONAL_CHECK\n- Single deliverable (index.html) with inline CSS & JS — PASS\n  Justification: All HTML, CSS, and JS are contained within the single file; no external assets or build steps.\n- Client-only; no network calls; deterministic mocking — PASS\n  Justification: No fetch/XHR. Verification code is generated deterministically via generateCode and “sent” via console.log.\n- Clear, step-by-step flow (Identify → Verify → New Password → Done) with progress indicator — PASS\n  Justification: Four sections with progress nav, aria-current updating, and step headings.\n- Step 1: Collect email/username; do not disclose account existence — PASS\n  Justification: Validates non-empty; post-submit messaging and Step 2 text avoid revealing existence; mocked send uses console.log.\n- Step 2: Enter 6-digit code; numeric handling; resend uses same deterministic code — PASS\n  Justification: inputmode numeric, sanitization to digits, max length 6; resend logs identical code.\n- Step 3: New password flow with min length and confirmation; show/hide toggles — PASS\n  Justification: Enforces ≥8 chars and match; toggles with aria-pressed; inline validation.\n- Step 4: Success confirmation and next steps; ability to restart — PASS\n  Justification: Clear “Done” step with Back and Start over (confirm) that clears localStorage.\n- Privacy: Clear sensitive inputs upon success/advance — PASS\n  Justification: clearSensitive() clears code and password fields; passwords never persisted.\n- State persistence and resume: step and key inputs persisted; restore on load — PASS\n  Justification: localStorage persists step, identifier, and entered code; restored on init with focus management.\n- Inclusivity: ADHD-friendly microcopy, no timeouts, clear structure, visible progress, help available — PASS\n  Justification: Simple copy, no timers, persistent help details, progress nav, and reminders. Allows pausing and resuming.\n- Accessibility: Semantic landmarks, labels, live regions, focus management, keyboard-friendly, large tap targets — PASS\n  Justification: header/main/footer landmarks, labels with aria-describedby, aria-live regions, focus on headings, min 44px controls, clear focus outline.\n- Clear feedback at each step, with visible confirmation of actions — FAIL\n  Justification: Many feedback messages (e.g., “A 6‑digit code was sent…”, “Code resent…”) are written only to #global-status, which is visually hidden. Sighted users get no visible confirmation on these actions, potentially increasing cognitive load.\n\nFAILING_ITEMS\n- Sighted users receive no visible feedback for key events:\n  - After Step 1 submission (code “sent”).\n  - After clicking “Resend code.”\n  - Resume guidance at Step 2 (“Resuming: Enter the 6‑digit code…”) is also only screen reader-visible.\n  Currently these are announced via the visually hidden #global-status live region only.\n\nNEW_TASKS\n1) Add a visible status component:\n   - Insert a visible .status area (e.g., <div id=\"global-status-visible\" class=\"status\" role=\"status\" aria-live=\"polite\" hidden></div>) near the top of <main>.\n2) Update setGlobalStatus to drive both SR and visual feedback:\n   - Modify setGlobalStatus(msg) to update #global-status (screen-reader) and #global-status-visible (visible), toggling hidden based on msg presence and applying success/info/error styles as needed.\n3) Show visible confirmations for key actions:\n   - In sendOrResendCode(), after console.log, call setGlobalStatus('A 6‑digit code was sent if the account exists.') and ensure it is visible.\n   - On “Resend code” click, show a visible confirmation: setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)').\n   - On init when resuming Step 2, show visible guidance: setGlobalStatus('Resuming: Enter the 6‑digit code. You can resend if needed.').\n4) Optional but helpful: Keep the “Code accepted” message visible briefly\n   - Before navigating from Step 2 to Step 3 on success, optionally update the visible status to “Code accepted. Next: create a new password.” This can remain as-is if navigation is immediate, but ensure other key messages are visible per tasks 1–3.\n\nDECISION\nFAIL", "done": false, "iter": 1, "step": 3}
{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    /* Requirement: type-specific global status styles (non-intrusive but noticeable) */\n    .status--info {\n      background: #f0f5ff;\n      color: #0b2c5a;\n      border-color: #c9dcff;\n    }\n    .status--success {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status--error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 36px;\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Global status live region for concise guidance (SR-only) -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n    <!-- Requirement: Visible global status for users who benefit from on-screen cues -->\n    <div id=\"global-status-visible\" class=\"status\" role=\"status\" aria-live=\"polite\" hidden></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n      dom.globalStatusVisible = document.getElementById('global-status-visible');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    // Requirement: visible + SR global status updates with type-specific styling\n    function setGlobalStatus(msg, type = 'info') {\n      const sr = dom.globalStatus;\n      const vis = dom.globalStatusVisible;\n      const modifiers = ['status--info', 'status--success', 'status--error'];\n\n      if (!msg) {\n        if (sr) sr.textContent = '';\n        if (vis) {\n          vis.textContent = '';\n          vis.hidden = true;\n          vis.classList.remove(...modifiers);\n        }\n        return;\n      }\n\n      if (sr) sr.textContent = msg;\n\n      if (vis) {\n        vis.textContent = msg;\n        vis.hidden = false;\n        vis.classList.remove(...modifiers);\n        const map = { info: 'status--info', success: 'status--success', error: 'status--error' };\n        vis.classList.add(map[type] || 'status--info');\n      }\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6-digit code was sent if the account exists.', 'info');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.', 'success');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)', 'info');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).', 'success');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // Requirement: On resume at Step 2, provide a gentle reminder\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6-digit code. You can resend if needed.', 'info');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["Prevent duplicate live announcements for global status:", "Option A (recommended): Remove role=\"status\" and aria-live from #global-status-visible and add aria-hidden=\"true\" so it remains visible but is ignored by assistive tech.", "Option B: Keep role/live only on one region (prefer the SR-only #global-status) and ensure the other does not have any live role.", "Verify with a screen reader (e.g., NVDA/VoiceOver) that each global status update is announced exactly once."], "evaluator_md": "SUMMARY\nThe single-file password recovery demo largely meets the functional, UX, and inclusivity requirements: it is fully client-side with deterministic, mocked code delivery; provides a clear 4-step flow with progress, guidance, and persistence; and includes accessibility and ADHD-friendly design choices. One accessibility issue could cause duplicate screen-reader announcements due to two global status regions both marked as live. Otherwise, the solution appears robust and compliant with the stated goals.\n\nFUNCTIONAL_CHECK\n- Single-file, client-only implementation; no network calls: PASS — All HTML/CSS/JS inline; no fetch/XHR; console.log used for mocking.\n- Deterministic verification code generation and mocked delivery: PASS — generateCode(identifier) deterministic; send/resend logs to console.\n- Four clear steps with progress indicator and aria-current: PASS — Steps 1–4 with visible progress pills; aria-current managed; done/current states applied.\n- Step 1 (Identify) collects email/username with validation and privacy-preserving copy: PASS — Required field, inline error, privacy statement avoids account enumeration.\n- Step 2 (Verify) code entry with sanitization, validation, and resend; no account enumeration: PASS — Input sanitized to digits; validates length and match; resend logs same code; copy avoids revealing existence.\n- Step 3 (New Password) with min length, confirm, show/hide toggles, inline feedback, and clearing sensitive inputs: PASS — 8+ chars rule, match check, visibility toggles, inline status; clearSensitive clears fields on success.\n- Step 4 (Done) confirmation with next steps and restart option: PASS — Presents next steps; Back and Start over provided; Start over clears state with confirmation.\n- Persist step and key inputs; restore on load; allow pause/resume: PASS — localStorage saves step, identifier, and enteredCode; restoration and orientation status shown on resume.\n- Clear, low-stress copy; no timers/timeouts; no unexpected auto-advance: PASS — Copy is concise and supportive; no timeouts; navigation changes only on user action.\n- Accessibility: semantic structure, labels, focus management, keyboard operability, adequate touch targets: PASS — Uses header/main/section/footer; labels, aria-describedby, aria-invalid; focus to headings; 44px buttons; Escape closes help.\n- Visible progress and reminders of next step: PASS — Progress pills and global/inline status messages consistently guide the next action.\n- Help available at all stages, easy to find: PASS — Persistent <details> with tips and contact placeholders.\n- Start Over action with confirmation clears saved progress: PASS — Present in Steps 1 and 4; confirm dialog; clears localStorage.\n- Global status messaging is accessible and not duplicative: FAIL — Both a visually-hidden and a visible global status region have live roles (role=\"status\"), likely causing duplicate announcements in screen readers.\n\nFAILING_ITEMS\n- Duplicate screen-reader announcements: The visible global status (#global-status-visible) and the SR-only global status (#global-status) both have role=\"status\" and aria-live=\"polite\". This can cause the same message to be announced twice, increasing cognitive load and harming accessibility.\n\nNEW_TASKS\n1. Prevent duplicate live announcements for global status:\n   - Option A (recommended): Remove role=\"status\" and aria-live from #global-status-visible and add aria-hidden=\"true\" so it remains visible but is ignored by assistive tech.\n   - Option B: Keep role/live only on one region (prefer the SR-only #global-status) and ensure the other does not have any live role.\n   - Verify with a screen reader (e.g., NVDA/VoiceOver) that each global status update is announced exactly once.\n\nDECISION\nFAIL", "done": false, "iter": 2, "step": 6}
{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    /* Requirement: type-specific global status styles (non-intrusive but noticeable) */\n    .status--info {\n      background: #f0f5ff;\n      color: #0b2c5a;\n      border-color: #c9dcff;\n    }\n    .status--success {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status--error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 36px;\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Accessibility decision (Task): Use a single live region for global announcements to prevent duplicate SR output.\n         - #global-status (below) is screen-reader-only with role=\"status\" aria-live=\"polite\".\n         - #global-status-visible mirrors the text for sighted users but is aria-hidden=\"true\" and has no live role. -->\n    <!-- Global status live region for concise guidance (SR-only) -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n    <!-- Visible global status for sighted users; aria-hidden to avoid duplicate announcements -->\n    <div id=\"global-status-visible\" class=\"status\" aria-hidden=\"true\" hidden></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n      dom.globalStatusVisible = document.getElementById('global-status-visible');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    // Requirement: visible + SR global status updates with type-specific styling\n    // Accessibility note: Only #global-status is a live region. #global-status-visible mirrors text for sighted users but is aria-hidden.\n    function setGlobalStatus(msg, type = 'info') {\n      const sr = dom.globalStatus;\n      const vis = dom.globalStatusVisible;\n      const modifiers = ['status--info', 'status--success', 'status--error'];\n\n      if (!msg) {\n        if (sr) sr.textContent = '';\n        if (vis) {\n          vis.textContent = '';\n          vis.hidden = true;\n          vis.classList.remove(...modifiers);\n        }\n        return;\n      }\n\n      if (sr) sr.textContent = msg;\n\n      if (vis) {\n        vis.textContent = msg;\n        vis.hidden = false;\n        vis.classList.remove(...modifiers);\n        const map = { info: 'status--info', success: 'status--success', error: 'status--error' };\n        vis.classList.add(map[type] || 'status--info');\n      }\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6-digit code was sent if the account exists.', 'info');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.', 'success');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)', 'info');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).', 'success');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // Requirement: On resume at Step 2, provide a gentle reminder\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6-digit code. You can resend if needed.', 'info');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Global status is announced exactly once via #global-status; the visible status is aria-hidden.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["None."], "evaluator_md": "SUMMARY\nThe provided index.html delivers a complete, single-file, client-only mocked password recovery flow that aligns closely with the requirements. It implements a clear 4-step process with inclusive, low-stress UX geared for users with ADHD, uses deterministic code generation with console logging for “delivery,” persists progress via localStorage, and includes robust accessibility (ARIA live regions, focus management, keyboard support). Minor polish opportunities exist, but no requirement blockers were found.\n\nFUNCTIONAL_CHECK\n- Single file, semantic HTML, inline CSS & JS: PASS — All markup, style, and logic are in one file using semantic elements; well-commented.\n- Client-only; no backend/network calls; mocked delivery via console.log: PASS — No fetch/XHR; code is logged deterministically.\n- Clear 4-step flow (Identify, Verify, New Password, Done) with visible progress: PASS — Steps 1–4 implemented; progress nav with aria-current and a live region announces progress.\n- Step 1: Collect email/username, validate, and avoid account enumeration: PASS — Input accepts either; inline validation; copy explicitly avoids revealing account existence.\n- Step 1 submission triggers deterministic code generation and “send”: PASS — generateCode(identifier) and sendOrResendCode() log to console with consistent value.\n- Persist step and key inputs; restore on load; focus management: PASS — step, identifier, and enteredCode persisted; restored on init; headings focused on step change.\n- Step 2: Enter 6-digit code with sanitization and validation: PASS — Numeric sanitization, length check, comparison to deterministic expected, inline error/status.\n- Step 2: Resend code logs the same deterministic code; no timers: PASS — Resend re-logs identical code; no rate limit or countdown.\n- Step 3: New password and confirm; simple rules; show/hide toggles; inline feedback: PASS — Minimum 8 chars, must match; toggle visibility with aria-pressed and focus management; inline live regions for messages.\n- On success, advance to Step 4 and clear sensitive inputs: PASS — clearSensitive() wipes code and password fields; navigation to Done.\n- Step 4: Confirmation with next steps and restart: PASS — Provides success copy, “Back,” and “Start over” that clears localStorage with confirm.\n- Back and Cancel controls; no unexpected auto-advance: PASS — Buttons present on each step; navigation occurs only on explicit actions.\n- Global and inline feedback via ARIA live regions; avoid duplicate SR announcements: PASS — Single global live region for announcements; visible status is aria-hidden; inline role=\"alert\"/role=\"status\" used appropriately.\n- Keyboard accessibility and focus visibility: PASS — Visible outlines; Enter submits; Esc closes Help; tab order is logical.\n- Inclusivity (ADHD): Simple, step-by-step guidance; visible progress; reminders; no timeouts; low distraction; help accessible; can pause/resume: PASS — Clear microcopy, no timers, persistent help <details>, state persistence and resume message on Step 2.\n- Privacy protections: PASS — Neutral copy avoids account existence disclosure; no data leaves browser.\n- “Start Over” with confirm clears local state: PASS — Available on Step 1 and Step 4; confirmation dialog; clears localStorage.\n- Documentation and mapping to spec: PASS — Top-of-file mapping and manual testing checklist included.\n- Visual clarity and contrast; large tap targets: PASS — High-contrast palette; 44px min-height controls; consistent spacing.\n\nFAILING_ITEMS\n- None found that block requirements or inclusivity criteria.\n\nNEW_TASKS\n- None.\n\nDECISION\nPASS", "done": false, "iter": 3, "step": 9}
{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    /* Requirement: type-specific global status styles (non-intrusive but noticeable) */\n    .status--info {\n      background: #f0f5ff;\n      color: #0b2c5a;\n      border-color: #c9dcff;\n    }\n    .status--success {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status--error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 36px;\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Accessibility decision (Task): Use a single live region for global announcements to prevent duplicate SR output.\n         - #global-status (below) is screen-reader-only with role=\"status\" aria-live=\"polite\".\n         - #global-status-visible mirrors the text for sighted users but is aria-hidden=\"true\" and has no live role. -->\n    <!-- Global status live region for concise guidance (SR-only) -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n    <!-- Visible global status for sighted users; aria-hidden to avoid duplicate announcements -->\n    <div id=\"global-status-visible\" class=\"status\" aria-hidden=\"true\" hidden></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n      dom.globalStatusVisible = document.getElementById('global-status-visible');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    // Requirement: visible + SR global status updates with type-specific styling\n    // Accessibility note: Only #global-status is a live region. #global-status-visible mirrors text for sighted users but is aria-hidden.\n    function setGlobalStatus(msg, type = 'info') {\n      const sr = dom.globalStatus;\n      const vis = dom.globalStatusVisible;\n      const modifiers = ['status--info', 'status--success', 'status--error'];\n\n      if (!msg) {\n        if (sr) sr.textContent = '';\n        if (vis) {\n          vis.textContent = '';\n          vis.hidden = true;\n          vis.classList.remove(...modifiers);\n        }\n        return;\n      }\n\n      if (sr) sr.textContent = msg;\n\n      if (vis) {\n        vis.textContent = msg;\n        vis.hidden = false;\n        vis.classList.remove(...modifiers);\n        const map = { info: 'status--info', success: 'status--success', error: 'status--error' };\n        vis.classList.add(map[type] || 'status--info');\n      }\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6-digit code was sent if the account exists.', 'info');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.', 'success');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)', 'info');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).', 'success');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // Requirement: On resume at Step 2, provide a gentle reminder\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6-digit code. You can resend if needed.', 'info');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Global status is announced exactly once via #global-status; the visible status is aria-hidden.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["Increase the min-height of .toggle-visibility buttons to 44px to match the large tap target goal."], "evaluator_md": "SUMMARY:\nThe provided index.html implements a complete, single-page, client-only mocked password recovery flow. It meets the specified functional, accessibility, and inclusivity goals: clear four-step process, deterministic mock verification via console.log, strong guidance and progress, no timeouts, and state persistence. Accessibility is addressed with semantic HTML, ARIA live regions, focus management, and keyboard support. Minor polish opportunities exist (e.g., slightly smaller tap target on the show/hide buttons), but no acceptance-criteria blockers.\n\nFUNCTIONAL_CHECK:\n- Single deliverable: one HTML file with inline CSS and JS — PASS\n  Justification: All logic, styles, and markup are contained in index.html; no external assets or network requests.\n\n- Four-step flow (Identify → Verify → New Password → Done) — PASS\n  Justification: Steps are implemented as sections (#step1–#step4) with headings, forms, and navigation controls. Progress pills show current and completed steps.\n\n- Mocked verification, deterministic code, no backend — PASS\n  Justification: generateCode(identifier) produces a deterministic 6-digit code; “send” and “resend” log to console via console.log. No fetch/XHR used.\n\n- Privacy: do not reveal account existence — PASS\n  Justification: Messaging says “sent if the account exists”; flow proceeds regardless of identifier; no account existence feedback.\n\n- Step 1 validation and feedback — PASS\n  Justification: Requires non-empty identifier; inline error with role=\"alert\" and aria-invalid toggling; global status guidance on error.\n\n- Step 2 verification: 6-digit numeric, inline validation, resend same code — PASS\n  Justification: Input sanitized to digits, max length 6; mismatch error; correct code based on generateCode; resend logs same code.\n\n- Step 3 password rules, confirm, show/hide toggles — PASS\n  Justification: Enforces >= 8 chars and exact match; inline error and live success; show/hide buttons toggle type, focus returned, aria-pressed toggled.\n\n- Step 4 confirmation, next steps, restart — PASS\n  Justification: Clear completion message and actions; Start over clears state with confirmation; Back returns to Step 3 (password fields remain cleared).\n\n- Never auto-advance; explicit user action required — PASS\n  Justification: Navigation occurs only on form submit or button clicks; no automatic step changes.\n\n- Progress indicator and orientation support — PASS\n  Justification: Visible progress pills, screen-reader live “Step X of 4”, headings indicate step; focus moved to step headings on navigation and init.\n\n- State persistence and resume without data loss (except sensitive fields) — PASS\n  Justification: localStorage stores step, identifier, and code; restored on load; passwords never repopulated; code cleared on advance; reminder status when resuming at Step 2.\n\n- Accessibility: semantic HTML, ARIA, keyboard-friendly, focus outlines — PASS\n  Justification: Uses header/nav/main/section/footer; aria-live regions for status and progress; role=\"alert\" for errors; tabbable controls; visible focus outline; Escape closes Help.\n\n- Inclusivity (ADHD-friendly): simple guidance, clear feedback, no timeouts, ability to pause/return, help available — PASS\n  Justification: Clear, concise microcopy; no timers; help via persistent <details>; progress and next-step reminders; low-distraction styling.\n\n- Client-only; no network calls — PASS\n  Justification: No external requests; console.log used for mock delivery.\n\n- Start Over clears persisted state with confirmation — PASS\n  Justification: Start over available on Step 1 and Step 4; confirmation dialog; localStorage cleared; global status confirms.\n\n- Commented sections mapping to the spec and testing checklist — PASS\n  Justification: Introductory mapping comment and a detailed manual testing checklist are present.\n\nFAILING_ITEMS:\n- Show/Hide password toggle buttons have min-height 36px (slightly below the 44px target size used elsewhere), which is a minor tap-target inconsistency.\n\nNEW_TASKS:\n1. Increase the min-height of .toggle-visibility buttons to 44px to match the large tap target goal.\n\nDECISION:\nPASS", "done": false, "iter": 4, "step": 12}
{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    /* Requirement: type-specific global status styles (non-intrusive but noticeable) */\n    .status--info {\n      background: #f0f5ff;\n      color: #0b2c5a;\n      border-color: #c9dcff;\n    }\n    .status--success {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status--error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 44px; /* Increased to meet large tap target requirement */\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Accessibility decision (Task): Use a single live region for global announcements to prevent duplicate SR output.\n         - #global-status (below) is screen-reader-only with role=\"status\" aria-live=\"polite\".\n         - #global-status-visible mirrors the text for sighted users but is aria-hidden=\"true\" and has no live role. -->\n    <!-- Global status live region for concise guidance (SR-only) -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n    <!-- Visible global status for sighted users; aria-hidden to avoid duplicate announcements -->\n    <div id=\"global-status-visible\" class=\"status\" aria-hidden=\"true\" hidden></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n      dom.globalStatusVisible = document.getElementById('global-status-visible');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    // Requirement: visible + SR global status updates with type-specific styling\n    // Accessibility note: Only #global-status is a live region. #global-status-visible mirrors text for sighted users but is aria-hidden.\n    function setGlobalStatus(msg, type = 'info') {\n      const sr = dom.globalStatus;\n      const vis = dom.globalStatusVisible;\n      const modifiers = ['status--info', 'status--success', 'status--error'];\n\n      if (!msg) {\n        if (sr) sr.textContent = '';\n        if (vis) {\n          vis.textContent = '';\n          vis.hidden = true;\n          vis.classList.remove(...modifiers);\n        }\n        return;\n      }\n\n      if (sr) sr.textContent = msg;\n\n      if (vis) {\n        vis.textContent = msg;\n        vis.hidden = false;\n        vis.classList.remove(...modifiers);\n        const map = { info: 'status--info', success: 'status--success', error: 'status--error' };\n        vis.classList.add(map[type] || 'status--info');\n      }\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6-digit code was sent if the account exists.', 'info');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.', 'success');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)', 'info');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).', 'success');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // Requirement: On resume at Step 2, provide a gentle reminder\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6-digit code. You can resend if needed.', 'info');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Global status is announced exactly once via #global-status; the visible status is aria-hidden.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["Increase the min-height of .toggle-visibility buttons to 44px to match the large tap target goal."], "evaluator_md": "## SUMMARY\nThe provided index.html implements a complete, single-file, client-only, mocked password recovery flow that aligns with the requirements and inclusivity goals. It delivers a clear 4-step process (Identify, Verify, New Password, Done) with progress tracking, state persistence via localStorage, deterministic code verification via console.log, accessible controls, and low-stress copy. It includes help, back/cancel controls, and avoids revealing account existence. No external calls are made, and sensitive inputs are cleared appropriately. Overall, it meets the functional, UX, and inclusivity requirements.\n\n## FUNCTIONAL_CHECK\n- PASS — Single file deliverable with inline CSS and JS; no external dependencies\n  - One index.html file; all CSS and JS inline; no external assets requested.\n- PASS — Client-only; no network calls; mocked “delivery” via console.log\n  - No fetch/XHR; sendOrResendCode logs deterministic code to console.\n- PASS — Clear multi-step flow (Identify, Verify, New Password, Done)\n  - Four sections (step1–step4) with headings and guidance; only one visible at a time.\n- PASS — Visible progress indicator with current and completed steps\n  - <nav aria-label=\"Progress\"> with pills, current step highlighted, completed steps marked “done”, live region announces changes.\n- PASS — Step 1: Collect email/username with validation; proceed only if valid\n  - Required field, inline error with role=\"alert\" and aria-invalid on failure; continues only when non-empty.\n- PASS — Step 1: Generic confirmation without revealing account existence\n  - Global status message: “A 6-digit code was sent if the account exists.” and privacy note in UI; no existence leakage.\n- PASS — Deterministic 6-digit code generation tied to identifier; consistent resend\n  - generateCode(identifier) deterministic; console.log displays the same code on resend.\n- PASS — Step 2: Code input accepts 6 digits only with clear feedback\n  - Input sanitization to digits; maxlength 6; clear inline error for short/wrong code; success message and progression on correct code.\n- PASS — Step 2: Resend available without timers; consistent messaging\n  - Resend button logs same code and shows an info status; no rate limiting or time pressure.\n- PASS — Step 3: New password and confirm with minimum rules enforced\n  - Requires ≥8 chars and exact match; clear inline errors; success feedback shown.\n- PASS — Step 3: Show/Hide password controls are accessible\n  - Toggle buttons with aria-pressed and aria-controls; keyboard operable; focus returns to input; adequate tap targets.\n- PASS — Privacy: Clear sensitive inputs and avoid persisting passwords\n  - Passwords and code cleared via clearSensitive; passwords not repopulated on reload.\n- PASS — Step 4: Confirmation with next steps and restart option\n  - “All set” screen includes next steps and Start over; Back present.\n- PASS — Persistence: Save/restore progress in localStorage; user can pause and resume\n  - State includes step, identifier, and enteredCode; restored on load; resume reminder at Step 2.\n- PASS — Accessibility: Semantic structure, ARIA, live regions, and focus management\n  - Roles for banner/main/contentinfo, labels/aria-describedby, aria-invalid updates, live regions for progress and status, focus on section headings, keyboard friendly, 44px tap targets.\n- PASS — Inclusivity: Simple, consistent language; low distraction; no timeouts; help accessible; visible progress; reminders\n  - Clear microcopy; calm visuals; no timers; help details always available; global status messages and progress indicators support orientation.\n- PASS — Back/Cancel controls; no unexpected auto-advance\n  - Back/Cancel present across steps; transitions occur only after user actions.\n- PASS — Start Over action with confirmation; clears saved progress\n  - Start over on Steps 1 and 4; confirm dialog; clears localStorage and resets UI.\n- PASS — Commented sections mapping to spec and checklist included\n  - Top-of-file mapping and a manual testing checklist provided.\n\n## FAILING_ITEMS\n- None identified.\n\n## NEW_TASKS\n- None.\n\n## DECISION\nPASS", "done": false, "iter": 5, "step": 15}
{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    /* Requirement: type-specific global status styles (non-intrusive but noticeable) */\n    .status--info {\n      background: #f0f5ff;\n      color: #0b2c5a;\n      border-color: #c9dcff;\n    }\n    .status--success {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status--error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 44px; /* Increased to meet large tap target requirement */\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Accessibility decision (Task): Use a single live region for global announcements to prevent duplicate SR output.\n         - #global-status (below) is screen-reader-only with role=\"status\" aria-live=\"polite\".\n         - #global-status-visible mirrors the text for sighted users but is aria-hidden=\"true\" and has no live role. -->\n    <!-- Global status live region for concise guidance (SR-only) -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n    <!-- Visible global status for sighted users; aria-hidden to avoid duplicate announcements -->\n    <div id=\"global-status-visible\" class=\"status\" aria-hidden=\"true\" hidden></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n      dom.globalStatusVisible = document.getElementById('global-status-visible');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    // Requirement: visible + SR global status updates with type-specific styling\n    // Accessibility note: Only #global-status is a live region. #global-status-visible mirrors text for sighted users but is aria-hidden.\n    function setGlobalStatus(msg, type = 'info') {\n      const sr = dom.globalStatus;\n      const vis = dom.globalStatusVisible;\n      const modifiers = ['status--info', 'status--success', 'status--error'];\n\n      if (!msg) {\n        if (sr) sr.textContent = '';\n        if (vis) {\n          vis.textContent = '';\n          vis.hidden = true;\n          vis.classList.remove(...modifiers);\n        }\n        return;\n      }\n\n      if (sr) sr.textContent = msg;\n\n      if (vis) {\n        vis.textContent = msg;\n        vis.hidden = false;\n        vis.classList.remove(...modifiers);\n        const map = { info: 'status--info', success: 'status--success', error: 'status--error' };\n        vis.classList.add(map[type] || 'status--info');\n      }\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6-digit code was sent if the account exists.', 'info');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.', 'success');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)', 'info');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).', 'success');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // Requirement: On resume at Step 2, provide a gentle reminder\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6-digit code. You can resend if needed.', 'info');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Global status is announced exactly once via #global-status; the visible status is aria-hidden.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["None."], "evaluator_md": "SUMMARY:\nThe single-file password recovery demo meets the functional, accessibility, and inclusivity requirements for a client-only mocked flow. It provides a clear 4-step process with progress indicators, deterministic code delivery via console.log, robust validation and feedback, state persistence (pause/resume), and ADHD-friendly design with no time pressure. Accessibility is handled with semantic HTML, ARIA live regions, focus management, and large tap targets. No network calls are made, and privacy is respected by not revealing account existence.\n\nFUNCTIONAL_CHECK:\n- Single-file deliverable with semantic HTML and inline CSS/JS — PASS. One index.html with header/nav/main/section/footer; all CSS/JS inline; commented mapping to spec present.\n- Client-only, mocked delivery; no network calls — PASS. No fetch/XHR; code generation is deterministic; delivery via console.log in sendOrResendCode().\n- Clear, step-by-step flow with visible progress — PASS. Four steps with a progress nav, current/done states, and aria-current; step headings clarify “Step X of 4”.\n- Step 1 (Identify): collect email/username; privacy-preserving messaging — PASS. Identifier field with validation; global message “sent if the account exists”; does not disclose account existence.\n- Deterministic code generation and resend behavior — PASS. generateCode() based on identifier; resend logs same code; no limits or timers.\n- Step 2 (Verify): code entry with guidance, validation, and resend — PASS. Numeric input, sanitization, length check, mismatch error, and “Resend” available.\n- Step 3 (New password): minimum rule, confirm match, show/hide toggles, inline validation — PASS. 8+ chars rule, match check, inline messages, visibility toggles with aria-pressed.\n- Step 4 (Done): confirmation and restart option — PASS. Clear next steps; “Start over” with confirmation.\n- State persistence and resume: step and key inputs saved/restored — PASS. localStorage saves step, identifier, and enteredCode; restored on load; Step 2 reminder via global status.\n- Focus management to support orientation — PASS. Focus is moved to the current step heading on step changes and on init.\n- Clear sensitive inputs on completion and when appropriate — PASS. Code and password fields cleared via clearSensitive() on success; passwords never repopulated; Step 4 back returns to Step 3 with cleared fields (privacy).\n- Back/Cancel controls; no auto-advance without user action — PASS. Back and Cancel present across steps; navigation only occurs on clicks/submit; no timeouts/auto-advance.\n- Accessibility: ARIA roles, live regions, keyboard support, large tap targets — PASS. Global SR-only live region; visible status aria-hidden; inline alerts; buttons ≥44px; clear focus outlines; Escape closes help.\n- Inclusivity (ADHD-friendly): simple copy, low distraction, no timers, visible progress, reminders, ability to pause/return — PASS. Plain language, minimal clutter, no time pressure, saved progress, and gentle status guidance.\n- Help options available and easy to access at any stage — PASS. Persistent details “Need help?” in header across all steps.\n- Testability and documentation — PASS. Manual testing checklist included in comments.\n\nFAILING_ITEMS:\n- None observed against the provided requirements and inclusivity goals.\n\nNEW_TASKS:\n- None.\n\nDECISION:\nPASS", "done": false, "iter": 6, "step": 18}
{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    /* Requirement: type-specific global status styles (non-intrusive but noticeable) */\n    .status--info {\n      background: #f0f5ff;\n      color: #0b2c5a;\n      border-color: #c9dcff;\n    }\n    .status--success {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status--error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 44px; /* Increased to meet large tap target requirement */\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Accessibility decision (Task): Use a single live region for global announcements to prevent duplicate SR output.\n         - #global-status (below) is screen-reader-only with role=\"status\" aria-live=\"polite\".\n         - #global-status-visible mirrors the text for sighted users but is aria-hidden=\"true\" and has no live role. -->\n    <!-- Global status live region for concise guidance (SR-only) -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n    <!-- Visible global status for sighted users; aria-hidden to avoid duplicate announcements -->\n    <div id=\"global-status-visible\" class=\"status\" aria-hidden=\"true\" hidden></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n      dom.globalStatusVisible = document.getElementById('global-status-visible');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    // Requirement: visible + SR global status updates with type-specific styling\n    // Accessibility note: Only #global-status is a live region. #global-status-visible mirrors text for sighted users but is aria-hidden.\n    function setGlobalStatus(msg, type = 'info') {\n      const sr = dom.globalStatus;\n      const vis = dom.globalStatusVisible;\n      const modifiers = ['status--info', 'status--success', 'status--error'];\n\n      if (!msg) {\n        if (sr) sr.textContent = '';\n        if (vis) {\n          vis.textContent = '';\n          vis.hidden = true;\n          vis.classList.remove(...modifiers);\n        }\n        return;\n      }\n\n      if (sr) sr.textContent = msg;\n\n      if (vis) {\n        vis.textContent = msg;\n        vis.hidden = false;\n        vis.classList.remove(...modifiers);\n        const map = { info: 'status--info', success: 'status--success', error: 'status--error' };\n        vis.classList.add(map[type] || 'status--info');\n      }\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6-digit code was sent if the account exists.', 'info');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.', 'success');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)', 'info');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).', 'success');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // Requirement: On resume at Step 2, provide a gentle reminder\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6-digit code. You can resend if needed.', 'info');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Global status is announced exactly once via #global-status; the visible status is aria-hidden.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["None"], "evaluator_md": "SUMMARY:\nThe index.html implements a complete, single-page, client-only password recovery flow with mocked delivery, strong accessibility, and ADHD-friendly UX. It follows the requirements with deterministic code generation, local state persistence, privacy-preserving messaging, clear progress, and inclusive microcopy. No network calls are made, and sensitive inputs are cleared on success. Overall, the artifact meets both the functional and inclusivity expectations.\n\nFUNCTIONAL_CHECK:\n- Single file; semantic HTML with inline CSS & JS; no external calls: PASS — One HTML file with all logic, styling, and markup; no fetch/XHR; uses header/main/nav/section/footer, labels, and form semantics.\n- Clear intro and step guidance with low-stress language: PASS — Intro explains simple steps, no time limits, demo context; each step has concise hints and next-step cues.\n- Progress indicator (Identify, Verify, New Password, Done) and accessibility: PASS — 4-step progress pills with aria-current; live region announces “Step X of 4”.\n- Step 1 collects email/username with validation (non-disclosing): PASS — Required field, inline error via role=alert; submission advances with privacy-preserving messaging in Step 2.\n- Deterministic mock code generation and console logging: PASS — generateCode() deterministic; send/resend logs to console consistently.\n- Do not reveal account existence: PASS — Messaging uses “if the account exists” and never indicates presence/absence.\n- Step 2 code entry with validation and resend, no time pressure: PASS — 6-digit numeric input with sanitization; inline and global feedback; Resend logs same code; no timers/limits.\n- Step 3 password creation (min length, confirm), show/hide toggles, inline validation: PASS — Minimum 8 chars; confirm must match; toggles with aria-pressed; inline feedback and aria-invalid.\n- Success advances to Step 4 and clears sensitive inputs: PASS — clearSensitive() empties code and passwords before advancing to Done.\n- Step 4 confirmation, next steps, restart: PASS — Clear next steps, Back and Start over options provided.\n- Persist progress and key inputs; restore on load; privacy-sensitive fields not repopulated: PASS — localStorage for step/identifier/code; passwords never repopulated; code cleared on success.\n- Inclusivity for ADHD (simple, structured, clear feedback, no timeouts, visible progress, reminders): PASS — No timeouts; progress visible; calm microcopy; global status reminders on resume; back/cancel available.\n- Reduced visual/cognitive load; high contrast; large tap targets: PASS — High-contrast palette; generous spacing; buttons min-height 44px; minimal UI decorations.\n- Help is easy to find across steps: PASS — Persistent “Need help?” details in header with tips and contact placeholder.\n- Back and Cancel controls; no auto-advance without user action: PASS — Back/Cancel on each step; step changes only on explicit actions.\n- ARIA roles/labels/live regions; keyboard accessible; focus management: PASS — Landmarks set; labels tied; global status live region; inline alerts for field errors; focus moved to step headings; visible focus outlines.\n- Client-only; mocked delivery: PASS — No network usage; console.log simulates code delivery.\n- Start Over with confirmation clears saved state: PASS — Start over buttons confirm and clear localStorage; messaging confirms reset.\n- Commented sections mapping to spec; testing checklist included: PASS — Top-level comment maps features to requirements; manual testing checklist at bottom.\n\nFAILING_ITEMS:\n- None\n\nNEW_TASKS:\n- None\n\nDECISION:\nPASS", "done": false, "iter": 7, "step": 21}
{"code_html": "\n<!doctype html>\n<!--\n  Password Recovery System — Single-Page, Client-Only, Mocked\n  This file implements all logic, UI, and accessibility in one HTML document.\n\n  Mapping to Requirements:\n  - Semantic HTML, inline CSS & JS: yes (single file, no external calls)\n  - Clear intro with step-by-step outline: header/introduction\n  - Progress indicator (Identify, Verify, New Password, Done): <nav aria-label=\"Progress\">\n  - Step 1: collect email/username, Continue: #step1 form\n  - Step 1 submission: deterministic code via console.log, persist progress: JS generateCode + localStorage\n  - Confirmation after Step 1 without revealing account existence: status copy in Step 2\n  - Step 2: enter code, guidance, Resend Code re-logs deterministic code, validation feedback: #step2 form\n  - Step 3: new password + confirm, show/hide toggles, simple rules, inline validation: #step3 form\n  - On success: advance to Step 4, clear sensitive inputs: JS clearSensitive()\n  - Step 4: confirmation + next steps + restart: #step4\n  - Persist step and key inputs; restore on load; focus management: localStorage + focus heading\n  - High-contrast, low-distraction styling; large tap targets: CSS\n  - ADHD-friendly microcopy; no timeouts; clear feedback: microcopy in each step\n  - Help available on every step: persistent <details id=\"help\">\n  - Back and Cancel controls; never auto-advance without user action: buttons in each step\n  - ARIA roles/labels/live regions; keyboard accessible: aria-live regions, landmarks, focus order\n  - Client-only; no network calls: no fetch/XHR; mocked delivery via console.log\n  - Start Over action with confirm; clears local storage: Start Over controls\n  - Inline comments link to inclusivity and mocking requirements\n  - Testing checklist: see bottom comments\n\n  NOTE: This is a demonstration. Not for production use.\n-->\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <title>Password Recovery (Client-side Mock)</title>\n  <style>\n    /* Accessibility & Inclusivity: high-contrast, low-distraction, generous spacing */\n    :root {\n      --bg: #ffffff;\n      --text: #111111;\n      --muted: #444444;\n      --accent: #005fcc; /* strong blue */\n      --accent-contrast: #ffffff;\n      --ok: #0a7f2e;\n      --warn: #a65e00;\n      --error: #b00020;\n      --focus: #ff9900;\n      --surface: #f5f7fa;\n      --border: #d6dbe1;\n      --link: #004b9a;\n    }\n    * { box-sizing: border-box; }\n    html, body {\n      background: var(--bg);\n      color: var(--text);\n      margin: 0;\n      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      line-height: 1.5;\n      scroll-behavior: auto; /* reduce disorienting motion */\n    }\n    a { color: var(--link); }\n    a:focus, button:focus, input:focus, summary:focus {\n      outline: 3px solid var(--focus);\n      outline-offset: 2px;\n    }\n    header.site {\n      padding: 1.25rem;\n      border-bottom: 1px solid var(--border);\n      background: var(--surface);\n    }\n    .container {\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 1.25rem;\n    }\n    h1, h2, h3 {\n      line-height: 1.2;\n      margin-top: 0;\n    }\n    p { margin: 0.5rem 0 1rem; }\n    .intro {\n      color: var(--muted);\n    }\n\n    /* Progress indicator */\n    nav.progress {\n      margin: 1rem 0 1.25rem;\n      padding: 0.5rem;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 8px;\n    }\n    .steps {\n      list-style: none;\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 0.5rem;\n      margin: 0;\n      padding: 0;\n    }\n    .steps li {\n      text-align: center;\n      padding: 0.75rem 0.5rem;\n      border-radius: 6px;\n      border: 1px solid var(--border);\n      color: var(--muted);\n      background: #fff;\n      font-weight: 600;\n      font-size: 0.95rem;\n    }\n    .steps li.current {\n      background: var(--accent);\n      color: var(--accent-contrast);\n      border-color: var(--accent);\n    }\n    .steps li.done {\n      background: #e8f4ff;\n      color: #0b4294;\n      border-color: #bcd9ff;\n    }\n\n    /* Forms & controls */\n    form {\n      margin-top: 0.5rem;\n    }\n    .field {\n      margin: 0 0 1rem;\n    }\n    label {\n      display: block;\n      font-weight: 600;\n      margin-bottom: 0.35rem;\n    }\n    .hint {\n      color: var(--muted);\n      font-size: 0.95rem;\n      margin-top: -0.25rem;\n      margin-bottom: 0.75rem;\n    }\n    input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"tel\"] {\n      width: 100%;\n      padding: 0.8rem 0.9rem;\n      border: 2px solid var(--border);\n      border-radius: 8px;\n      font-size: 1rem;\n      background: #fff;\n    }\n    input[aria-invalid=\"true\"] {\n      border-color: var(--error);\n    }\n    .row {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .actions {\n      display: flex;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n      margin-top: 0.5rem;\n    }\n    button, .button-like {\n      appearance: none;\n      border: none;\n      background: var(--accent);\n      color: var(--accent-contrast);\n      padding: 0.9rem 1.1rem;\n      border-radius: 10px;\n      font-size: 1rem;\n      font-weight: 700;\n      cursor: pointer;\n      min-height: 44px; /* large tap target */\n    }\n    button.secondary {\n      background: #eef2f7;\n      color: #0b1324;\n      border: 1px solid var(--border);\n    }\n    button.link {\n      background: transparent;\n      color: var(--link);\n      padding: 0.25rem 0.25rem;\n      border-radius: 6px;\n      border: 1px dashed transparent;\n      text-decoration: underline;\n      font-weight: 600;\n    }\n    button.danger {\n      background: #ffe9ec;\n      color: #8a0010;\n      border: 1px solid #ffc6ce;\n    }\n\n    /* Status & validation messages (ARIA live) */\n    .status {\n      margin: 0.75rem 0;\n      padding: 0.75rem 0.75rem;\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      background: #f9fbff;\n      color: #0b2c5a;\n    }\n    .status.ok {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status.error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    /* Requirement: type-specific global status styles (non-intrusive but noticeable) */\n    .status--info {\n      background: #f0f5ff;\n      color: #0b2c5a;\n      border-color: #c9dcff;\n    }\n    .status--success {\n      background: #ecf9f0;\n      color: var(--ok);\n      border-color: #bde7c9;\n    }\n    .status--error {\n      background: #fff1f1;\n      color: var(--error);\n      border-color: #ffd7d7;\n    }\n    .visually-hidden {\n      position: absolute !important;\n      height: 1px; width: 1px;\n      overflow: hidden;\n      clip: rect(1px, 1px, 1px, 1px);\n      white-space: nowrap;\n    }\n\n    /* Panels */\n    .panel {\n      border: 1px solid var(--border);\n      background: #fff;\n      border-radius: 12px;\n      padding: 1rem;\n      margin-bottom: 1rem;\n    }\n\n    details#help {\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 0.75rem 1rem;\n      background: #fff;\n      margin: 1rem 0;\n    }\n    details#help summary {\n      font-weight: 700;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details#help[open] {\n      background: #f7fbff;\n    }\n    .subtle {\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n    footer.site {\n      border-top: 1px solid var(--border);\n      background: var(--surface);\n      padding: 1rem 1.25rem;\n      color: var(--muted);\n      font-size: 0.95rem;\n    }\n\n    /* Step sections hidden by [hidden] for semantic hiding */\n    section[hidden] { display: none; }\n\n    /* Password show/hide group */\n    .password-wrap {\n      position: relative;\n    }\n    .toggle-visibility {\n      position: absolute;\n      right: 0.35rem;\n      top: 0.35rem;\n      background: transparent;\n      color: var(--link);\n      border: 1px dashed transparent;\n      padding: 0.4rem 0.6rem;\n      text-decoration: underline;\n      min-height: 44px; /* Increased to meet large tap target requirement */\n    }\n\n    /* Reduce cognitive load with consistent spacing */\n    .spacer { height: 0.25rem; }\n  </style>\n</head>\n<body>\n  <header class=\"site\" role=\"banner\">\n    <div class=\"container\">\n      <h1 id=\"app-title\">Reset your password</h1>\n      <p class=\"intro\">\n        Simple, step-by-step flow. No time limits. You can pause and return anytime.\n        This demo runs entirely in your browser. The verification code is simulated.\n      </p>\n      <nav class=\"progress\" aria-label=\"Progress\">\n        <ol class=\"steps\" id=\"progress-steps\">\n          <li id=\"step-pill-1\" aria-current=\"step\">1. Identify</li>\n          <li id=\"step-pill-2\">2. Verify</li>\n          <li id=\"step-pill-3\">3. New Password</li>\n          <li id=\"step-pill-4\">4. Done</li>\n        </ol>\n        <div id=\"progress-live\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n      </nav>\n\n      <!-- Help is available on every step (Inclusivity: easy access, low stress) -->\n      <details id=\"help\">\n        <summary aria-controls=\"help-content\">Need help?</summary>\n        <div id=\"help-content\">\n          <p>\n            Tips:\n          </p>\n          <ul>\n            <li>There’s no timer. Take your time.</li>\n            <li>We keep your place if you close this page and return.</li>\n            <li>If you lose the code, choose “Resend code”. It will be the same for this demo.</li>\n          </ul>\n          <p class=\"subtle\">\n            Contact (placeholder): 555‑0000 or help@hospital.example. This demo does not send emails or texts.\n          </p>\n        </div>\n      </details>\n    </div>\n  </header>\n\n  <main class=\"container\" id=\"app\" role=\"main\">\n    <!-- Accessibility decision (Task): Use a single live region for global announcements to prevent duplicate SR output.\n         - #global-status (below) is screen-reader-only with role=\"status\" aria-live=\"polite\".\n         - #global-status-visible mirrors the text for sighted users but is aria-hidden=\"true\" and has no live role. -->\n    <!-- Global status live region for concise guidance (SR-only) -->\n    <div id=\"global-status\" class=\"visually-hidden\" role=\"status\" aria-live=\"polite\"></div>\n    <!-- Visible global status for sighted users; aria-hidden to avoid duplicate announcements -->\n    <div id=\"global-status-visible\" class=\"status\" aria-hidden=\"true\" hidden></div>\n\n    <!-- Step 1: Identify (Collect email or username) -->\n    <section id=\"step1\" class=\"panel\" aria-labelledby=\"step1-heading\">\n      <h2 id=\"step1-heading\" tabindex=\"-1\">Step 1 of 4: Identify your account</h2>\n      <p class=\"hint\">Enter your email or username. We’ll send a 6‑digit code if it matches an account.</p>\n      <form id=\"form-step1\" novalidate>\n        <div class=\"field\">\n          <label for=\"identifier\">Email or username</label>\n          <input id=\"identifier\" name=\"identifier\" type=\"text\" autocomplete=\"username email\" required aria-required=\"true\" aria-describedby=\"identifier-hint\">\n          <div id=\"identifier-hint\" class=\"hint\">Example: helena@example.com or helena67</div>\n          <div id=\"identifier-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s1-continue\" class=\"primary\">Continue</button>\n          <button type=\"button\" id=\"btn-s1-cancel\" class=\"secondary\">Cancel</button>\n          <button type=\"button\" id=\"btn-s1-startover\" class=\"danger\">Start over</button>\n        </div>\n        <p class=\"subtle\">We will not show whether an account exists. This protects your privacy.</p>\n      </form>\n    </section>\n\n    <!-- Step 2: Verify (Enter code) -->\n    <section id=\"step2\" class=\"panel\" aria-labelledby=\"step2-heading\" hidden>\n      <h2 id=\"step2-heading\" tabindex=\"-1\">Step 2 of 4: Enter the 6‑digit code</h2>\n      <p id=\"step2-intro\" class=\"hint\">\n        If the details you gave match an account, a code was sent to your contact on file. Enter the 6‑digit code. You can resend if needed.\n      </p>\n      <form id=\"form-step2\" novalidate>\n        <div class=\"field\">\n          <label for=\"code\">Verification code</label>\n          <input id=\"code\" name=\"code\" inputmode=\"numeric\" pattern=\"[0-9]*\" maxlength=\"6\" autocomplete=\"one-time-code\" aria-describedby=\"code-hint\" required>\n          <div id=\"code-hint\" class=\"hint\">Numbers only. Example: 123456</div>\n          <div id=\"code-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"code-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Code accepted. Next: set a new password.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s2-continue\">Continue</button>\n          <button type=\"button\" id=\"btn-s2-resend\" class=\"secondary\">Resend code</button>\n          <button type=\"button\" id=\"btn-s2-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s2-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">Tip: The code in this demo is deterministic and logged to the console.</p>\n      </form>\n    </section>\n\n    <!-- Step 3: New Password -->\n    <section id=\"step3\" class=\"panel\" aria-labelledby=\"step3-heading\" hidden>\n      <h2 id=\"step3-heading\" tabindex=\"-1\">Step 3 of 4: Create a new password</h2>\n      <p class=\"hint\">Use at least 8 characters. Avoid obvious words. You’ll type it twice to confirm.</p>\n      <form id=\"form-step3\" novalidate>\n        <div class=\"field password-wrap\">\n          <label for=\"password\">New password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password\" data-target=\"password\">Show</button>\n          <div id=\"password-hint\" class=\"hint\">Minimum 8 characters.</div>\n        </div>\n        <div class=\"field password-wrap\">\n          <label for=\"password2\">Confirm new password</label>\n          <input id=\"password2\" name=\"password2\" type=\"password\" autocomplete=\"new-password\" required aria-required=\"true\" aria-describedby=\"password2-hint\">\n          <button type=\"button\" class=\"toggle-visibility\" aria-pressed=\"false\" aria-controls=\"password2\" data-target=\"password2\">Show</button>\n          <div id=\"password2-hint\" class=\"hint\">Must match exactly.</div>\n          <div id=\"password-msg\" class=\"status error\" role=\"alert\" aria-live=\"assertive\" hidden></div>\n          <div id=\"password-ok\" class=\"status ok\" role=\"status\" aria-live=\"polite\" hidden>Password saved locally for this demo only.</div>\n        </div>\n        <div class=\"actions\">\n          <button type=\"submit\" id=\"btn-s3-continue\">Save new password</button>\n          <button type=\"button\" id=\"btn-s3-back\" class=\"secondary\">Back</button>\n          <button type=\"button\" id=\"btn-s3-cancel\" class=\"danger\">Cancel</button>\n        </div>\n        <p class=\"subtle\">For privacy, we clear password fields as soon as you finish.</p>\n      </form>\n    </section>\n\n    <!-- Step 4: Done -->\n    <section id=\"step4\" class=\"panel\" aria-labelledby=\"step4-heading\" hidden>\n      <h2 id=\"step4-heading\" tabindex=\"-1\">Step 4 of 4: All set</h2>\n      <p class=\"hint\">Your password is updated. Next, sign in and accept the updated privacy terms.</p>\n      <ul>\n        <li>Go to the sign-in page (placeholder).</li>\n        <li>If you need to restart, choose “Start over”.</li>\n      </ul>\n      <div class=\"actions\">\n        <button type=\"button\" id=\"btn-s4-back\" class=\"secondary\">Back</button>\n        <button type=\"button\" id=\"btn-s4-startover\" class=\"danger\">Start over</button>\n      </div>\n      <p class=\"subtle\">Note: This is a demo. No data left your browser.</p>\n    </section>\n  </main>\n\n  <footer class=\"site\" role=\"contentinfo\">\n    <div class=\"container\">\n      <p>Accessible, low-stress design. Keyboard-friendly. No timeouts. No external calls.</p>\n    </div>\n  </footer>\n\n  <script>\n    /* Utilities and state (Client-only, Mocked) */\n\n    // Inclusive design: prevent disorienting jumps when focusing headings\n    function focusHeading(el) {\n      if (!el) return;\n      // Make sure it can receive focus and then focus it\n      el.setAttribute('tabindex', '-1');\n      el.focus({ preventScroll: false });\n    }\n\n    // Deterministic mock code generation (no server, consistent in resend)\n    // Inclusivity: predictable behavior reduces cognitive load\n    function generateCode(identifier) {\n      const s = (identifier || '').toLowerCase().trim();\n      let h = 0;\n      for (let i = 0; i < s.length; i++) {\n        h = (h * 31 + s.charCodeAt(i)) % 1000000;\n      }\n      h = (h + 111111) % 1000000;\n      return String(h).padStart(6, '0');\n    }\n\n    // State persistence so users can pause and resume (Inclusivity)\n    const STORAGE_KEY = 'pr_state_v1';\n    function loadState() {\n      try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return { step: 1, identifier: '', enteredCode: '' };\n        const obj = JSON.parse(raw);\n        return Object.assign({ step: 1, identifier: '', enteredCode: '' }, obj);\n      } catch (e) {\n        return { step: 1, identifier: '', enteredCode: '' };\n      }\n    }\n    function saveState(state) {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n    }\n    function clearAllState() {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n\n    // DOM references\n    const dom = {};\n    function cacheDom() {\n      dom.progressPills = [\n        document.getElementById('step-pill-1'),\n        document.getElementById('step-pill-2'),\n        document.getElementById('step-pill-3'),\n        document.getElementById('step-pill-4')\n      ];\n      dom.progressLive = document.getElementById('progress-live');\n      dom.globalStatus = document.getElementById('global-status');\n      dom.globalStatusVisible = document.getElementById('global-status-visible');\n\n      dom.sections = {\n        1: document.getElementById('step1'),\n        2: document.getElementById('step2'),\n        3: document.getElementById('step3'),\n        4: document.getElementById('step4')\n      };\n      dom.headings = {\n        1: document.getElementById('step1-heading'),\n        2: document.getElementById('step2-heading'),\n        3: document.getElementById('step3-heading'),\n        4: document.getElementById('step4-heading')\n      };\n\n      // Step 1\n      dom.form1 = document.getElementById('form-step1');\n      dom.identifier = document.getElementById('identifier');\n      dom.identifierMsg = document.getElementById('identifier-msg');\n      dom.btnS1Cancel = document.getElementById('btn-s1-cancel');\n      dom.btnS1StartOver = document.getElementById('btn-s1-startover');\n\n      // Step 2\n      dom.form2 = document.getElementById('form-step2');\n      dom.code = document.getElementById('code');\n      dom.codeMsg = document.getElementById('code-msg');\n      dom.codeOk = document.getElementById('code-ok');\n      dom.btnS2Resend = document.getElementById('btn-s2-resend');\n      dom.btnS2Back = document.getElementById('btn-s2-back');\n      dom.btnS2Cancel = document.getElementById('btn-s2-cancel');\n\n      // Step 3\n      dom.form3 = document.getElementById('form-step3');\n      dom.password = document.getElementById('password');\n      dom.password2 = document.getElementById('password2');\n      dom.pwMsg = document.getElementById('password-msg');\n      dom.pwOk = document.getElementById('password-ok');\n      dom.btnS3Back = document.getElementById('btn-s3-back');\n      dom.btnS3Cancel = document.getElementById('btn-s3-cancel');\n      dom.toggleButtons = document.querySelectorAll('.toggle-visibility');\n\n      // Step 4\n      dom.btnS4StartOver = document.getElementById('btn-s4-startover');\n      dom.btnS4Back = document.getElementById('btn-s4-back');\n    }\n\n    // UI updates\n    function updateProgress(step) {\n      dom.progressPills.forEach((pill, idx) => {\n        pill.classList.remove('current', 'done');\n        pill.removeAttribute('aria-current');\n        if (idx + 1 < step) {\n          pill.classList.add('done');\n        } else if (idx + 1 === step) {\n          pill.classList.add('current');\n          pill.setAttribute('aria-current', 'step');\n        }\n      });\n      dom.progressLive.textContent = `Step ${step} of 4`;\n    }\n\n    function showSection(step) {\n      Object.entries(dom.sections).forEach(([k, el]) => {\n        const visible = Number(k) === step;\n        if (visible) {\n          el.removeAttribute('hidden');\n        } else {\n          el.setAttribute('hidden', 'hidden');\n        }\n      });\n      updateProgress(step);\n      // Manage focus to help orientation\n      focusHeading(dom.headings[step]);\n    }\n\n    // Requirement: visible + SR global status updates with type-specific styling\n    // Accessibility note: Only #global-status is a live region. #global-status-visible mirrors text for sighted users but is aria-hidden.\n    function setGlobalStatus(msg, type = 'info') {\n      const sr = dom.globalStatus;\n      const vis = dom.globalStatusVisible;\n      const modifiers = ['status--info', 'status--success', 'status--error'];\n\n      if (!msg) {\n        if (sr) sr.textContent = '';\n        if (vis) {\n          vis.textContent = '';\n          vis.hidden = true;\n          vis.classList.remove(...modifiers);\n        }\n        return;\n      }\n\n      if (sr) sr.textContent = msg;\n\n      if (vis) {\n        vis.textContent = msg;\n        vis.hidden = false;\n        vis.classList.remove(...modifiers);\n        const map = { info: 'status--info', success: 'status--success', error: 'status--error' };\n        vis.classList.add(map[type] || 'status--info');\n      }\n    }\n\n    // Navigation with state persistence\n    let state = loadState();\n\n    function goToStep(step) {\n      state.step = step;\n      saveState(state);\n      showSection(step);\n    }\n\n    function resetToStep1(preserveIdentifier = true) {\n      const keepId = preserveIdentifier ? state.identifier : '';\n      state = { step: 1, identifier: keepId, enteredCode: '' };\n      saveState(state);\n      fillFromState();\n      showSection(1);\n    }\n\n    // Fill inputs with persisted values\n    function fillFromState() {\n      // Step 1\n      dom.identifier.value = state.identifier || '';\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      dom.identifierMsg.textContent = '';\n\n      // Step 2\n      dom.code.value = state.enteredCode || '';\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeMsg.textContent = '';\n      dom.codeOk.hidden = true;\n\n      // Step 3 (never repopulate passwords for privacy)\n      dom.password.value = '';\n      dom.password2.value = '';\n      dom.password.setAttribute('aria-invalid', 'false');\n      dom.password2.setAttribute('aria-invalid', 'false');\n      dom.pwMsg.hidden = true;\n      dom.pwMsg.textContent = '';\n      dom.pwOk.hidden = true;\n    }\n\n    // Mock \"delivery\" of the code (console.log only)\n    function sendOrResendCode() {\n      const id = state.identifier || '';\n      const code = generateCode(id);\n      // Mocked delivery (Requirement: simulate via console.log)\n      console.log(`[Mock] Verification code for \"${id}\": ${code}`);\n      setGlobalStatus('A 6-digit code was sent if the account exists.', 'info');\n    }\n\n    // Validation helpers\n    function validateIdentifier() {\n      const value = dom.identifier.value.trim();\n      if (!value) {\n        dom.identifier.setAttribute('aria-invalid', 'true');\n        dom.identifierMsg.textContent = 'Please enter your email or username.';\n        dom.identifierMsg.hidden = false;\n        return false;\n      }\n      dom.identifier.setAttribute('aria-invalid', 'false');\n      dom.identifierMsg.hidden = true;\n      return true;\n    }\n\n    function sanitizeCodeInput() {\n      // Keep only digits and trim to 6\n      const digits = dom.code.value.replace(/\\D/g, '').slice(0, 6);\n      if (dom.code.value !== digits) {\n        dom.code.value = digits;\n      }\n    }\n\n    function validateCode() {\n      sanitizeCodeInput();\n      const value = dom.code.value;\n      if (value.length !== 6) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'Enter the 6‑digit code.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      // Compare deterministically\n      const expected = generateCode(state.identifier || '');\n      if (value !== expected) {\n        dom.code.setAttribute('aria-invalid', 'true');\n        dom.codeMsg.textContent = 'That code doesn’t match. Check the code and try again, or resend.';\n        dom.codeMsg.hidden = false;\n        dom.codeOk.hidden = true;\n        return false;\n      }\n      dom.code.setAttribute('aria-invalid', 'false');\n      dom.codeMsg.hidden = true;\n      dom.codeOk.hidden = false;\n      return true;\n    }\n\n    function validatePasswords(showMessages = true) {\n      const p1 = dom.password.value;\n      const p2 = dom.password2.value;\n      const errors = [];\n      if (!p1 || p1.length < 8) {\n        errors.push('Use at least 8 characters.');\n      }\n      if (!p2) {\n        errors.push('Confirm your new password.');\n      }\n      if (p1 && p2 && p1 !== p2) {\n        errors.push('Passwords must match exactly.');\n      }\n      const ok = errors.length === 0;\n      if (showMessages) {\n        if (ok) {\n          dom.pwMsg.hidden = true;\n          dom.pwOk.hidden = false;\n          dom.password.setAttribute('aria-invalid', 'false');\n          dom.password2.setAttribute('aria-invalid', 'false');\n        } else {\n          dom.pwOk.hidden = true;\n          dom.pwMsg.textContent = errors[0];\n          dom.pwMsg.hidden = false;\n          dom.password.setAttribute('aria-invalid', String(p1.length < 8));\n          dom.password2.setAttribute('aria-invalid', String(p2 && p1 !== p2));\n        }\n      }\n      return ok;\n    }\n\n    // Clear sensitive inputs from memory/UI when advancing\n    function clearSensitive() {\n      dom.code.value = '';\n      dom.password.value = '';\n      dom.password2.value = '';\n      state.enteredCode = '';\n      saveState(state);\n    }\n\n    // Event wiring\n    function wireEvents() {\n      // Step 1\n      dom.form1.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validateIdentifier()) {\n          setGlobalStatus('Please correct the highlighted field.');\n          return;\n        }\n        // Persist identifier\n        state.identifier = dom.identifier.value.trim();\n        saveState(state);\n\n        // Mock send code (deterministic) and advance\n        sendOrResendCode();\n        // Clear any leftover code input\n        state.enteredCode = '';\n        saveState(state);\n\n        goToStep(2);\n      });\n\n      dom.btnS1Cancel.addEventListener('click', () => {\n        // Cancel brings you back to Step 1 and keeps what you typed (no auto-advance)\n        resetToStep1(true);\n      });\n\n      dom.btnS1StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      // Step 2\n      dom.code.addEventListener('input', () => {\n        sanitizeCodeInput();\n        state.enteredCode = dom.code.value;\n        saveState(state);\n      });\n\n      dom.form2.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (validateCode()) {\n          // Success feedback (inline live region) then advance\n          setGlobalStatus('Code accepted. Next: create a new password.', 'success');\n          // Clear stored code (privacy) as we go to next step\n          state.enteredCode = '';\n          saveState(state);\n          goToStep(3);\n        } else {\n          setGlobalStatus('Please check the code and try again.');\n        }\n      });\n\n      dom.btnS2Resend.addEventListener('click', () => {\n        sendOrResendCode(); // Logs the same deterministic code; no timers or limits\n        setGlobalStatus('Code resent. Check your messages. (In this demo, see the console.)', 'info');\n      });\n\n      dom.btnS2Back.addEventListener('click', () => {\n        goToStep(1);\n      });\n\n      dom.btnS2Cancel.addEventListener('click', () => {\n        // Cancel to Step 1 without losing typed identifier\n        resetToStep1(true);\n      });\n\n      // Step 3\n      dom.form3.addEventListener('submit', (e) => {\n        e.preventDefault();\n        if (!validatePasswords(true)) {\n          setGlobalStatus('Please fix the password and try again.');\n          return;\n        }\n        // In a real app, this would submit to server; here we just simulate success.\n        dom.pwOk.hidden = false;\n        setGlobalStatus('Password updated successfully (demo).', 'success');\n        // Clear sensitive inputs and advance to Done\n        clearSensitive();\n        goToStep(4);\n      });\n\n      dom.password.addEventListener('input', () => validatePasswords(false));\n      dom.password2.addEventListener('input', () => validatePasswords(false));\n\n      dom.toggleButtons.forEach(btn => {\n        btn.addEventListener('click', () => {\n          const id = btn.getAttribute('data-target');\n          const input = document.getElementById(id);\n          if (!input) return;\n          const isPassword = input.type === 'password';\n          input.type = isPassword ? 'text' : 'password';\n          const pressed = btn.getAttribute('aria-pressed') === 'true';\n          btn.setAttribute('aria-pressed', String(!pressed));\n          btn.textContent = isPassword ? 'Hide' : 'Show';\n          input.focus();\n        });\n      });\n\n      dom.btnS3Back.addEventListener('click', () => {\n        goToStep(2);\n      });\n\n      dom.btnS3Cancel.addEventListener('click', () => {\n        resetToStep1(true);\n      });\n\n      // Step 4\n      dom.btnS4StartOver.addEventListener('click', () => {\n        if (confirm('Start over and clear saved progress?')) {\n          clearAllState();\n          state = loadState();\n          fillFromState();\n          showSection(1);\n          setGlobalStatus('Progress cleared. You can start again.');\n        }\n      });\n\n      dom.btnS4Back.addEventListener('click', () => {\n        // Allow navigation back; Step 3 inputs remain cleared for privacy\n        goToStep(3);\n      });\n    }\n\n    // Initialize\n    (function init() {\n      cacheDom();\n      fillFromState();\n      // Restore last step, default to 1\n      const step = Math.min(Math.max(1, Number(state.step) || 1), 4);\n      showSection(step);\n      wireEvents();\n\n      // Restore focus to current step heading on load (Inclusivity: orientation)\n      focusHeading(dom.headings[step]);\n\n      // Requirement: On resume at Step 2, provide a gentle reminder\n      if (step === 2 && state.identifier) {\n        setGlobalStatus('Resuming: Enter the 6-digit code. You can resend if needed.', 'info');\n      }\n    })();\n\n    // Keyboard accessibility: allow Enter to submit and Esc to toggle help\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        const help = document.getElementById('help');\n        if (help && help.hasAttribute('open')) {\n          help.removeAttribute('open');\n        }\n      }\n    });\n  </script>\n\n  <!--\n    Manual Testing Checklist (run through with keyboard and mouse):\n\n    Happy path:\n    - Step 1: Enter \"helena67\" -> Continue\n      - Console shows [Mock] code (deterministic). Progress moves to Step 2.\n    - Step 2: Enter the logged 6-digit code -> Continue\n      - Advances to Step 3. Progress updates. Focus on Step 3 heading.\n    - Step 3: Enter a password >= 8 chars and confirm -> Save new password\n      - Advances to Step 4. Password fields cleared.\n    - Step 4: Start over -> Confirm -> Back to Step 1, state cleared.\n\n    Error cases:\n    - Step 1: Submit empty -> Inline error; focus remains. No advance.\n    - Step 2: Enter wrong or short code -> Inline error; no advance.\n    - Step 2: Resend -> Console logs the same code. No timers or limits.\n    - Step 3: Short password -> Inline error.\n    - Step 3: Mismatch passwords -> Inline error.\n    - Back/Cancel on any step -> Returns appropriately, no data loss except cleared sensitive fields.\n    - Refresh mid-flow -> Current step and identifier persist; focus restored to current step heading.\n\n    Accessibility:\n    - Tab through controls in order; no traps.\n    - Screen reader announces progress via live region.\n    - Global status is announced exactly once via #global-status; the visible status is aria-hidden.\n    - Buttons have at least 44px height; visible focus outlines.\n  -->\n</body>\n</html>\n", "task_list": ["None."], "evaluator_md": "SUMMARY:\nThe provided index.html implements a complete, single-file, client-only password recovery flow with mocked verification via console.log. It follows semantic HTML, inline CSS/JS, clear step-by-step UX, and ADHD-friendly inclusivity principles (no timeouts, clear progress, persistent state, simple language, help accessible). Accessibility is addressed with ARIA roles, live regions, focus management, and large tap targets. No network calls are used. The flow avoids revealing account existence and clears sensitive inputs appropriately.\n\nFUNCTIONAL_CHECK:\n- Single file with semantic HTML, inline CSS & JS; no build step required: PASS — One index.html with inline styles and scripts; no external dependencies.\n- Client-only logic; no network calls; mocked delivery via console.log with deterministic values: PASS — generateCode() is deterministic; sendOrResendCode() logs to console.\n- Four-step flow (Identify, Verify, New Password, Done) with visible progress indicator and manual advancement: PASS — Steps 1–4 implemented; progress nav updates and announces via aria-live.\n- Step 1: Collect email/username; validate required; proceed without revealing account existence: PASS — Required validation; advances with privacy-preserving messaging (“if the account exists”).\n- Step 2: Enter 6-digit code; sanitize to digits; validate against deterministic code; resend uses same code; clear feedback: PASS — inputmode numeric, sanitization, deterministic compare, resend logs same code; inline/live feedback provided.\n- Step 3: Create new password; min 8 chars; confirm match; show/hide toggles; inline validation; clear sensitive inputs: PASS — Validations enforced; show/hide buttons with aria-pressed; clearSensitive() clears code/passwords before Step 4.\n- Step 4: Confirmation, next steps, ability to restart: PASS — Confirmation text; Back and Start over present with confirmation.\n- State persistence and restoration (pause/return) for orientation; focus management on step headings: PASS — localStorage persists step, identifier, entered code; fillFromState restores; focusHeading() sets focus on headings.\n- ADHD-friendly UX: simple steps, consistent language, progress and reminders, no timeouts, low distraction, easy help access: PASS — Clear microcopy, no timers, global/inline status messages, persistent Help details, minimal visual clutter.\n- Accessibility: keyboard-friendly, clear focus outlines, ARIA roles/live regions, large tap targets, no traps: PASS — Roles on landmarks; live regions (#global-status SR-only, visible mirror aria-hidden); input aria-invalid; 44px buttons; Escape closes Help.\n- Privacy and safety: Do not reveal account existence; start-over clears state with confirm; sensitive fields not repopulated: PASS — Messaging avoids leakage; passwords never persisted; start-over clears localStorage with confirmation.\n- Comments mapping to spec and testing checklist included: PASS — Header includes mapping; detailed testing checklist at bottom.\n\nFAILING_ITEMS:\n- None found against the provided Requirements.\n\nNEW_TASKS:\n- None.\n\nDECISION:\nPASS", "done": false, "iter": 8, "step": 24}
